<!DOCTYPE html>
<html lang="ru">
<head>
 <script src="https://unpkg.com/@vkid/sdk@2.1.0/dist/sdk.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ГИБДД Республики Провинция - Официальный сайт</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
/* ==================== ОСНОВНАЯ ПАЛИТРА ЧЕРНО-СЕРОЙ ТЕМЫ ==================== */
:root {
  /* Основные черно-серые цвета */
  --black-primary: #0a0a0a;
  --black-secondary: #121212;
  --black-tertiary: #1a1a1a;
  --black-quaternary: #222222;
  
  /* Серые оттенки */
  --gray-darkest: #2a2a2a;
  --gray-darker: #3a3a3a;
  --gray-dark: #4a4a4a;
  --gray-medium: #666666;
  --gray-light: #888888;
  --gray-lighter: #aaaaaa;
  --gray-lightest: #cccccc;
  
  /* Акцентные цвета (НЕ синие) */
  --accent-red: #ff4757;
  --accent-orange: #ff793f;
  --accent-green: #2ed573;
  --accent-yellow: #ffa502;
  --accent-purple: #7158e2;
  
  /* Функциональные цвета */
  --success: var(--accent-green);
  --warning: var(--accent-yellow);
  --danger: var(--accent-red);
  --info: var(--accent-purple);
  
  /* Текст */
  --text-primary: #f0f0f0;
  --text-secondary: #b0b0b0;
  --text-tertiary: #808080;
  
  /* Границы */
  --border-primary: #333333;
  --border-secondary: #404040;
  --border-accent: #505050;
  
  /* Тени */
  --shadow-light: rgba(0, 0, 0, 0.3);
  --shadow-medium: rgba(0, 0, 0, 0.5);
  --shadow-heavy: rgba(0, 0, 0, 0.7);
  
  /* Эффекты */
  --glow-primary: rgba(255, 71, 87, 0.2);
  --glow-secondary: rgba(255, 121, 63, 0.2);
  --overlay-light: rgba(255, 255, 255, 0.05);
  --overlay-medium: rgba(255, 255, 255, 0.1);
  --overlay-heavy: rgba(255, 255, 255, 0.15);
  
  /* Закругления */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 20px;
  --radius-full: 50px;
  
  /* Анимации */
  --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-medium: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}
/* ==================== ПРИНУДИТЕЛЬНОЕ ВКЛЮЧЕНИЕ СКРОЛЛБАРА ==================== */

/* Убираем все возможные отключения скроллбара */
*,
*::before,
*::after {
    scrollbar-width: auto !important;
}

/* Для браузеров с поддержкой ::-webkit-scrollbar */
body::-webkit-scrollbar {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

html::-webkit-scrollbar {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* Убираем overflow: hidden если есть */
body, html {
    overflow-y: auto !important;
    overflow-x: auto !important;
    max-height: none !important;
}

/* Принудительно создаем прокрутку если нужно */
body {
    min-height: 101vh;
}

/* ==================== СБРОС СТИЛЕЙ И БАЗОВЫЕ НАСТРОЙКИ ==================== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: linear-gradient(135deg, var(--black-primary) 0%, var(--black-secondary) 100%);
  color: var(--text-primary);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* ==================== ТИПОГРАФИЯ ==================== */
h1, h2, h3, h4, h5, h6 {
  font-weight: 700;
  line-height: 1.2;
  margin-bottom: 1rem;
  color: var(--text-primary);
}

h1 {
  font-size: 2.5rem;
  background: linear-gradient(135deg, var(--text-primary) 0%, var(--gray-lighter) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

h2 {
  font-size: 2rem;
  color: var(--text-primary);
  position: relative;
  padding-bottom: 0.5rem;
}

h2::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 60px;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
  border-radius: var(--radius-full);
}

h3 {
  font-size: 1.5rem;
  color: var(--text-primary);
}

h4 {
  font-size: 1.25rem;
  color: var(--text-secondary);
}

p {
  margin-bottom: 1rem;
  color: var(--text-secondary);
}

a {
  color: var(--accent-red);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:hover {
  color: var(--accent-orange);
}

/* ==================== КОНТЕЙНЕРЫ И СЕТКА ==================== */
.container {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

.dashboard {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 2rem;
  padding: 2rem 0;
}

@media (max-width: 1200px) {
  .dashboard {
    grid-template-columns: 1fr;
  }
}

/* ==================== HEADER ==================== */
header {
  background: var(--black-tertiary);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid var(--border-primary);
  position: sticky;
  top: 0;
  z-index: 1000;
  padding: 1rem 0;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 2rem;
}

.logo {
  display: flex;
  align-items: center;
  gap: 1rem;
  flex-shrink: 0;
}

.logo-icon {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  color: white;
  box-shadow: 0 4px 20px var(--glow-primary);
}

.logo-text h1 {
  font-size: 1.4rem;
  margin-bottom: 0.25rem;
}

.logo-text p {
  font-size: 0.85rem;
  color: var(--text-tertiary);
  margin-bottom: 0;
}

.header-controls {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.theme-toggle {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-md);
  background: var(--black-quaternary);
  border: 1px solid var(--border-primary);
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 1.2rem;
  transition: all var(--transition-medium);
  display: flex;
  align-items: center;
  justify-content: center;
}

.theme-toggle:hover {
  background: var(--overlay-medium);
  color: var(--text-primary);
  transform: rotate(15deg);
  border-color: var(--accent-red);
}

.user-profile {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.5rem 1rem;
  background: var(--black-quaternary);
  border-radius: var(--radius-full);
  border: 1px solid var(--border-primary);
  cursor: pointer;
  transition: all var(--transition-medium);
}

.user-profile:hover {
  background: var(--overlay-medium);
  border-color: var(--accent-red);
  transform: translateY(-2px);
}

.user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: white;
  font-size: 1rem;
}

.user-info {
  display: flex;
  flex-direction: column;
}

.user-name {
  font-weight: 600;
  font-size: 0.9rem;
  color: var(--text-primary);
}

.user-rank {
  font-size: 0.8rem;
  color: var(--text-tertiary);
}

.admin-badge {
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  color: white;
  padding: 0.2rem 0.6rem;
  border-radius: var(--radius-full);
  font-size: 0.7rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

.super-admin-badge {
  background: linear-gradient(135deg, var(--accent-yellow), var(--accent-orange));
  color: var(--black-primary);
  padding: 0.2rem 0.6rem;
  border-radius: var(--radius-full);
  font-size: 0.7rem;
  font-weight: 600;
  margin-left: 0.5rem;
}

/* ==================== НАВИГАЦИЯ ==================== */
nav {
  background: var(--black-tertiary);
  border-bottom: 1px solid var(--border-primary);
  position: sticky;
  top: 82px;
  z-index: 999;
}

.nav-tabs {
  display: flex;
  list-style: none;
  overflow-x: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
  padding: 0.5rem 0;
}

.nav-tabs::-webkit-scrollbar {
  display: none;
}

.nav-tabs li {
  flex-shrink: 0;
}

.nav-tabs a {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 1rem 1.5rem;
  color: var(--text-secondary);
  font-weight: 500;
  position: relative;
  transition: all var(--transition-fast);
}

.nav-tabs a::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
  border-radius: var(--radius-full);
  transform: translateX(-50%);
  transition: width var(--transition-medium);
}

.nav-tabs a:hover,
.nav-tabs a.active {
  color: var(--text-primary);
}

.nav-tabs a:hover::before,
.nav-tabs a.active::before {
  width: 80%;
}

/* ==================== ОСНОВНОЙ КОНТЕНТ ==================== */
.main-content {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.content-section {
  background: var(--black-tertiary);
  border-radius: var(--radius-lg);
  border: 1px solid var(--border-primary);
  padding: 2rem;
  transition: all var(--transition-medium);
  position: relative;
  overflow: hidden;
}

.content-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--accent-red), transparent);
}

.content-section:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 12px 40px var(--shadow-heavy);
}

.section-title {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-primary);
}

.section-title i {
  color: var(--accent-red);
  font-size: 1.5rem;
}

/* ==================== КАРТОЧКИ ==================== */
/* Общие стили для всех карточек */
.violator-card,
.leader-card,
.bind-category,
.command-card,
.document-card,
.weapon-card,
.radio-category,
.jurisdiction-card,
.setting-card,
.admin-card,
.profile-card,
.stats-card,
.quick-links {
  background: var(--black-quaternary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-md);
  transition: all var(--transition-medium);
  overflow: hidden;
  position: relative;
}

.violator-card::before,
.leader-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
}

.bind-category,
.command-card,
.weapon-card,
.radio-category,
.setting-card,
.admin-card,
.profile-card {
  border-left: 4px solid var(--accent-red);
}

/* Эффект ховера для всех карточек */
.violator-card:hover,
.leader-card:hover,
.bind-category:hover,
.command-card:hover,
.document-card:hover,
.weapon-card:hover,
.radio-category:hover,
.jurisdiction-card:hover,
.setting-card:hover,
.admin-card:hover,
.profile-card:hover,
.stats-card:hover,
.quick-links:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--shadow-medium);
}

/* Заголовки карточек */
.violator-card-header,
.leader-card-header {
  background: linear-gradient(135deg, var(--black-tertiary), var(--black-quaternary));
  padding: 1.5rem;
}

.violator-avatar,
.leader-avatar {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: var(--overlay-medium);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: var(--text-primary);
  border: 2px solid var(--border-accent);
}

.violator-name h3,
.leader-name {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0;
}

.violator-id,
.leader-position {
  font-size: 0.9rem;
  color: var(--text-tertiary);
  margin-top: 0.25rem;
}

/* Тело карточек */
.violator-card-body,
.leader-card-body {
  padding: 1.5rem;
}

.violator-info,
.leader-info {
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid var(--border-primary);
}

.violator-info:last-child,
.leader-info:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.violator-label,
.info-label {
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.violator-value,
.info-value {
  color: var(--text-primary);
  line-height: 1.5;
}

/* Бейджи статусов */
.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-full);
  font-size: 0.8rem;
  font-weight: 600;
}

.status-active {
  background: linear-gradient(135deg, var(--success), #1dd1a1);
  color: white;
}

.status-archived {
  background: var(--gray-dark);
  color: white;
}

/* ==================== БИНДЫ ==================== */
.binds-categories {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.bind-category {
  padding: 1.5rem;
}

.bind-item {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 1rem;
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px dashed var(--border-primary);
}

.bind-item:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.bind-content {
  flex: 1;
}

.bind-key {
  display: inline-block;
  background: var(--black-tertiary);
  color: var(--text-primary);
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-sm);
  font-family: 'Courier New', monospace;
  font-weight: 600;
  margin-right: 0.5rem;
  border: 1px solid var(--border-primary);
}

.bind-description {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-top: 0.5rem;
  line-height: 1.5;
}

.btn-copy {
  background: var(--black-tertiary);
  color: var(--text-primary);
  border: 1px solid var(--border-primary);
  padding: 0.5rem 1rem;
  border-radius: var(--radius-sm);
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all var(--transition-fast);
  flex-shrink: 0;
}

.btn-copy:hover {
  background: var(--overlay-medium);
  border-color: var(--accent-red);
  transform: translateY(-2px);
}

/* ==================== КОМАНДЫ ==================== */
.commands-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.command-card {
  padding: 1.5rem;
}

.command-card h3 {
  color: var(--text-primary);
  margin-bottom: 1rem;
  font-size: 1.1rem;
}

.command-syntax {
  background: var(--black-tertiary);
  color: var(--text-primary);
  padding: 1rem;
  border-radius: var(--radius-sm);
  font-family: 'Courier New', monospace;
  margin: 1rem 0;
  border-left: 4px solid var(--accent-orange);
  overflow-x: auto;
}

.command-desc {
  color: var(--text-secondary);
  font-size: 0.9rem;
  line-height: 1.5;
  margin-bottom: 1rem;
}

.command-rank {
  display: inline-block;
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  color: white;
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-full);
  font-size: 0.8rem;
  font-weight: 600;
}

/* ==================== ДОКУМЕНТЫ ==================== */
.documents-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.document-card {
  overflow: hidden;
}

.document-icon {
  height: 120px;
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem;
  color: white;
}

.document-content {
  padding: 1.5rem;
}

.document-content h3 {
  color: var(--text-primary);
  margin-bottom: 0.75rem;
  font-size: 1.1rem;
}

.document-content p {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 1.5rem;
  line-height: 1.5;
}

/* ==================== КНОПКИ ==================== */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  border-radius: var(--radius-md);
  font-weight: 600;
  font-size: 0.95rem;
  cursor: pointer;
  transition: all var(--transition-medium);
  border: none;
  text-decoration: none;
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
  transition: left 0.5s;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px var(--glow-primary);
}

.btn-outline {
  background: transparent;
  border: 2px solid var(--border-accent);
  color: var(--text-primary);
}

.btn-outline:hover {
  border-color: var(--accent-red);
  background: var(--overlay-light);
  transform: translateY(-2px);
}

.btn-success {
  background: linear-gradient(135deg, var(--success), #1dd1a1);
  color: white;
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(46, 213, 115, 0.3);
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning), #ff9f43);
  color: var(--black-primary);
}

.btn-warning:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(255, 165, 2, 0.3);
}

.btn-danger {
  background: linear-gradient(135deg, var(--danger), #ff3838);
  color: white;
}

.btn-danger:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px var(--glow-primary);
}

/* ==================== САЙДБАР ==================== */
.sidebar {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.stats-card,
.quick-links {
  padding: 1.5rem;
}

.stats-card h3,
.quick-links h3 {
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--border-primary);
}

.stat-item:last-child {
  border-bottom: none;
}

.stat-value {
  font-weight: 700;
  color: var(--accent-red);
  font-size: 1.1rem;
}

.links-list {
  list-style: none;
}

.links-list li {
  margin-bottom: 0.5rem;
}

.links-list a {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1rem;
  color: var(--text-secondary);
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
}

.links-list a:hover {
  background: var(--overlay-light);
  color: var(--text-primary);
  transform: translateX(4px);
}

.links-list i {
  color: var(--accent-red);
  width: 20px;
  text-align: center;
}

/* ==================== FOOTER ==================== */
footer {
  background: var(--black-primary);
  padding: 3rem 0 1.5rem;
  margin-top: 3rem;
  border-top: 1px solid var(--border-primary);
}

.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 2rem;
  margin-bottom: 2rem;
}

.footer-section h3 {
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  font-size: 1.2rem;
}

.footer-section p {
  color: var(--text-secondary);
  margin-bottom: 1.5rem;
  line-height: 1.6;
}

.footer-links {
  list-style: none;
}

.footer-links li {
  margin-bottom: 0.75rem;
}

.footer-links a {
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all var(--transition-fast);
}

.footer-links a:hover {
  color: var(--text-primary);
  transform: translateX(4px);
}

.copyright {
  text-align: center;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border-primary);
  color: var(--text-tertiary);
  font-size: 0.9rem;
}

.copyright a {
  color: var(--accent-red);
  font-weight: 600;
}

.copyright a:hover {
  color: var(--accent-orange);
}

/* ==================== МОДАЛЬНЫЕ ОКНА ==================== */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(8px);
  z-index: 2000;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.modal-content {
  background: var(--black-tertiary);
  border-radius: var(--radius-lg);
  width: 100%;
  max-width: 500px;
  border: 1px solid var(--border-primary);
  overflow: hidden;
  animation: modalAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes modalAppear {
  from {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.modal-header {
  background: linear-gradient(135deg, var(--black-quaternary), var(--black-tertiary));
  padding: 1.5rem;
  border-bottom: 1px solid var(--border-primary);
}

.modal-header h2 {
  color: var(--text-primary);
  margin: 0;
}

.modal-body {
  padding: 1.5rem;
}

.modal-small {
  max-width: 400px;
}

.modal-medium {
  max-width: 500px;
}

.modal-large {
  max-width: 600px;
}

/* ==================== ФОРМЫ ==================== */
.form-group {
  margin-bottom: 1.5rem;
}

.form-group label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.form-control {
  width: 100%;
  padding: 0.75rem 1rem;
  background: var(--black-quaternary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-size: 1rem;
  transition: all var(--transition-fast);
}

.form-control:focus {
  outline: none;
  border-color: var(--accent-red);
  box-shadow: 0 0 0 3px var(--glow-primary);
}

textarea.form-control {
  min-height: 100px;
  resize: vertical;
}

.auth-tabs {
  display: flex;
  margin-bottom: 1.5rem;
  border-bottom: 1px solid var(--border-primary);
}

.auth-tab {
  flex: 1;
  text-align: center;
  padding: 0.75rem;
  cursor: pointer;
  color: var(--text-secondary);
  font-weight: 500;
  transition: all var(--transition-fast);
  position: relative;
}

.auth-tab::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 0;
  height: 3px;
  background: var(--accent-red);
  transition: width var(--transition-medium);
}

.auth-tab.active {
  color: var(--text-primary);
}

.auth-tab.active::after {
  width: 100%;
}

.auth-form {
  display: none;
}

.auth-form.active {
  display: block;
}

/* ==================== ТАБЛИЦЫ ==================== */
.table {
  width: 100%;
  border-collapse: collapse;
  background: var(--black-quaternary);
  border-radius: var(--radius-md);
  overflow: hidden;
  border: 1px solid var(--border-primary);
}

.table th,
.table td {
  padding: 1rem;
  text-align: left;
  border-bottom: 1px solid var(--border-primary);
}

.table th {
  background: var(--black-tertiary);
  color: var(--text-primary);
  font-weight: 600;
}

.table tr:hover {
  background: var(--overlay-light);
}

.table tr:last-child td {
  border-bottom: none;
}

/* ==================== АДМИН ПАНЕЛЬ ==================== */
.admin-tabs {
  display: flex;
  margin-bottom: 1.5rem;
  border-bottom: 1px solid var(--border-primary);
}

.admin-tab {
  padding: 0.75rem 1.5rem;
  cursor: pointer;
  color: var(--text-secondary);
  font-weight: 500;
  transition: all var(--transition-fast);
  position: relative;
}

.admin-tab::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 0;
  height: 3px;
  background: var(--accent-red);
  transition: width var(--transition-medium);
}

.admin-tab.active {
  color: var(--text-primary);
}

.admin-tab.active::after {
  width: 100%;
}

.admin-tab-content {
  display: none;
}

.admin-tab-content.active {
  display: block;
}

.admin-controls {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

/* ==================== ЛИДЕРБОРД ==================== */
.leaderboard-tabs {
  display: flex;
  margin-bottom: 1.5rem;
  border-bottom: 1px solid var(--border-primary);
}

.leaderboard-tab {
  padding: 0.75rem 1.5rem;
  cursor: pointer;
  color: var(--text-secondary);
  font-weight: 500;
  transition: all var(--transition-fast);
  position: relative;
}

.leaderboard-tab::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  width: 0;
  height: 3px;
  background: var(--accent-red);
  transition: width var(--transition-medium);
}

.leaderboard-tab.active {
  color: var(--text-primary);
}

.leaderboard-tab.active::after {
  width: 100%;
}

.leaderboard-content {
  display: none;
}

.leaderboard-content:first-of-type {
  display: block;
}

/* ==================== ПРОФИЛЬ ==================== */
.profile-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.profile-card {
  padding: 1.5rem;
}

.profile-card h3 {
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.profile-field {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 0;
  border-bottom: 1px solid var(--border-primary);
}

.profile-field:last-child {
  border-bottom: none;
}

.profile-field .label {
  font-weight: 600;
  color: var(--text-secondary);
}

.profile-field .value {
  color: var(--text-primary);
  font-weight: 500;
}

/* ==================== НАСТРОЙКИ ==================== */
.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.setting-card {
  padding: 1.5rem;
}

.setting-card h3 {
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.setting-option {
  margin-bottom: 1.5rem;
  padding-bottom: 1.5rem;
  border-bottom: 1px solid var(--border-primary);
}

.setting-option:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.setting-label {
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--text-primary);
}

.setting-description {
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 1rem;
  line-height: 1.5;
}

.danger-zone {
  border: 2px solid var(--danger);
  border-radius: var(--radius-md);
  padding: 1.5rem;
  margin-top: 1rem;
  background: rgba(255, 71, 87, 0.05);
}

.danger-zone h4 {
  color: var(--danger);
  margin-bottom: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

/* ==================== ПЕРЕКЛЮЧАТЕЛИ ==================== */
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.switch .slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gray-dark);
  transition: var(--transition-medium);
  border-radius: 34px;
}

.switch .slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background: white;
  transition: var(--transition-medium);
  border-radius: 50%;
}

.switch input:checked + .slider {
  background: var(--accent-red);
}

.switch input:checked + .slider:before {
  transform: translateX(26px);
}

/* ==================== ВЫБОР ЗВАНИЙ ==================== */
.rank-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 0.75rem;
  margin-top: 0.75rem;
}

.rank-option {
  padding: 0.75rem;
  background: var(--black-quaternary);
  border: 2px solid var(--border-primary);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all var(--transition-fast);
  text-align: center;
  color: var(--text-secondary);
}

.rank-option:hover {
  border-color: var(--accent-red);
  color: var(--text-primary);
  background: var(--overlay-light);
}

.rank-option.selected {
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  border-color: transparent;
  color: white;
}

.rank-option.disabled {
  opacity: 0.5;
  cursor: not-allowed;
  background: var(--gray-darkest);
}

/* ==================== КАРТОЧКИ ЦЕНТРАЛЬНОГО РАЗМЕЩЕНИЯ ==================== */
.card-center-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  z-index: 2000;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.new-violator-card {
  background: var(--black-tertiary);
  border-radius: var(--radius-xl);
  border: 1px solid var(--border-primary);
  padding: 0;
  width: 90%;
  max-width: 500px;
  position: relative;
  overflow: hidden;
  animation: cardAppear 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

@keyframes cardAppear {
  from {
    opacity: 0;
    transform: scale(0.7) translateY(30px);
  }
  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.new-violator-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-red), var(--success));
}

.new-violator-card-header {
  background: linear-gradient(135deg, var(--success), var(--accent-red));
  color: white;
  padding: 2rem;
  text-align: center;
}

.new-violator-card-header h3 {
  color: white;
  margin: 0;
  font-size: 1.5rem;
}

.new-violator-card-body {
  padding: 2rem;
}

.close-card {
  position: absolute;
  top: 1rem;
  right: 1rem;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 1.2rem;
  color: white;
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-card:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: rotate(90deg);
}

.success-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  color: white;
}

/* ==================== СТИЛИ ДЛЯ РАЗДЕЛА ОРУЖИЯ ==================== */
.weapon-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.weapon-card {
  padding: 1.5rem;
}

.weapon-card h3 {
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.weapon-info {
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px dashed var(--border-primary);
}

.weapon-info:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.weapon-info .label {
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 0.25rem;
}

.weapon-info .value {
  color: var(--text-primary);
  line-height: 1.5;
}

/* ==================== СТИЛИ ДЛЯ РАЗДЕЛА РАДИООБМЕНА ==================== */
.radio-category {
  margin-bottom: 1.5rem;
  padding: 1.5rem;
}

.radio-category h3 {
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.radio-item {
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px dashed var(--border-primary);
}

.radio-item:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.radio-syntax {
  background: var(--black-tertiary);
  color: var(--text-primary);
  padding: 1rem;
  border-radius: var(--radius-sm);
  font-family: 'Courier New', monospace;
  margin: 0.75rem 0;
  border-left: 4px solid var(--accent-orange);
  overflow-x: auto;
}

.radio-desc {
  font-size: 0.9rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

/* ==================== СТИЛИ ДЛЯ ЮРИСДИКЦИЙ ==================== */
.jurisdiction-map {
  text-align: center;
  margin: 1.5rem 0;
}

.jurisdiction-image {
  max-width: 100%;
  border-radius: var(--radius-md);
  box-shadow: 0 8px 32px var(--shadow-medium);
  margin-bottom: 1.5rem;
}

.jurisdiction-info {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.jurisdiction-card {
  padding: 1.5rem;
  border-top: 4px solid;
}

.jurisdiction-card.mirny {
  border-top-color: var(--accent-red);
}

.jurisdiction-card.mirny h3 {
  color: var(--accent-red);
}

.jurisdiction-card.nevsky {
  border-top-color: var(--accent-orange);
}

.jurisdiction-card.nevsky h3 {
  color: var(--accent-orange);
}

.jurisdiction-card.privolzhsk {
  border-top-color: var(--success);
}

.jurisdiction-card.privolzhsk h3 {
  color: var(--success);
}

.jurisdiction-card h3 {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

/* ==================== СЕТКА ДЛЯ БАЗЫ НАРУШИТЕЛЕЙ ==================== */
.violators-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
}

.violators-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.5rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.evidence-link {
  color: var(--accent-red);
  text-decoration: none;
  background: var(--black-quaternary);
  padding: 0.5rem 1rem;
  border-radius: var(--radius-sm);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  transition: all var(--transition-fast);
  border: 1px solid var(--border-primary);
}

.evidence-link:hover {
  background: var(--accent-red);
  color: white;
  transform: translateY(-2px);
  border-color: var(--accent-red);
  box-shadow: 0 4px 16px var(--glow-primary);
}

.violator-card-footer {
  background: var(--black-tertiary);
  padding: 1rem 1.5rem;
  border-top: 1px solid var(--border-primary);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.violator-meta {
  font-size: 0.8rem;
  color: var(--text-tertiary);
}

.violator-date {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.violator-actions {
  display: flex;
  gap: 0.5rem;
}

/* ==================== НОВОГОДНЕЕ ОФОРМЛЕНИЕ ==================== */
.newyear-banner {
  background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
  color: white;
  text-align: center;
  padding: 0.75rem;
  font-weight: bold;
  font-size: 0.9rem;
  position: relative;
  z-index: 100;
  box-shadow: 0 4px 16px var(--glow-primary);
}

.newyear-banner::before,
.newyear-banner::after {
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}

.snow-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1; /* Отрицательный z-index помещает под всё */
  overflow: hidden;
}


.snowflake {
  position: absolute;
  top: -10px;
  color: white;
  font-size: 1em;
  text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
  animation-name: snowFall;
  animation-timing-function: linear;
  animation-iteration-count: infinite;
  opacity: 0.6; /* Добавляем полупрозрачность для лучшей читаемости */
}

@keyframes snowFall {
  0% {
    transform: translateY(0) translateX(0) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(100vh) translateX(20px) rotate(360deg);
    opacity: 0;
  }
}

/* ==================== СТИЛИ ДЛЯ РУКОВОДСТВА ==================== */
.leadership-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.leader-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  background: var(--black-tertiary);
  padding: 0.5rem 1rem;
  border-radius: var(--radius-sm);
  font-size: 0.85rem;
  font-weight: 600;
  margin-top: 0.5rem;
  border: 1px solid var(--border-primary);
}

.leader-badge.creator {
  background: linear-gradient(135deg, var(--warning), var(--accent-orange));
  color: var(--black-primary);
  border-color: var(--accent-orange);
}

.leader-badge.general {
  background: linear-gradient(135deg, var(--accent-red), #ff3838);
  color: white;
  border-color: var(--accent-red);
}

.leader-badge.colonel {
  background: linear-gradient(135deg, var(--accent-purple), #8e44ad);
  color: white;
  border-color: var(--accent-purple);
}

/* ==================== СИСТЕМА УВЕДОМЛЕНИЙ ==================== */
.notifications-container {
  position: fixed;
  top: 1rem;
  right: 1rem;
  z-index: 3000;
  max-width: 400px;
  width: 100%;
}

.notification {
  background: var(--black-tertiary);
  border-radius: var(--radius-md);
  padding: 1rem;
  margin-bottom: 0.75rem;
  box-shadow: 0 8px 32px var(--shadow-medium);
  border-left: 4px solid var(--accent-red);
  animation: slideInRight 0.3s ease-out;
  position: relative;
  overflow: hidden;
  border: 1px solid var(--border-primary);
}

.notification::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
}

.notification.success {
  border-left-color: var(--success);
}

.notification.success::before {
  background: linear-gradient(90deg, var(--success), #1dd1a1);
}

.notification.warning {
  border-left-color: var(--warning);
}

.notification.warning::before {
  background: linear-gradient(90deg, var(--warning), #ff9f43);
}

.notification.error {
  border-left-color: var(--danger);
}

.notification.error::before {
  background: linear-gradient(90deg, var(--danger), #ff3838);
}

.notification.info {
  border-left-color: var(--accent-purple);
}

.notification.info::before {
  background: linear-gradient(90deg, var(--accent-purple), #8e44ad);
}

.notification-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.notification-title {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-weight: 600;
  font-size: 1rem;
}

.notification-close {
  background: none;
  border: none;
  color: var(--text-tertiary);
  cursor: pointer;
  padding: 0.25rem;
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
}

.notification-close:hover {
  background: var(--overlay-light);
  color: var(--text-primary);
}

.notification-content {
  color: var(--text-primary);
  line-height: 1.5;
  font-size: 0.9rem;
}

.notification-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: var(--accent-red);
  animation: progressBar 5s linear forwards;
}

.notification.success .notification-progress {
  background: var(--success);
}

.notification.warning .notification-progress {
  background: var(--warning);
}

.notification.error .notification-progress {
  background: var(--danger);
}

.notification.info .notification-progress {
  background: var(--accent-purple);
}

@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes progressBar {
  from {
    width: 100%;
  }
  to {
    width: 0%;
  }
}

/* ==================== ТЕСТЫ ПДД ==================== */
.pdd-test-container {
  max-width: 800px;
  margin: 0 auto;
}

.test-progress {
  background: var(--black-quaternary);
  padding: 1.5rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  margin-bottom: 1.5rem;
}

.progress-bar {
  height: 8px;
  background: var(--gray-darkest);
  border-radius: var(--radius-full);
  overflow: hidden;
  margin-top: 0.75rem;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
  border-radius: var(--radius-full);
  transition: width 0.3s ease;
}

.test-question {
  background: var(--black-tertiary);
  padding: 2rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  margin-bottom: 1.5rem;
}

.question-text {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
  line-height: 1.5;
}

.answers-grid {
  display: grid;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.answer-option {
  background: var(--black-quaternary);
  padding: 1rem;
  border-radius: var(--radius-sm);
  border: 2px solid var(--border-primary);
  cursor: pointer;
  transition: all var(--transition-fast);
  display: flex;
  align-items: center;
  gap: 1rem;
}

.answer-option:hover {
  border-color: var(--accent-red);
  background: var(--overlay-light);
}

.answer-option.selected {
  border-color: var(--accent-red);
  background: var(--overlay-medium);
}

.answer-option.correct {
  border-color: var(--success);
  background: rgba(46, 213, 115, 0.1);
}

.answer-option.incorrect {
  border-color: var(--danger);
  background: rgba(255, 71, 87, 0.1);
}

.answer-checkbox {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border-primary);
  border-radius: var(--radius-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.answer-option.selected .answer-checkbox,
.answer-option.correct .answer-checkbox,
.answer-option.incorrect .answer-checkbox {
  background: var(--accent-red);
  border-color: var(--accent-red);
}

.answer-option.selected .answer-checkbox::before,
.answer-option.correct .answer-checkbox::before,
.answer-option.incorrect .answer-checkbox::before {
  content: '✓';
  color: white;
  font-size: 0.8rem;
}

.answer-text {
  flex: 1;
  font-weight: 500;
}

.test-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 1.5rem;
}

.test-results {
  background: var(--black-tertiary);
  padding: 2rem;
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  text-align: center;
}

.results-score {
  font-size: 3rem;
  font-weight: 700;
  color: var(--accent-red);
  margin-bottom: 1rem;
}

.results-message {
  font-size: 1.2rem;
  margin-bottom: 1.5rem;
  color: var(--text-primary);
}

.results-details {
  background: var(--black-quaternary);
  padding: 1.5rem;
  border-radius: var(--radius-md);
  margin-top: 1.5rem;
  text-align: left;
}

.result-item {
  padding: 1rem;
  border-bottom: 1px solid var(--border-primary);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.result-item:last-child {
  border-bottom: none;
}

.result-question {
  flex: 1;
  font-weight: 500;
  color: var(--text-primary);
}

.result-status {
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-full);
  font-size: 0.9rem;
  font-weight: 600;
}

.result-status.correct {
  background: var(--success);
  color: white;
}

.result-status.incorrect {
  background: var(--danger);
  color: white;
}

.koap-note {
  background: linear-gradient(135deg, rgba(255, 165, 2, 0.1), rgba(255, 165, 2, 0.05));
  padding: 1rem;
  border-radius: var(--radius-md);
  margin-top: 1rem;
  border-left: 4px solid var(--warning);
}

.koap-note h4 {
  color: var(--warning);
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.koap-note p {
  color: var(--warning);
  margin: 0.25rem 0;
  font-size: 0.95rem;
}

/* ==================== ОЧАГИ НАРУШЕНИЙ ==================== */
.hotspots-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.hotspot-card {
  background: var(--black-quaternary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  padding: 1.5rem;
  transition: all var(--transition-medium);
  position: relative;
  overflow: hidden;
}

.hotspot-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
}

.hotspot-card:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--shadow-medium);
}

.hotspot-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.hotspot-icon {
  width: 50px;
  height: 50px;
  background: var(--overlay-medium);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: var(--accent-red);
}

.hotspot-title h3 {
  color: var(--text-primary);
  margin-bottom: 0.25rem;
  font-size: 1.1rem;
}

.hotspot-id {
  font-size: 0.8rem;
  color: var(--text-tertiary);
}

.hotspot-info {
  margin-bottom: 1rem;
}

.hotspot-label {
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 0.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.hotspot-value {
  color: var(--text-primary);
  line-height: 1.5;
}

/* ==================== АВТОПАРК ==================== */
.fleet-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.fleet-card {
  background: var(--black-quaternary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  padding: 1.5rem;
  transition: all var(--transition-medium);
  position: relative;
  overflow: hidden;
}

.fleet-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
}

.fleet-card:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--shadow-medium);
}

.fleet-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.fleet-icon {
  width: 50px;
  height: 50px;
  background: var(--overlay-medium);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  color: var(--accent-red);
}

.fleet-title h3 {
  color: var(--text-primary);
  margin-bottom: 0.25rem;
  font-size: 1.1rem;
}

.fleet-id {
  font-size: 0.8rem;
  color: var(--text-tertiary);
}

.fleet-info {
  margin-bottom: 1rem;
}

.fleet-label {
  font-weight: 600;
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 0.25rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.fleet-value {
  color: var(--text-primary);
  line-height: 1.5;
}

/* ==================== ОТЫГРОВКИ ==================== */
.roleplay-categories {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.roleplay-category {
  background: var(--black-quaternary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  padding: 1.5rem;
  transition: all var(--transition-medium);
}

.roleplay-category:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--shadow-medium);
}

.roleplay-category h3 {
  color: var(--text-primary);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.roleplay-item {
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px dashed var(--border-primary);
}

.roleplay-item:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.roleplay-content {
  flex: 1;
}

.roleplay-key {
  display: inline-block;
  background: var(--black-tertiary);
  color: var(--text-primary);
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-sm);
  font-family: 'Courier New', monospace;
  font-weight: 600;
  margin-right: 0.5rem;
  border: 1px solid var(--border-primary);
}

.roleplay-description {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-top: 0.5rem;
  line-height: 1.5;
}

/* ==================== ГАЙДЫ ==================== */
.guides-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.guide-category {
  background: var(--black-quaternary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  padding: 1.5rem;
  transition: all var(--transition-medium);
}

.guide-category:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--shadow-medium);
}

.guide-category h3 {
  color: var(--text-primary);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.1rem;
}

.guide-item {
  margin-bottom: 1rem;
  padding-bottom: 1rem;
  border-bottom: 1px dashed var(--border-primary);
}

.guide-item:last-child {
  margin-bottom: 0;
  padding-bottom: 0;
  border-bottom: none;
}

.guide-content {
  flex: 1;
}

.guide-key {
  display: inline-block;
  background: var(--black-tertiary);
  color: var(--text-primary);
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-sm);
  font-family: 'Courier New', monospace;
  font-weight: 600;
  margin-right: 0.5rem;
  border: 1px solid var(--border-primary);
}

.guide-description {
  font-size: 0.9rem;
  color: var(--text-secondary);
  margin-top: 0.5rem;
  line-height: 1.5;
}

/* ==================== КАРТА ==================== */
.map-container {
  text-align: center;
  margin: 1.5rem 0;
}

.map-image {
  max-width: 100%;
  border-radius: var(--radius-md);
  box-shadow: 0 8px 32px var(--shadow-medium);
  margin-bottom: 1.5rem;
}

.map-description {
  background: var(--black-quaternary);
  padding: 1.5rem;
  border-radius: var(--radius-md);
  border-left: 4px solid var(--accent-red);
  margin-top: 1.5rem;
  text-align: left;
}

.map-description h3 {
  color: var(--text-primary);
  margin-bottom: 0.75rem;
}

.map-description p {
  color: var(--text-secondary);
  line-height: 1.6;
}

/* ==================== СТАТИСТИКА ==================== */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.stat-card {
  background: var(--black-quaternary);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-primary);
  padding: 1.5rem;
  text-align: center;
  transition: all var(--transition-medium);
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent-red), var(--accent-orange));
}

.stat-card:hover {
  border-color: var(--border-accent);
  transform: translateY(-4px);
  box-shadow: 0 8px 32px var(--shadow-medium);
}

.stat-card h3 {
  color: var(--text-secondary);
  margin-bottom: 0.75rem;
  font-size: 1rem;
}

.stat-card .value {
  font-size: 2rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0.5rem 0;
}

.stat-card .label {
  color: var(--text-tertiary);
  font-size: 0.85rem;
  margin-bottom: 1rem;
}

.stat-controls {
  display: flex;
  gap: 0.5rem;
  margin-top: 1rem;
  justify-content: center;
}

.stat-controls button {
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  font-weight: 600;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-primary);
  background: var(--black-tertiary);
  color: var(--text-primary);
  cursor: pointer;
  transition: all var(--transition-fast);
}

.stat-controls button:hover {
  background: var(--overlay-medium);
  border-color: var(--accent-red);
}

.stat-controls .btn-success:hover {
  background: var(--success);
  color: white;
}

.stat-controls .btn-danger:hover {
  background: var(--danger);
  color: white;
}

/* ==================== VK АВТОРИЗАЦИЯ ==================== */
.vk-auth-section {
  text-align: center;
  padding: 1rem;
  margin-top: 1rem;
  border-top: 1px solid var(--border-primary);
}

.vk-auth-btn {
  background: linear-gradient(135deg, #4a76a8, #5d88b3) !important;
  color: white !important;
  border: none !important;
  padding: 0.75rem 1.5rem !important;
  border-radius: var(--radius-md) !important;
  font-weight: 600 !important;
  display: inline-flex !important;
  align-items: center !important;
  gap: 0.5rem !important;
  transition: all var(--transition-medium) !important;
  box-shadow: 0 4px 20px rgba(74, 118, 168, 0.3) !important;
}

.vk-auth-btn:hover {
  transform: translateY(-2px) !important;
  box-shadow: 0 6px 24px rgba(74, 118, 168, 0.4) !important;
  background: linear-gradient(135deg, #5d88b3, #6a96c0) !important;
}

.vk-user-card {
  background: linear-gradient(135deg, var(--black-quaternary), var(--black-tertiary));
  border-radius: var(--radius-md);
  padding: 1.5rem;
  margin: 1rem 0;
  border: 1px solid var(--border-primary);
  text-align: center;
}

.vk-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  margin: 0 auto 1rem;
  border: 3px solid var(--accent-red);
  overflow: hidden;
}

.vk-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.vk-user-name {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
  color: var(--text-primary);
}

.vk-user-email {
  color: var(--text-tertiary);
  font-size: 0.9rem;
  margin-bottom: 1rem;
}

.vk-error {
  background: var(--danger);
  color: white;
  padding: 0.75rem 1rem;
  border-radius: var(--radius-md);
  margin: 0.5rem 0;
  font-size: 0.9rem;
}

/* ==================== АДАПТИВНОСТЬ ==================== */
@media (max-width: 768px) {
  .container {
    padding: 0 1rem;
  }
  
  .dashboard {
    gap: 1rem;
    padding: 1rem 0;
  }
  
  .header-content {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .header-controls {
    justify-content: center;
  }
  
  .nav-tabs {
    padding: 0.25rem 0;
  }
  
  .nav-tabs a {
    padding: 0.75rem 1rem;
    font-size: 0.9rem;
  }
  
  .content-section {
    padding: 1.5rem;
  }
  
  .binds-categories,
  .commands-grid,
  .documents-grid,
  .weapon-grid,
  .jurisdiction-info,
  .violators-grid,
  .leadership-grid,
  .hotspots-grid,
  .fleet-grid,
  .roleplay-categories,
  .guides-grid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  .admin-controls,
  .settings-grid {
    grid-template-columns: 1fr;
  }
  
  .profile-info {
    grid-template-columns: 1fr;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .violator-card-header,
  .leader-card-header {
    flex-direction: column;
    text-align: center;
    gap: 1rem;
  }
  
  .violator-avatar,
  .leader-avatar {
    width: 50px;
    height: 50px;
    font-size: 1.2rem;
  }
  
  .violator-actions,
  .leader-actions {
    flex-direction: column;
    width: 100%;
  }
  
  .violator-actions button,
  .leader-actions button {
    width: 100%;
  }
  
  .footer-content {
    grid-template-columns: 1fr;
    text-align: center;
  }
  
  .footer-links a {
    justify-content: center;
  }
  
  .modal-content {
    margin: 0.5rem;
  }
  
  .notifications-container {
    left: 0.5rem;
    right: 0.5rem;
    max-width: none;
  }
}

@media (max-width: 480px) {
  html {
    font-size: 14px;
  }
  
  h1 {
    font-size: 2rem;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  .logo-icon {
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
  }
  
  .logo-text h1 {
    font-size: 1.2rem;
  }
  
  .user-profile {
    padding: 0.5rem;
  }
  
  .user-avatar {
    width: 35px;
    height: 35px;
    font-size: 0.9rem;
  }
  
  .content-section {
    padding: 1rem;
  }
  
  .btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .table {
    font-size: 0.9rem;
  }
  
  .table th,
  .table td {
    padding: 0.75rem;
  }
}

/* ==================== TOUCH УСТРОЙСТВА ==================== */
@media (hover: none) and (pointer: coarse) {
  .nav-tabs a,
  .btn,
  .btn-copy,
  .links-list a,
  .rank-option {
    min-height: 44px;
    min-width: 44px;
  }
  
  .form-control,
  textarea,
  input,
  select {
    font-size: 16px;
  }
  
  .nav-tabs a:hover,
  .btn:hover,
  .btn-copy:hover,
  .links-list a:hover,
  .rank-option:hover,
  .violator-card:hover,
  .leader-card:hover,
  .bind-category:hover,
  .command-card:hover,
  .document-card:hover,
  .weapon-card:hover,
  .radio-category:hover,
  .jurisdiction-card:hover,
  .setting-card:hover,
  .admin-card:hover,
  .profile-card:hover,
  .stats-card:hover,
  .quick-links:hover,
  .hotspot-card:hover,
  .fleet-card:hover,
  .guide-category:hover,
  .stat-card:hover {
    transform: none;
  }
}

/* ==================== IOS СПЕЦИФИКА ==================== */
@supports (-webkit-touch-callout: none) {
  .form-control,
  textarea {
    font-size: 16px;
  }
  
  body {
    -webkit-font-smoothing: antialiased;
  }
}

/* ==================== УЛУЧШЕННЫЙ СКРОЛЛБАР ==================== */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--black-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--gray-dark);
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gray-medium);
}

/* ==================== УБРАТЬ ВЫДЕЛЕНИЕ ПРИ КЛИКЕ НА МОБИЛЬНЫХ ==================== */
* {
  -webkit-tap-highlight-color: transparent;
}

/* ==================== АНИМАЦИЯ ПОЯВЛЕНИЯ ==================== */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in-up {
  animation: fadeInUp 0.6s ease-out;
}

/* ==================== ЗАГРУЗКА ==================== */
.loading {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid var(--overlay-light);
  border-radius: 50%;
  border-top-color: var(--accent-red);
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

/* ==================== ПОСЛЕДНИЕ ШТРИХИ ==================== */
::selection {
  background: var(--accent-red);
  color: white;
}

:-moz-focusring {
  outline: 2px solid var(--accent-red);
  outline-offset: 2px;
}

:focus:not(:focus-visible) {
  outline: none;
}

:focus-visible {
  outline: 2px solid var(--accent-red);
  outline-offset: 2px;
}
/* ==================== HEADER С ПОИСКОМ ПО ЦЕНТРУ ==================== */
.header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
}

.logo {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-shrink: 0;
    min-width: 250px;
}

.header-search {
    flex: 1;
    max-width: 500px;
    margin: 0 1rem;
}

.header-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-shrink: 0;
}

/* Стили для поиска */
.simple-search-container {
    position: relative;
    width: 100%;
}

.simple-search-input {
    width: 100%;
    padding: 10px 40px 10px 15px;
    background: var(--black-quaternary);
    border: 1px solid var(--border-primary);
    border-radius: 25px;
    color: var(--text-primary);
    font-size: 15px;
    outline: none;
    transition: all 0.3s;
}

.simple-search-input:focus {
    border-color: var(--accent-red);
    box-shadow: 0 0 0 3px var(--glow-primary);
}

.simple-search-input::placeholder {
    color: var(--text-tertiary);
}

.simple-search-clear {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 16px;
    padding: 4px;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s;
}

.simple-search-clear:hover {
    background: var(--overlay-light);
    color: var(--accent-red);
}

/* Панель результатов поиска */
.search-results-panel {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: var(--black-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    max-height: 450px;
    overflow-y: auto;
    display: none;
    z-index: 1000;
}

.search-results-panel.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

.search-results-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-primary);
    color: var(--text-primary);
    font-size: 14px;
    font-weight: 600;
}

.search-tab-result {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-primary);
    cursor: pointer;
    transition: all 0.2s;
}

.search-tab-result:hover {
    background: var(--overlay-light);
    transform: translateX(5px);
}

.search-tab-result:last-child {
    border-bottom: none;
}

.search-tab-result .tab-name {
    color: var(--text-primary);
    font-weight: 500;
    font-size: 14px;
}

.search-tab-result .tab-matches {
    background: var(--accent-red);
    color: white;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    min-width: 60px;
    text-align: center;
}

.search-show-all {
    width: 100%;
    padding: 14px 16px;
    background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
    color: white;
    border: none;
    border-radius: 0 0 12px 12px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.2s;
}

.search-show-all:hover {
    background: linear-gradient(135deg, #ff3838, #ff793f);
}

.search-no-results {
    padding: 40px 20px;
    text-align: center;
    color: var(--text-tertiary);
}

.search-no-results i {
    font-size: 32px;
    margin-bottom: 15px;
    opacity: 0.5;
}

.search-no-results div {
    font-size: 16px;
    margin-bottom: 5px;
}

.search-no-results small {
    font-size: 13px;
}

/* Подсветка найденного текста */
.search-match {
    background-color: #ffeb3b !important;
    color: #000 !important;
    padding: 0 3px !important;
    border-radius: 3px !important;
    font-weight: bold !important;
}

/* Адаптивность */
@media (max-width: 1200px) {
    .header-search {
        max-width: 400px;
    }
}

@media (max-width: 992px) {
    .header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .header-search {
        order: 3;
        max-width: 100%;
        margin: 0.5rem 0;
    }
    
    .logo {
        min-width: auto;
    }
}

@media (max-width: 768px) {
    .search-results-panel {
        position: fixed;
        top: 140px;
        left: 15px;
        right: 15px;
        max-height: 350px;
    }
    
    .simple-search-input {
        padding: 10px 40px 10px 15px;
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .simple-search-input {
        padding: 8px 35px 8px 12px;
        font-size: 13px;
    }
    
    .search-results-panel {
        top: 130px;
        left: 10px;
        right: 10px;
    }
}

    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-shield"></i> Авторизация</h2>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <div class="auth-tab active" onclick="showAuthForm('login')"><i class="fas fa-sign-in-alt"></i> Вход</div>
                    <div class="auth-tab" onclick="showAuthForm('register')"><i class="fas fa-user-plus"></i> Регистрация</div>
                </div>
                
                <form id="loginForm" class="auth-form active">
                    <div class="form-group">
                        <label for="loginUsername"><i class="fas fa-user"></i> Логин или Email</label>
                        <input type="text" id="loginUsername" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword"><i class="fas fa-lock"></i> Пароль</label>
                        <input type="password" id="loginPassword" class="form-control" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> Войти</button>
                </form>
                
                <form id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label for="registerNickname"><i class="fas fa-id-card"></i> Игровой ник</label>
                        <input type="text" id="registerNickname" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerUsername"><i class="fas fa-user"></i> Логин</label>
                        <input type="text" id="registerUsername" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail"><i class="fas fa-envelope"></i> Email</label>
                        <input type="email" id="registerEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword"><i class="fas fa-lock"></i> Пароль</label>
                        <input type="password" id="registerPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword"><i class="fas fa-lock"></i> Подтвердите пароль</label>
                        <input type="password" id="registerConfirmPassword" class="form-control" required>
                    </div>
                    <button type="submit" class="btn" style="width: 100%;"><i class="fas fa-user-plus"></i> Зарегистрироваться</button>
                </form>
<!-- В authModal, после форм входа/регистрации -->
<div class="vk-auth-section">
    <p style="margin-bottom: 15px; color: var(--gray); font-size: 0.9rem;">Быстрый вход через VK ID</p>
    <button class="btn vk-auth-btn" onclick="startVKAuth()">
        <i class="fab fa-vk"></i>
        <span>Войти через VK</span>
    </button>
    <div id="vkAuthStatus" style="margin-top: 10px;"></div>
</div>
            </div>
        </div>
    </div>

    <!-- Модальное окно смены пароля -->
    <div id="changePasswordModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2><i class="fas fa-lock"></i> Смена пароля</h2>
            </div>
            <div class="modal-body">
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword"><i class="fas fa-lock"></i> Текущий пароль</label>
                        <input type="password" id="currentPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword"><i class="fas fa-key"></i> Новый пароль</label>
                        <input type="password" id="newPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword"><i class="fas fa-key"></i> Подтвердите новый пароль</label>
                        <input type="password" id="confirmNewPassword" class="form-control" required>
                    </div>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;"><i class="fas fa-save"></i> Сохранить</button>
                        <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('changePasswordModal')"><i class="fas fa-times"></i> Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно смены никнейма -->
    <div id="changeNicknameModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2><i class="fas fa-user-edit"></i> Смена никнейма</h2>
            </div>
            <div class="modal-body">
                <form id="changeNicknameForm">
                    <div class="form-group">
                        <label for="newNickname"><i class="fas fa-signature"></i> Новый никнейм</label>
                        <input type="text" id="newNickname" class="form-control" required>
                    </div>
                    <div id="nicknameTarget" style="display: none;">
                        <div class="form-group">
                            <label for="targetUser">Для пользователя</label>
                            <select id="targetUser" class="form-control">
                                <!-- Заполнится JavaScript -->
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;"><i class="fas fa-save"></i> Сохранить</button>
                        <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('changeNicknameModal')"><i class="fas fa-times"></i> Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно выбора звания и должности -->
    <div id="rankPositionModal" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2><i class="fas fa-user-tie"></i> Выбор звания и должности</h2>
            </div>
            <div class="modal-body">
                <form id="rankPositionForm">
                    <div id="rankPositionTarget" style="display: none;">
                        <div class="form-group">
                            <label for="targetUserRank">Для пользователя</label>
                            <select id="targetUserRank" class="form-control">
                                <!-- Заполнится JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="selectedRank"><i class="fas fa-star"></i> Звание</label>
                        <div class="rank-grid">
                            <div class="rank-option" data-rank="Рядовой" onclick="selectRank('Рядовой')">Рядовой</div>
                            <div class="rank-option" data-rank="Сержант" onclick="selectRank('Сержант')">Сержант</div>
                            <div class="rank-option" data-rank="Старшина" onclick="selectRank('Старшина')">Старшина</div>
                            <div class="rank-option" data-rank="Прапорщик" onclick="selectRank('Прапорщик')">Прапорщик</div>
                            <div class="rank-option" data-rank="Лейтенант" onclick="selectRank('Лейтенант')">Лейтенант</div>
                            <div class="rank-option" data-rank="Старший лейтенант" onclick="selectRank('Старший лейтенант')">Ст. лейтенант</div>
                            <div class="rank-option" data-rank="Капитан" onclick="selectRank('Капитан')">Капитан</div>
                            <div class="rank-option" data-rank="Майор" onclick="selectRank('Майор')">Майор</div>
                        </div>
                        <input type="hidden" id="selectedRank" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="positionInput"><i class="fas fa-briefcase"></i> Должность</label>
                        <input type="text" id="positionInput" class="form-control" placeholder="Например: Инспектор ДПС" required>
                    </div>
                    
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;"><i class="fas fa-save"></i> Сохранить</button>
                        <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('rankPositionModal')"><i class="fas fa-times"></i> Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Модальное окно редактирования статистики -->
    <div id="editStatsModal" class="modal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2><i class="fas fa-chart-bar"></i> Редактирование статистики</h2>
            </div>
            <div class="modal-body">
                <form id="editStatsForm">
                    <div class="form-group">
                        <label for="statsUser">Пользователь</label>
                        <select id="statsUser" class="form-control" required>
                            <!-- Заполнится JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="editFines">Выдано штрафов</label>
                        <input type="number" id="editFines" class="form-control" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editArrests">Задержано преступников</label>
                        <input type="number" id="editArrests" class="form-control" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editLicenses">Изъято прав</label>
                        <input type="number" id="editLicenses" class="form-control" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editSearches">Проведено досмотров</label>
                        <input type="number" id="editSearches" class="form-control" min="0" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="editRating">Общий рейтинг</label>
                        <input type="number" id="editRating" class="form-control" required>
                    </div>
                    
                    <div class="form-group" style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;"><i class="fas fa-save"></i> Сохранить</button>
                        <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('editStatsModal')"><i class="fas fa-times"></i> Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

<header>
    <div class="container">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">🚓</div>
                <div class="logo-text">
                    <h1>ГИБДД Республики Провинция</h1>
                    <p>Официальный сайт дорожно-патрульной службы</p>
                </div>
            </div>
            
            <!-- ПОИСК ПО ЦЕНТРУ -->
            <div class="header-search">
                <div class="simple-search-container">
                    <input type="text" 
                           id="simpleSearch" 
                           class="simple-search-input" 
                           placeholder="Поиск по всем разделам...">
                    <button class="simple-search-clear" onclick="clearSimpleSearch()">
                        ✕
                    </button>
                    <div id="searchResultsPanel" class="search-results-panel"></div>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle" title="Переключить тему">🌙</button>
                <div class="user-profile" id="userProfile" onclick="toggleProfileForm()">
                    <div class="user-avatar">?</div>
                    <div class="user-info">
                        <div class="user-name">Гость</div>
                        <div class="user-rank">Не авторизован</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
    
    <!-- Navigation -->
    <nav>
        <div class="container">
            <ul class="nav-tabs">
                <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Главная</a></li>
                <li><a href="#" onclick="showSection('binds')"><i class="fas fa-keyboard"></i> Бинды</a></li>
                <li><a href="#" onclick="showSection('commands')"><i class="fas fa-terminal"></i> Команды</a></li>
                <li><a href="#" onclick="showSection('documents')"><i class="fas fa-file-alt"></i> Документы</a></li>
                <li><a href="#" onclick="showSection('leadership')"><i class="fas fa-user-tie"></i> Начальство</a></li>
                <li><a href="#" onclick="showSection('weapon')"><i class="fas fa-shield-alt"></i> Табельное оружие и снаряжение</a></li>
                <li><a href="#" onclick="showSection('radio')"><i class="fas fa-walkie-talkie"></i> Регламент радиообмена</a></li>
                <li><a href="#" onclick="showSection('jurisdiction')"><i class="fas fa-map-marked-alt"></i> Юрисдикции МВД</a></li>
                <li><a href="#" onclick="showSection('roleplay')"><i class="fas fa-comment-medical"></i> Полезные отыгровки</a></li>
                <li><a href="#" onclick="showSection('map')"><i class="fas fa-map"></i> Карта постов</a></li>
                <li><a href="#" onclick="showSection('fleet')"><i class="fas fa-car"></i> Автопарк</a></li>
                <li><a href="#" onclick="showSection('violators')"><i class="fas fa-database"></i> База нарушителей</a></li>
                <li><a href="#" onclick="showSection('pdd-tests')"><i class="fas fa-graduation-cap"></i> Тесты ПДД</a></li>
                <li><a href="#" onclick="showSection('hotspots')"><i class="fas fa-map-marker-alt"></i> Очаги нарушений</a></li>
<li><a href="#" onclick="showSection('guides')"><i class="fas fa-book-open"></i> Мини гайды</a></li>
                <li><a href="#" onclick="showSection('statistics')"><i class="fas fa-chart-bar"></i> Статистика</a></li>
                <li><a href="#" onclick="showSection('leaderboard')"><i class="fas fa-trophy"></i> Таблица лидеров</a></li>
                <li><a href="#" onclick="showSection('profile-settings')"><i class="fas fa-user-cog"></i> Настройки профиля</a></li>
                <li><a href="#" onclick="showSection('profile')" id="profileTab"><i class="fas fa-user"></i> Профиль</a></li>
                <li><a href="#" onclick="showSection('settings')" id="settingsTab"><i class="fas fa-cog"></i> Настройки</a></li>
                <li><a href="#" onclick="showSection('admin')" id="adminTab" style="display:none;"><i class="fas fa-cogs"></i> Админ-панель</a></li>
            </ul>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="container">
        <div class="dashboard">
            <div class="main-content">
                <!-- Dashboard Section -->
                <section id="dashboard-section" class="content-section">
                    <div class="section-title">
                        <i class="fas fa-tachometer-alt"></i>
                        <h2>Панель управления</h2>
                    </div>
                    <p>Добро пожаловать на официальный сайт ГИБДД Республики Провинция. Здесь вы найдете всю необходимую информацию для эффективной службы в дорожно-патрульной службе.</p>
                    
                    <div class="binds-categories" style="margin-top: 30px;">
                        <div class="bind-category">
                            <h3><i class="fas fa-id-card"></i> Основные бинды</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">1</span>
                                    <span>Представление инспектора</span>
                                </div>
                                <button class="btn-copy" onclick="copyBind('1')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">3</span>
                                    <span>Требование документов</span>
                                </div>
                                <button class="btn-copy" onclick="copyBind('3')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">HOME</span>
                                    <span>Приветствие с коллегами</span>
                                </div>
                                <button class="btn-copy" onclick="copyBind('HOME')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <div class="bind-category">
                            <h3><i class="fas fa-traffic-light"></i> Остановка ТС</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">9</span>
                                    <span>Требование об остановке ТС</span>
                                </div>
                                <button class="btn-copy" onclick="copyBind('9')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">0</span>
                                    <span>Повторное требование</span>
                                </div>
                                <button class="btn-copy" onclick="copyBind('0')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="profile-settings-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-user-cog"></i>
        <h2>Настройки профиля</h2>
    </div>
    
    <div class="profile-edit-section">
        <h3><i class="fas fa-user-edit"></i> Редактирование профиля</h3>
        
        <div class="avatar-upload">
            <div class="avatar-preview" id="avatarPreview">
                <i class="fas fa-user"></i>
            </div>
            <div class="avatar-controls">
                <label class="btn btn-outline" for="avatarInput">
                    <i class="fas fa-upload"></i> Загрузить аватар
                </label>
                <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                <button class="btn btn-outline" onclick="removeAvatar()">
                    <i class="fas fa-trash"></i> Удалить аватар
                </button>
                <p style="margin-top: 10px; font-size: 0.9rem; color: var(--gray);">
                    Рекомендуемый размер: 200x200px
                </p>
            </div>
        </div>
        
        <div class="form-group">
            <label for="profileDescription"><i class="fas fa-align-left"></i> Описание профиля</label>
            <textarea id="profileDescription" class="form-control" rows="4" placeholder="Расскажите о себе..."></textarea>
        </div>
        
        <div class="form-group">
            <label for="profileStatus"><i class="fas fa-circle"></i> Статус</label>
            <input type="text" id="profileStatus" class="form-control" placeholder="Ваш текущий статус...">
        </div>
        
        <div class="form-group">
            <button class="btn btn-success" onclick="saveProfileSettings()">
                <i class="fas fa-save"></i> Сохранить изменения
            </button>
        </div>
    </div>
</section>
                <!-- Hotspots Section -->
<section id="hotspots-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-map-marker-alt"></i>
        <h2>Очаги нарушений ПДД</h2>
    </div>
    <p>Статистика и информация о местах, где наиболее часто фиксируются нарушения правил дорожного движения.</p>
    
    <div class="violators-grid">
        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-road"></i>
                </div>
                <div class="violator-name">
                    <h3>Кольцо у авторынка</h3>
                    <div class="violator-id">Очаг №1</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Высокая активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Проезд по встречной полосе движения</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Множество водителей регулярно нарушают</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-lightbulb"></i>
                        Рекомендации:
                    </div>
                    <div class="violator-value">Усилить патрулирование, установить дополнительные знаки</div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-traffic-light"></i>
                </div>
                <div class="violator-name">
                    <h3>Светофоры у ТТУ</h3>
                    <div class="violator-id">Очаг №2</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Высокая активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Проезд на красный сигнал светофора</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Множество людей проезжают на красный</div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-traffic-light"></i>
                </div>
                <div class="violator-name">
                    <h3>Светофоры у Вива Лэнда</h3>
                    <div class="violator-id">Очаг №3</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Средняя активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Проезд на красный сигнал светофора</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Множество людей проезжают на красный</div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-traffic-light"></i>
                </div>
                <div class="violator-name">
                    <h3>Светофор на перекрестке у ТК</h3>
                    <div class="violator-id">Очаг №4</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Высокая активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Проезд на красный сигнал светофора</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Большинство людей проезжают на красный</div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="violator-name">
                    <h3>Магазин "Лента"</h3>
                    <div class="violator-id">Очаг №5</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Сезонная активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Дрифт, опасное вождение</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Достаточно часто там дрифтят, особенно зимой</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-snowflake"></i>
                        Сезонность:
                    </div>
                    <div class="violator-value">Активность возрастает в зимний период</div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-train"></i>
                </div>
                <div class="violator-name">
                    <h3>Парковка у Вокзала</h3>
                    <div class="violator-id">Очаг №6</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Постоянная активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Дрифт, несанкционированные сходки</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Достаточно часто там дрифтят, делают сходки</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-users"></i>
                        Особенность:
                    </div>
                    <div class="violator-value">Массовые несанкционированные мероприятия</div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-flag-checkered"></i>
                </div>
                <div class="violator-name">
                    <h3>Парковка у гоночного трека</h3>
                    <div class="violator-id">Очаг №7</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-exclamation-triangle"></i>
                    Регулярная активность
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-car-crash"></i>
                        Основное нарушение:
                    </div>
                    <div class="violator-value">Массовые сходки, нарушение ПДД</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-chart-line"></i>
                        Статистика:
                    </div>
                    <div class="violator-value">Часто делают массовые сходки и нарушают ПДД</div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-calendar"></i>
                        Периодичность:
                    </div>
                    <div class="violator-value">Регулярные мероприятия по вечерам</div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Замените существующую секцию автопарка на эту -->
<section id="fleet-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-car"></i>
        <h2>Автопарк ГИБДД</h2>
    </div>
    <p>Служебные транспортные средства, доступные для использования сотрудниками ДПС ОГИБДД.</p>
    
    <div class="violators-grid">
        <!-- Патрульные автомобили -->
        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-car-side"></i>
                </div>
                <div class="violator-name">
                    <h3>LADA Vesta</h3>
                    <div class="violator-id">Патрульный автомобиль</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 8 сек<br>
                        • Макс. скорость: 193 км/ч<br>
                        • Класс: Седан<br>
                        • Привод: передний
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Проблесковые маячки<br>
                        • Громкоговоритель<br>
                        • Радиостанция<br>
                        • Видеорегистратор
                    </div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-car-side"></i>
                </div>
                <div class="violator-name">
                    <h3>Skoda Octavia</h3>
                    <div class="violator-id">Патрульный автомобиль</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 6 сек<br>
                        • Макс. скорость: 231 км/ч<br>
                        • Класс: Лифтбек<br>
                        • Привод: передний
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Проблесковые маячки<br>
                        • Громкоговоритель<br>
                        • Радиостанция<br>
                        • Видеорегистратор
                    </div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="violator-name">
                    <h3>Volkswagen Touareg</h3>
                    <div class="violator-id">Внедорожник</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 5 сек<br>
                        • Макс. скорость: 266 км/ч<br>
                        • Класс: Внедорожник<br>
                        • Привод: полный
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Усиленная подвеска<br>

                        • Спец. сигналы
                    </div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="violator-name">
                    <h3>BMW M5 (E60)</h3>
                    <div class="violator-id">Спортивный патруль</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 4 сек<br>
                        • Макс. скорость: 275 км/ч<br>
                        • Класс: Бизнес-седаны<br>
                        • Привод: задний
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Спортивная подвеска<br>
                        • Мощный двигатель V10<br>
                        • Система стабилизации<br>
                        • Спец. сигналы
                    </div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="violator-name">
                    <h3>Mercedes-Benz E63 S AMG (W212)</h3>
                    <div class="violator-id">Высокоскоростной патруль</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 3 сек<br>
                        • Макс. скорость: 298 км/ч<br>
                        • Класс: Бизнес-седаны<br>
                        • Привод: полный (4MATIC+)
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Би-турбо двигатель V8<br>
                        • Адаптивная подвеска<br>
                        • Система полного привода<br>
                        • Спец. сигналы
                    </div>
                </div>
            </div>
        </div>

        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="violator-name">
                    <h3>Lexus LX570</h3>
                    <div class="violator-id">Внедорожник для спецопераций</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 5 сек<br>
                        • Макс. скорость: 247 км/ч<br>
                        • Класс: Люксовый внедорожник<br>
                        • Привод: полный
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Адаптивная подвеска<br>
                        • Система полного привода<br>
                        • Спец. сигналы
                    </div>
                </div>
            </div>
        </div>

        <!-- Мотоциклы -->
        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-motorcycle"></i>
                </div>
                <div class="violator-name">
                    <h3>BMW R1200</h3>
                    <div class="violator-id">Патрульный мотоцикл</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 3 сек<br>
                        • Макс. скорость: 264 км/ч<br>
                        • Тип: Спортивный турер<br>
                        • Объем: 1170 см³
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Проблесковые маячки<br>
                        • Защитное оснащение<br>
                        • Багажные кофры
                    </div>
                </div>
            </div>
        </div>

        <!-- Спецтранспорт -->
        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-bus"></i>
                </div>
                <div class="violator-name">
                    <h3>ПАЗ-320405-04 Вектор Next</h3>
                    <div class="violator-id">Автобус для перевозки</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Разгон 0-100: 14 сек<br>
                        • Макс. скорость: 133 км/ч<br>
                        • Тип: Городской автобус
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Усиленный кузов<br>
                        • Дополнительные сиденья<br>
                        • Сигнальное оборудование
                    </div>
                </div>
            </div>
        </div>

        <!-- Воздушный транспорт -->
        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-helicopter"></i>
                </div>
                <div class="violator-name">
                    <h3>Патрульный вертолет</h3>
                    <div class="violator-id">Воздушное патрулирование</div>
                </div>
                <span class="status-badge status-active">
                    <i class="fas fa-check-circle"></i>
                    Доступен
                </span>
            </div>
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-tachometer-alt"></i>
                        Характеристики:
                    </div>
                    <div class="violator-value">
                        • Макс. скорость: 132 км/ч<br>
                        • Дальность: 450 км<br>
                        • Экипаж: 2 человека<br>
                        • Тип: Многоцелевой вертолет
                    </div>
                </div>
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-shield-alt"></i>
                        Оснащение:
                    </div>
                    <div class="violator-value">
                        • Тепловизор<br>
                        • Прожектор<br>
                        • Система громкой связи<br>
                        • Навигационное оборудование
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Добавьте эту секцию в основной контент -->
<section id="roleplay-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-comment-medical"></i>
        <h2>Полезные отыгровки</h2>
    </div>
    <p>Медицинские отыгровки и процедуры оказания первой помощи для сотрудников ГИБДД.</p>
    
    <div class="binds-categories">
        <!-- Определение состояния пострадавшего -->
        <div class="bind-category">
            <h3><i class="fas fa-user-injured"></i> Определение состояния пострадавшего</h3>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">1</span>
                    <span>Первичный осмотр</span>
                    <div class="bind-description">
                        <strong>me осмотрел пострадавшего на наличие видимых травм и кровотечений</strong><br>
                        <strong>do Есть ли повреждения на теле пострадавшего? Если есть, то какие?</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me осмотрел пострадавшего на наличие видимых травм и кровотечений\ndo Есть ли повреждения на теле пострадавшего? Если есть, то какие?')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">2</span>
                    <span>Проверка пульса</span>
                    <div class="bind-description">
                        <strong>me приложил два пальца к сонной артерии пострадавшего для проверки пульса</strong><br>
                        <strong>do У пострадавшего есть пульс?</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me приложил два пальца к сонной артерии пострадавшего для проверки пульса\ndo У пострадавшего есть пульс?')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">3</span>
                    <span>Проверка дыхания</span>
                    <div class="bind-description">
                        <strong>me запрокинув голову пострадавшего, нагнулся к ней для проверки дыхания</strong><br>
                        <strong>do У пострадавшего есть дыхание?</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me запрокинув голову пострадавшего, нагнулся к ней для проверки дыхания\ndo У пострадавшего есть дыхание?')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
        </div>

        <!-- Сердечно-лёгочная реанимация -->
        <div class="bind-category">
            <h3><i class="fas fa-heartbeat"></i> Сердечно-лёгочная реанимация (СЛР)</h3>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">4</span>
                    <span>Подготовка к СЛР</span>
                    <div class="bind-description">
                        <strong>me запрокинул голову пострадавшего и снял с него стесняющую одежду</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me запрокинул голову пострадавшего и снял с него стесняющую одежду')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">5</span>
                    <span>Компрессии грудной клетки</span>
                    <div class="bind-description">
                        <strong>me начал делать 30 компрессий грудной клетки пострадавшему</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me начал делать 30 компрессий грудной клетки пострадавшему')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">6</span>
                    <span>Искусственное дыхание</span>
                    <div class="bind-description">
                        <strong>me используя метод реанимации «рот в рот», сделал два вдоха в пострадавшего</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me используя метод реанимации «рот в рот», сделал два вдоха в пострадавшего')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">7</span>
                    <span>Проверка эффективности</span>
                    <div class="bind-description">
                        <strong>try проверил пульс пострадавшего и почувствовал пульсацию</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('try проверил пульс пострадавшего и почувствовал пульсацию')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
        </div>

        <!-- Помощь при отсутствии сознания -->
        <div class="bind-category">
            <h3><i class="fas fa-procedures"></i> Помощь при отсутствии сознания</h3>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">8</span>
                    <span>Подготовка пострадавшего</span>
                    <div class="bind-description">
                        <strong>me расстегнул стесняющую одежду пострадавшему для притока воздуха</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me расстегнул стесняющую одежду пострадавшему для притока воздуха')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">9</span>
                    <span>Устойчивое боковое положение</span>
                    <div class="bind-description">
                        <strong>me задал пострадавшему устойчивое боковое положение для его безопасности</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('me задал пострадавшему устойчивое боковое положение для его безопасности')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
        </div>

        <!-- Помощь при переломах -->
        <div class="bind-category">
            <h3><i class="fas fa-bone"></i> Помощь при переломах</h3>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F1</span>
                    <span>Определение типа перелома</span>
                    <div class="bind-description">
                        <strong>do У пострадавшего открытый или закрытый перелом?</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do У пострадавшего открытый или закрытый перелом?')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F2</span>
                    <span>Закрытый перелом</span>
                    <div class="bind-description">
                        <strong>do В аптечке сотрудника лежит шина и бинт.</strong><br>
                        <strong>me достал бинт и шину из аптечки</strong><br>
                        <strong>todo Все будет хорошо*закрепив шину на пострадавшем</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В аптечке сотрудника лежит шина и бинт.\nme достал бинт и шину из аптечки\ntodo Все будет хорошо*закрепив шину на пострадавшем')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F3</span>
                    <span>Открытый перелом</span>
                    <div class="bind-description">
                        <strong>do В аптечке сотрудника лежит жгут, шина и бинт.</strong><br>
                        <strong>me достал жгут из аптечки и закрепил его выше перелома пострадавшего</strong><br>
                        <strong>me достал бинт и шину из аптечки</strong><br>
                        <strong>todo Все будет хорошо*закрепив шину на пострадавшем</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В аптечке сотрудника лежит жгут, шина и бинт.\nme достал жгут из аптечки и закрепил его выше перелома пострадавшего\nme достал бинт и шину из аптечки\ntodo Все будет хорошо*закрепив шину на пострадавшем')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
        </div>

        <!-- Помощь при кровотечениях -->
        <div class="bind-category">
            <h3><i class="fas fa-tint"></i> Помощь при кровотечениях</h3>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F4</span>
                    <span>Определение места кровотечения</span>
                    <div class="bind-description">
                        <strong>do В каком месте у пострадавшего кровотечение?</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В каком месте у пострадавшего кровотечение?')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F5</span>
                    <span>Кровотечение из конечности</span>
                    <div class="bind-description">
                        <strong>do В кармане сотрудника лежит бинт и жгут.</strong><br>
                        <strong>me достал бинт и жгут, затем наложил жгут поверх бинта выше раны</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В кармане сотрудника лежит бинт и жгут.\nme достал бинт и жгут, затем наложил жгут поверх бинта выше раны')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F6</span>
                    <span>Кровотечение в других местах</span>
                    <div class="bind-description">
                        <strong>do В кармане сотрудника лежит чистая салфетка.</strong><br>
                        <strong>me достал салфетку и прижал её к месту кровотечения рукой</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В кармане сотрудника лежит чистая салфетка.\nme достал салфетку и прижал её к месту кровотечения рукой')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
        </div>

        <!-- Другие виды помощи -->
        <div class="bind-category">
            <h3><i class="fas fa-first-aid"></i> Другие виды помощи</h3>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F7</span>
                    <span>Помощь при охлаждении</span>
                    <div class="bind-description">
                        <strong>do В багажнике лежит аптечка с изотермическим одеялом.</strong><br>
                        <strong>me достал одеяло из аптечки</strong><br>
                        <strong>me окутал пострадавшего в спасательное одеяло по инструкции</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В багажнике лежит аптечка с изотермическим одеялом.\nme достал одеяло из аптечки\nme окутал пострадавшего в спасательное одеяло по инструкции')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F8</span>
                    <span>Огнестрельное ранение</span>
                    <div class="bind-description">
                        <strong>do Куда ранен пострадавший?</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do Куда ранен пострадавший?')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F9</span>
                    <span>Ранение в конечности</span>
                    <div class="bind-description">
                        <strong>do В кармане сотрудника лежит бинт и жгут.</strong><br>
                        <strong>me достал бинт и жгут, затем наложил жгут поверх бинта выше раны</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В кармане сотрудника лежит бинт и жгут.\nme достал бинт и жгут, затем наложил жгут поверх бинта выше раны')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
            
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">F10</span>
                    <span>Ранение в другие части тела</span>
                    <div class="bind-description">
                        <strong>do В кармане сотрудника лежит самоклеющаяся силиконовая лента.</strong><br>
                        <strong>me достал самоклеющуюся силиконовую ленту для остановки кровотечения</strong><br>
                        <strong>me открыл силиконовую ленту и прилепил её на место ранения</strong>
                    </div>
                </div>
                <button class="btn-copy" onclick="copyBindText('do В кармане сотрудника лежит самоклеющаяся силиконовая лента.\nme достал самоклеющуюся силиконовую ленту для остановки кровотечения\nme открыл силиконовую ленту и прилепил её на место ранения')">
                    <i class="fas fa-copy"></i> Копировать
                </button>
            </div>
        </div>
    </div>
</section>
<!-- Mini Guides Section -->
<section id="guides-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-book-open"></i>
        <h2>Мини гайды</h2>
    </div>
    <p>Краткие руководства и инструкции для сотрудников ГИБДД по различным аспектам службы.</p>
    
    <div class="binds-categories">
        <div class="bind-category">
            <h3><i class="fas fa-handcuffs"></i> Задержания</h3>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">1</span>
                    <span>Процедура задержания</span>
                    <div class="bind-description">
                        <strong>Порядок действий:</strong><br>
                        1. Представиться и при просьбе гражданина предъявить служебное удостоверение<br>
                        2. Объявить о задержании и причинах<br>
                        3. Применить наручники <br>
                        4. Осуществить личный досмотр при желании<br>
                        5. Отвезти гражданина в отдел полиции
                        6. Объявить его в розыск, если его еще нет. (Перед этим необходимо узнать его личность)
                        7. Передать конвоиру.
                    </div>
                </div>
            </div>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">2</span>
                    <span>Права задержанного</span>
                    <div class="bind-description">
                        Задержанный имеет право:<br>
                        • Знать причину задержания<br>                  
                        • Хранить молчание
                    </div>
                </div>
            </div>
        </div>

        <div class="bind-category">
            <h3><i class="fas fa-car-side"></i> Остановка ТС</h3>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">1</span>
                    <span>Процедура остановки</span>
                    <div class="bind-description">
                        <strong>Правильная последовательность:</strong><br>
                        1. Подать сигнал жезлом/сказать в громкоговоритель<br>
                        2. Включить проблесковые маячки (Вслучае, если Вы остановили гражданина на машине)<br>
                        4. Подойти к транспортному средству<br>
                        5. Представиться и назвать причину остановки
                    </div>
                </div>
            </div>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">2</span>
                    <span>Общение с водителем</span>
                    <div class="bind-description">
                        • Вежливо представиться<br>
                        • Четко назвать причину остановки<br>
                        • Требовать документы в тактичной форме<br>
                        • Объяснять нарушения понятным языком<br>
                        • Сохранять спокойный тон
                    </div>
                </div>
            </div>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">3</span>
                    <span>Безопасность при остановке</span>
                    <div class="bind-description">
                        • Подходить со стороны водителя<br>
                        • Следить за руками водителя<br>
                        • Использовать патрульный автомобиль как укрытие<br>
                        • Быть готовым к нестандартным ситуациям
                    </div>
                </div>
            </div>
        </div>

        <div class="bind-category">
            <h3><i class="fas fa-file-contract"></i> Оформление документов</h3>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">1</span>
                    <span>Протокол нарушения ПДД</span>
                    <div class="bind-description">
                        <strong>Обязательные пункты:</strong><br>
                        • Дата, время и место составления<br>
                        • Данные сотрудника ГИБДД<br>
                        • Данные нарушителя<br>
                        • Суть нарушения (статья КоАП)<br>
                        • Объяснения нарушителя<br>
                        • Подписи сторон
                    </div>
                </div>
            </div>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">2</span>
                    <span>Изъятие прав</span>
                    <div class="bind-description">
                        <strong>Основания для изъятия:</strong><br>
                        • Управление в состоянии опьянения<br>
                        • Оставление места ДТП<br>
                        • Систематические нарушения<br>
                        • Подделка документов<br>
                        <em>Обязательно составление протокола</em>
                    </div>
                </div>
            </div>
        <div class="bind-category">
            <h3><i class="fas fa-shield-alt"></i> Безопасность и тактика</h3>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">1</span>
                    <span>Работа в темное время суток</span>
                    <div class="bind-description">
                        • Использовать световозвращающие элементы<br>
                        • Использовать автомобиль как укрытие<br>
                        • Быть особенно внимательным к подозрительным ТС
                    </div>
                </div>
            </div>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">2</span>
                    <span>Действия при сопротивлении</span>
                    <div class="bind-description">
                        • Использовать средства связи<br>
                        • Применить спецсредства по ситуации<br>
                        • Контролировать дистанцию<br>
                        • Запомнить приметы нарушителя
                    </div>
                </div>
            </div>
            <div class="bind-item">
                <div class="bind-content">
                    <span class="bind-key">3</span>
                    <span>Первая помощь</span>
                    <div class="bind-description">
                        <strong>Основные действия:</strong><br>
                        • Оценить обстановку на безопасность<br>
                        • Проверить сознание и дыхание<br>
                        • Вызвать скорую помощь<br>
                        • Остановить кровотечение<br>
                        • Не перемещать пострадавшего без необходимости
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
                <!-- Leadership Section -->
<section id="leadership-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-user-tie"></i>
        <h2>Руководящий состав</h2>
    </div>
    <p>Высшее руководство ГИБДД Республики Провинция. Опытные сотрудники, отвечающие за различные подразделения и направления работы.</p>
    
    <div class="leadership-grid" id="leadershipGrid">
        <!-- Карточки будут добавлены через JavaScript -->
    </div>
</section>
                <!-- Violators Section -->
<section id="violators-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-database"></i>
        <h2>База нарушителей</h2>
    </div>
    <p>В этом разделе вы можете создавать и просматривать карточки нарушителей.</p>
    
    <div class="violators-container">
        <div class="violators-controls">
            <button class="btn" onclick="showCreateViolatorModal()">
                <i class="fas fa-plus"></i> Создать карточку нарушителя
            </button>
            <div class="form-group" style="max-width: 300px;">
                <input type="text" id="searchViolators" class="form-control" placeholder="Поиск по имени или нарушению...">
            </div>
        </div>
        
        <div id="violatorsGrid" class="violators-grid">
            <!-- Карточки нарушителей будут появляться здесь -->
            <div class="no-violators" style="text-align: center; padding: 40px; color: var(--gray);">
                <i class="fas fa-database" style="font-size: 3rem; margin-bottom: 15px;"></i>
                <h3>Нет созданных карточек</h3>
                <p>Нажмите кнопку "Создать карточку нарушителя" чтобы добавить первую запись</p>
            </div>
        </div>
    </div>
</section>
<!-- PDD Tests Section -->
<section id="pdd-tests-section" class="content-section" style="display: none;">
    <div class="section-title">
        <i class="fas fa-graduation-cap"></i>
        <h2>Тесты по ПДД</h2>
    </div>
    <p>Проверьте свои знания правил дорожного движения. В каждом вопросе укажите статью КоАП и наказание.</p>
    
    <div id="pddTestContent" class="pdd-test-container">
        <!-- Контент тестов будет загружен через JavaScript -->
    </div>
</section>
                
                <!-- Binds Section -->
                <section id="binds-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-keyboard"></i>
                        <h2>Бинды для игры</h2>
                    </div>
                    <p>На этой странице представлены все необходимые бинды для эффективного выполнения служебных обязанностей.</p>
                    
                    <div class="binds-categories">
                        <!-- Представление -->
                        <div class="bind-category">
                            <h3><i class="fas fa-id-card"></i> Представление</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">1</span>
                                    <span>Представление инспектора полиции</span>
                                    <div class="bind-description">bind 1 say Здравия желаю, [Звание] полиции [Фамилия], [должность] ДПС ОГИБДД по городу Приволжск.</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 1 say Здравия желаю, [Звание] полиции [Фамилия], [должность] ДПС ОГИБДД по городу Приволжск.')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">1</span>
                                    <span>Представление инспектора внутренней службы (ОКН)</span>
                                    <div class="bind-description">bind 1 say Здравия желаю, [Звание] внутренней службы [Фамилия], [должность] ДПС ОГИБДД по городу Приволжск.</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 1 say Здравия желаю, [Звание] внутренней службы [Фамилия], [должность] ДПС ОГИБДД по городу Приволжск.')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">3</span>
                                    <span>Требование о предоставлении документов</span>
                                    <div class="bind-description">bind 3 say Гражданин, предоставьте Ваше водительское удостоверение и регистрационные документы.</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 3 say Гражданин, предоставьте Ваше водительское удостоверение и регистрационные документы.')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">HOME</span>
                                    <span>Приветствие с коллегами</span>
                                    <div class="bind-description">bind home say Здравия желаю!<br>bind home animarmy 3</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind home say Здравия желаю!\nbind home animarmy 3')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Оформление протокола -->
                        <div class="bind-category">
                            <h3><i class="fas fa-file-contract"></i> Оформление протокола</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">F2</span>
                                    <span>Начало оформления протоколов</span>
                                    <div class="bind-description">bind F2 do На плече сотрудника висит кожаная папка с планшеткой, бланками и ручкой.<br>bind F2 me вытащил из кожаной папки планшетку с бланками и ручку<br>bind F2 up me начинает составлять административный протокол и его копию</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind F2 do На плече сотрудника висит кожаная папка с планшеткой, бланками и ручкой.\nbind F2 me вытащил из кожаной папки планшетку с бланками и ручку\nbind F2 up me начинает составлять административный протокол и его копию')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">F4</span>
                                    <span>Передача протоколов на подпись</span>
                                    <div class="bind-description">bind F4 me закончив составлять административный протокол и его копию, вытащил протоколы из-под зажима<br>bind F4 me передал протокол, копию и ручку на подпись, после чего внёс нужную информацию в планшет<br>bind F4 say Вот, возьмите распишитесь. Копию оставляете себе, оригинал и ручку возвращаете мне.</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind F4 me закончив составлять административный протокол и его копию, вытащил протоколы из-под зажима\nbind F4 me передал протокол, копию и ручку на подпись, после чего внёс нужную информацию в планшет\nbind F4 say Вот, возьмите распишитесь. Копию оставляете себе, оригинал и ручку возвращаете мне.')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">F7</span>
                                    <span>Окончание оформления протокола</span>
                                    <div class="bind-description">bind F7 me взял подписанный оригинал протокола с ручкой<br>bind F7 up me убрал оригинал протокола с планшеткой и ручкой в кожаную папку</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind F7 me взял подписанный оригинал протокола с ручкой\nbind F7 up me убрал оригинал протокола с планшеткой и ручкой в кожаную папку')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Остановка ТС -->
                        <div class="bind-category">
                            <h3><i class="fas fa-car"></i> Остановка ТС</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">9</span>
                                    <span>Требование об остановке ТС</span>
                                    <div class="bind-description">bind 9 me снял тангенту с крепления и поднёс её ко рту, зажав кнопку «PTT»<br>bind 9 down m Водитель, это полиция, принимаем крайнее правое положение и останавливаемся!<br>bind 9 up me зафиксировал тангенту громкоговорителя на креплении, отпустив кнопку «PTT»</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 9 me снял тангенту с крепления и поднёс её ко рту, зажав кнопку «PTT»\nbind 9 down m Водитель, это полиция, принимаем крайнее правое положение и останавливаемся!\nbind 9 up me зафиксировал тангенту громкоговорителя на креплении, отпустив кнопку «PTT»')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">0</span>
                                    <span>Если гражданин не реагирует</span>
                                    <div class="bind-description">bind 0 me снял тангенту с крепления и поднёс её ко рту, зажав кнопку «PTT»<br>bind 0 down m Водитель, это полиция, останавливаемся, иначе открываю огонь!<br>bind 0 up me зафиксировал тангенту громкоговорителя на креплении, отпустив кнопку «PTT»</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 0 me снял тангенту с крепления и поднёс её ко рту, зажав кнопку «PTT»\nbind 0 down m Водитель, это полиция, останавливаемся, иначе открываю огонь!\nbind 0 up me зафиксировал тангенту громкоговорителя на креплении, отпустив кнопку «PTT»')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">NUM -</span>
                                    <span>Требование об остановке при побеге</span>
                                    <div class="bind-description">bind num_sub s Гражданин, это полиция, немедленно остановитесь! В случае отказа применяю спец.средства, или огнестрельное оружие!</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind num_sub s Гражданин, это полиция, немедленно остановитесь! В случае отказа применяю спец.средства, или огнестрельное оружие!')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Отыгровка с планшетом -->
                        <div class="bind-category">
                            <h3><i class="fas fa-tablet-alt"></i> Отыгровка с планшетом</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">7</span>
                                    <span>Доставание планшета</span>
                                    <div class="bind-description">bind 7 do Электронный планшет лежит в кожаной папке на плече.<br>bind 7 me открыв кожаную папку, достал из неё электронный планшет<br>bind 7 up me включив планшет, открыл базу данных МВД</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 7 do Электронный планшет лежит в кожаной папке на плече.\nbind 7 me открыв кожаную папку, достал из неё электронный планшет\nbind 7 up me включив планшет, открыл базу данных МВД')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">NUM /</span>
                                    <span>Пробитие информации о штрафах</span>
                                    <div class="bind-description">bind num_div me ввёл данные с водительского удостоверения в базу данных МВД через планшет<br>bind num_div do На экране планшета появилась информация.<br>bind num_div chatbox skan</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind num_div me ввёл данные с водительского удостоверения в базу данных МВД через планшет\nbind num_div do На экране планшета появилась информация.\nbind num_div chatbox skan')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">F10</span>
                                    <span>Пробитие информации по номеру</span>
                                    <div class="bind-description">bind F10 me взглянув на номерной знак ТС, вписал их в базу данных МВД через планшет<br>bind F10 do На экране планшета появилась информация.<br>bind f10 chatbox findcar</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind F10 me взглянув на номерной знак ТС, вписал их в базу данных МВД через планшет\nbind F10 do На экране планшета появилась информация.\nbind f10 chatbox findcar')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">NUM *</span>
                                    <span>Оформление электронного штрафа</span>
                                    <div class="bind-description">bind num_mul me выписал электронный штраф водителю через планшет<br>bind num_mul chatbox tsu</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind num_mul me выписал электронный штраф водителю через планшет\nbind num_mul chatbox tsu')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">F9</span>
                                    <span>Лишение водителя</span>
                                    <div class="bind-description">bind F9 me аннулировал водительское удостоверение водителя через планшет<br>bind F9 say Ваше водительское удостоверение аннулировано.<br>bind F9 up say По истечению срока лишения можете пересдать на права в Автошколе.<br>bind F9 chatbox takecarlic</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind F9 me аннулировал водительское удостоверение водителя через планшет\nbind F9 say Ваше водительское удостоверение аннулировано.\nbind F9 up say По истечению срока лишения можете пересдать на права в Автошколе.\nbind F9 chatbox takecarlic')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">NUM +</span>
                                    <span>Завершение работы с планшетом</span>
                                    <div class="bind-description">bind num_add me выключив планшет, убрал его в кожаную папку, после чего закрыл её</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind num_add me выключив планшет, убрал его в кожаную папку, после чего закрыл её')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Отыгровки спецсредств -->
                        <div class="bind-category">
                            <h3><i class="fas fa-shield-alt"></i> Отыгровки спецсредств</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">Ж</span>
                                    <span>Достать жезл</span>
                                    <div class="bind-description">bind ; do Через плечо сотрудника висит закрытая кожаная папка с жезлом внутри.<br>bind ; me открыв кожаную папку, вытащил из неё жезл, после закрыл папку</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind ; do Через плечо сотрудника висит закрытая кожаная папка с жезлом внутри.\nbind ; me открыв кожаную папку, вытащил из неё жезл, после закрыл папку')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">Э</span>
                                    <span>Убрать жезл</span>
                                    <div class="bind-description">bind ' me открыв кожаную папку, убрал в неё жезл, после закрыл папку</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind \' me открыв кожаную папку, убрал в неё жезл, после закрыл папку')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">(Настроить)</span>
                                    <span>Наручники</span>
                                    <div class="bind-description">bind клавиша say Вы задержаны и будете доставлены в отделение. Сопротивляться не советую.<br>bind клавиша chatbox cuff</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind клавиша say Вы задержаны и будете доставлены в отделение. Сопротивляться не советую.\nbind клавиша chatbox cuff')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Досмотр гражданина -->
                        <div class="bind-category">
                            <h3><i class="fas fa-search"></i> Досмотр гражданина</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">(Настроить)</span>
                                    <span>Начало досмотра</span>
                                    <div class="bind-description">bind клавиша do На плече сотрудника висит кожаная папка с перчатками.<br>bind клавиша me открыл папку и достал перчатки, надел их на руки<br>bind клавиша say Есть у Вас что-то запрещенное: оружие, наркотики?<br>bind клавиша up me аккуратно досмотрел задержанного</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind клавиша do На плече сотрудника висит кожаная папка с перчатками.\nbind клавиша me открыл папку и достал перчатки, надел их на руки\nbind клавиша say Есть у Вас что-то запрещенное: оружие, наркотики?\nbind клавиша up me аккуратно досмотрел задержанного')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">(Настроить)</span>
                                    <span>Окончание досмотра</span>
                                    <div class="bind-description">bind клавиша me снял перчатки и положил их в кожаную папку, закрыл кожаную папку</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind клавиша me снял перчатки и положил их в кожаную папку, закрыл кожаную папку')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Посадка в автомобиль/КПЗ -->
                        <div class="bind-category">
                            <h3><i class="fas fa-car-side"></i> Посадка в автомобиль/КПЗ</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">6</span>
                                    <span>Посадка в патрульный автомобиль</span>
                                    <div class="bind-description">bind 6 say Аккуратно, бережём голову при посадке в патрульный автомобиль.<br>bind 6 me отпустил руку задержанного, немного наклонил его перед дверью и усадил в салон автомобиля<br>bind 6 chatbox dearr</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind 6 say Аккуратно, бережём голову при посадке в патрульный автомобиль.\nbind 6 me отпустил руку задержанного, немного наклонил его перед дверью и усадил в салон автомобиля\nbind 6 chatbox dearr')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">Б</span>
                                    <span>Передача задержанного конвоиру</span>
                                    <div class="bind-description">bind , s Конвоир!<br>bind , me передал задержанного конвоиру<br>bind , do Конвоир увёл задержанного в ИВС.<br>bind , chatbox arrest</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind , s Конвоир!\nbind , me передал задержанного конвоиру\nbind , do Конвоир увёл задержанного в ИВС.\nbind , chatbox arrest')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                        
                        <!-- Рация -->
                        <div class="bind-category">
                            <h3><i class="fas fa-walkie-talkie"></i> Рация</h3>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">-</span>
                                    <span>Использование рации</span>
                                    <div class="bind-description">bind - do На теле сотрудника закреплена рация.<br>bind - me снял с себя рацию и зажал кнопку<br>bind - fracvoice 1</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind - do На теле сотрудника закреплена рация.\nbind - me снял с себя рацию и зажал кнопку\nbind - fracvoice 1')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">=</span>
                                    <span>Завершение использования рации</span>
                                    <div class="bind-description">bind = me отжав кнопку, вернул рацию на крепление<br>bind = fracvoice 2</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind = me отжав кнопку, вернул рацию на крепление\nbind = fracvoice 2')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                            <div class="bind-item">
                                <div class="bind-content">
                                    <span class="bind-key">/</span>
                                    <span>Объявление гражданина в розыск</span>
                                    <div class="bind-description">bind / me передал информацию о подозреваемом оперативному дежурному<br>bind / do Оперативный дежурный объявил подозреваемого в розыск.<br>bind / chatbox su</div>
                                </div>
                                <button class="btn-copy" onclick="copyBindText('bind / me передал информацию о подозреваемом оперативному дежурному\nbind / do Оперативный дежурный объявил подозреваемого в розыск.\nbind / chatbox su')"><i class="fas fa-copy"></i> Копировать</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Commands Section -->
                <section id="commands-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-terminal"></i>
                        <h2>Игровые команды</h2>
                    </div>
                    <p>Список всех доступных команд для сотрудников ГИБДД с указанием необходимого ранга для использования.</p>
                    
                    <div class="commands-grid">
                        <div class="command-card">
                            <h3>/m [Текст]</h3>
                            <div class="command-syntax">/m Водитель, остановитесь!</div>
                            <p class="command-desc">Использование мегафона с указанным текстом.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/animarmy [1-9]</h3>
                            <div class="command-syntax">/animarmy 3</div>
                            <p class="command-desc">Вызов анимации: 1-отжимания, 2-приседания, 3-воинское приветствие и т.д.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/arr [ID]</h3>
                            <div class="command-syntax">/arr 25</div>
                            <p class="command-desc">Конвоирование преступника, когда он закован в наручники.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/dearr [ID]</h3>
                            <div class="command-syntax">/dearr 25</div>
                            <p class="command-desc">Отпустить преступника с конвоирования.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/wanted</h3>
                            <div class="command-syntax">/wanted</div>
                            <p class="command-desc">Выводит список всех игроков онлайн, которые находятся в розыске.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/crimrec</h3>
                            <div class="command-syntax">/crimrec 25</div>
                            <p class="command-desc">Показать совершенные преступления игрока.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/fines</h3>
                            <div class="command-syntax">/fines</div>
                            <p class="command-desc">Выводит список всех игроков онлайн с неоплаченными штрафами.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/findcar [номер]</h3>
                            <div class="command-syntax">/findcar а123ус78</div>
                            <p class="command-desc">Находит владельца машины по номеру.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/takecarlic [ID] [время]</h3>
                            <div class="command-syntax">/takecarlic 25 3</div>
                            <p class="command-desc">Отобрать права у игрока на категории B, C, D.</p>
                            <div class="command-rank">Ранг: 3+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/su [ID] [уровень] [причина]</h3>
                            <div class="command-syntax">/su 25 3 Нарушение ПДД</div>
                            <p class="command-desc">Подать игрока в розыск.</p>
                            <div class="command-rank">Ранг: 2+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/givecarlic [ID]</h3>
                            <div class="command-syntax">/givecarlic 25</div>
                            <p class="command-desc">Вернуть возможность сдать на права.</p>
                            <div class="command-rank">Ранг: 9+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/tsu [ID] [сумма] [причина]</h3>
                            <div class="command-syntax">/tsu 25 5000 Превышение скорости</div>
                            <p class="command-desc">Зафиксировать нарушение ПДД.</p>
                            <div class="command-rank">Ранг: 3+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/skan [ID]</h3>
                            <div class="command-syntax">/skan 25</div>
                            <p class="command-desc">Определить кол-во нарушений ПДД.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/cuff [ID]</h3>
                            <div class="command-syntax">/cuff 25</div>
                            <p class="command-desc">Надевает на преступника наручники.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/putpl</h3>
                            <div class="command-syntax">/putpl</div>
                            <p class="command-desc">Посадить преступника в машину.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/uncuff [ID]</h3>
                            <div class="command-syntax">/uncuff 25</div>
                            <p class="command-desc">Снимает наручники с преступника.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/arrest [ID]</h3>
                            <div class="command-syntax">/arrest 25</div>
                            <p class="command-desc">Посадить игрока в КПЗ.</p>
                            <div class="command-rank">Ранг: 1+</div>
                        </div>
                        
                        <div class="command-card">
                            <h3>/giverank [ID] [ранг]</h3>
                            <div class="command-syntax">/giverank 25 5</div>
                            <p class="command-desc">Изменить ранг игрока.</p>
                            <div class="command-rank">Ранг: 9+</div>
                        </div>
                    </div>
                </section>
                
                <!-- Documents Section -->
                <section id="documents-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-file-alt"></i>
                        <h2>Нормативные документы</h2>
                    </div>
                    <p>Официальные документы, регулирующие деятельность ГИБДД и других правоохранительных органов Республики Провинция.</p>
                    
                    <div class="documents-grid">
                        <div class="document-card">
                            <div class="document-icon"><i class="fas fa-car"></i></div>
                            <div class="document-content">
                                <h3>Административный регламент ГИБДД</h3>
                                <p>Регламент, определяющий порядок выполнения административных процедур сотрудниками ГИБДД.</p>
                                <a href="https://forum.gtaprovince.ru/topic/724436-administrativnyy-reglament-gibdd-ot-01072020-n-1/" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Открыть</a>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon"><i class="fas fa-gavel"></i></div>
                            <div class="document-content">
                                <h3>Федеральный закон о полиции</h3>
                                <p>Основной закон, регулирующий деятельность полиции в Республике Провинция.</p>
                                <a href="https://forum.gtaprovince.ru/topic/724457-federalnyy-zakon-o-policii-ot-12112024-n-3-fz/" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Открыть</a>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon"><i class="fas fa-clipboard-list"></i></div>
                            <div class="document-content">
                                <h3>Приказы МВД</h3>
                                <p>Сборник приказов Министерства внутренних дел по Республике Провинция.</p>
                                <a href="https://forum.gtaprovince.ru/topic/724445-prikazy-ministerstva-vnutrennih-del-po-respublike-provinciya/" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Открыть</a>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon"><i class="fas fa-lock"></i></div>
                            <div class="document-content">
                                <h3>Уголовный кодекс РП</h3>
                                <p>Уголовный кодекс Республики Провинция с последними изменениями.</p>
                                <a href="https://forum.gtaprovince.ru/topic/639258-ugolovnyy-kodeks-respubliki/" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Открыть</a>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon"><i class="fas fa-file-contract"></i></div>
                            <div class="document-content">
                                <h3>Кодекс об административных правонарушениях</h3>
                                <p>Кодекс, регулирующий административные правонарушения в Республике Провинция.</p>
                                <a href="https://forum.gtaprovince.ru/topic/639260-kodeks-ob-administrativnyh-pravonarusheniyah-respubliki/" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Открыть</a>
                            </div>
                        </div>
                        
                        <div class="document-card">
                            <div class="document-icon"><i class="fas fa-scroll"></i></div>
                            <div class="document-content">
                                <h3>Конституция Республики Провинция</h3>
                                <p>Основной закон государства, принятый голосованием 15.07.2024 года.</p>
                                <a href="https://forum.gtaprovince.ru/topic/828538-konstituciya-respubliki-provinciya-prinyata-golosovaniem-15072024-goda/" target="_blank" class="btn"><i class="fas fa-external-link-alt"></i> Открыть</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Weapon Section -->
                <section id="weapon-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-shield-alt"></i>
                        <h2>Справка по табельному оружию и снаряжению</h2>
                    </div>
                    <p>Информация о табельном оружии, спецсредствах и снаряжении, доступном сотрудникам ДПС ОГИБДД.</p>
                    
                    <div class="weapon-grid">
                        <div class="weapon-card">
                            <h3><i class="fas fa-gavel"></i> Дубинка резиновая ПУС-2 «Аргумент-М»</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступна всем сотрудникам ДПС ОГИБДД</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Используется для нейтрализации подозреваемого с целью последующего ареста</div>
                            </div>
                        </div>
                        
                        <div class="weapon-card">
                            <h3><i class="fas fa-traffic-light"></i> Жезл регулировщика</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступен всем сотрудникам ДПС ОГИБДД</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Используется для остановки транспортного средства и регулирования дорожного движения</div>
                            </div>
                        </div>
                        
                        <div class="weapon-card">
                            <h3><i class="fas fa-vest"></i> Бронежилет «КОРА-1М»</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступен всем сотрудникам ДПС ОГИБДД</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Является средством индивидуальной защиты сотрудников ДПС ОГИБДД от огнестрельного оружия</div>
                            </div>
                        </div>
                        
                        <div class="weapon-card">
                            <h3><i class="fas fa-bolt"></i> Электрошоковое устройство «Taser»</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступен всем сотрудникам ДПС ОГИБДД</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Используется для остановки и нейтрализации подозреваемого на более длительных дистанциях с целью последующего ареста</div>
                            </div>
                        </div>
                        
                        <div class="weapon-card">
                            <h3><i class="fas fa-gun"></i> Пистолет «MP-443 «Грач»</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступен сотрудникам ДПС ОГИБДД звания "Старшина полиции" и выше. Запрещен для использования курсантам УК и стажёрам ОБ.</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Используется для нейтрализации преступника, в случае угрозы жизни гражданскому населению или жизни сотрудника, непосредственно. Также используется для стрельбы из окна по колёсам.</div>
                            </div>
                        </div>
                        
                        <div class="weapon-card">
                            <h3><i class="fas fa-gun"></i> Гладкоствольное ружьё «МР-133»</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступно всем сотрудникам со звания "Лейтенант полиции"</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Используется для нейтрализации преступника, в случае угрозы жизни сотрудника или гражданскому населению. Также используется с целью устрашения и морального подавления противника. Крайне неэффективно на дальних дистанциях.</div>
                            </div>
                        </div>
                        
                        <div class="weapon-card">
                            <h3><i class="fas fa-gun"></i> Автомат «АК-74M»</h3>
                            <div class="weapon-info">
                                <div class="label">Доступность:</div>
                                <div class="value">Доступен всем сотрудникам ОСР и инструкторам</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Назначение:</div>
                                <div class="value">Используется для выезда за особо-опасными преступниками и нарушителями, а также с целью нейтрализации преступника на дальней дистанции в случае угрозы жизни гражданскому населению или сотрудника, непосредственно.</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Radio Section -->
                <section id="radio-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-walkie-talkie"></i>
                        <h2>Регламент радиообмена</h2>
                    </div>
                    <p>Правила и стандарты ведения радиообмена сотрудниками ГИБДД для обеспечения эффективной коммуникации.</p>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-exchange-alt"></i> Доклад о сдаче/заступлении на смену и о взятии перерыва</h3>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], заступил на смену.</div>
                            <div class="radio-desc">Доклад о начале смены</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], сдал смену.</div>
                            <div class="radio-desc">Доклад о завершении смены</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], разрешите взять перерыв на [минут]. [Причина].</div>
                            <div class="radio-desc">Запрос на перерыв</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], взял перерыв на [время].</div>
                            <div class="radio-desc">Уведомление о начале перерыва</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], вернулся с перерыва.</div>
                            <div class="radio-desc">Уведомление о возвращении с перерыва</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-car"></i> Доклады во время патрулирования на автомобиле</h3>
                        <p>Во время патрулирования используются такие аббревиатуры, как ПГ и ПЮ (ПГ / ПЮ - патрулирование города / юрисдикции)</p>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], А-ПГ-1, [Маркировка экипажа] - Выехали в патрулирование города.</div>
                            <div class="radio-desc">Начало патрулирования на автомобиле</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], А-ПГ-2, [Маркировка экипажа] - Патрулирование города, состояние стабильное.</div>
                            <div class="radio-desc">Доклад о стабильной обстановке</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], А-ПГ-3, [Маркировка экипажа] - Завершили патрулирование города.</div>
                            <div class="radio-desc">Завершение патрулирования</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], А-ПГ-4, [Маркировка экипажа], [Деятельность экипажа] - Доклад для указания деятельности экипажа.</div>
                            <div class="radio-desc">Доклад о текущей деятельности (если имеется напарник, указываете его позывной в конце доклада)</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-helicopter"></i> Доклады во время патрулирования на вертолёте</h3>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], В-ПЮ-1, Киров - Вылетели в патрулирование города.</div>
                            <div class="radio-desc">Начало патрулирования на вертолете</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], В-ПЮ-2, Киров - Патрулирование города, состояние стабильное.</div>
                            <div class="radio-desc">Доклад о стабильной обстановке с воздуха</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], В-ПЮ-3, Киров - Завершили патрулирование города.</div>
                            <div class="radio-desc">Завершение воздушного патрулирования</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], В-ПЮ-4, Киров, [Деятельность экипажа] - Доклад для указания деятельности экипажа.</div>
                            <div class="radio-desc">Доклад о текущей деятельности (если имеется напарник, указываете его позывной в конце доклада)</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-walking"></i> Доклады во время пешего патрулирования</h3>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], П-ПГ-1 - Вышли в патрулирование города.</div>
                            <div class="radio-desc">Начало пешего патрулирования</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], П-ПГ-2 - Патрулирование города, состояние стабильное.</div>
                            <div class="radio-desc">Доклад о стабильной обстановке при пешем патрулировании</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], П-ПГ-3 - Завершили патрулирование города.</div>
                            <div class="radio-desc">Завершение пешего патрулирования</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], П-ПГ-4, [Деятельность сотрудников] - Доклад для указания деятельности, если таковая имеется.</div>
                            <div class="radio-desc">Доклад о текущей деятельности (если имеется напарник, указываете его позывной в конце доклада)</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-motorcycle"></i> Доклады во время патрулирования на мотоцикле</h3>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], М-ПГ-1 - Выехали в мотопатрулирование города.</div>
                            <div class="radio-desc">Начало мотопатрулирования</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], М-ПГ-2 - Мотопатрулирование города, состояние стабильное.</div>
                            <div class="radio-desc">Доклад о стабильной обстановке при мотопатрулировании</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], М-ПГ-3 - Завершили мотопатрулирование города.</div>
                            <div class="radio-desc">Завершение мотопатрулирования</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], М-ПГ-4, [Деятельность сотрудников] - Доклад для указания деятельности, если таковая имеется.</div>
                            <div class="radio-desc">Доклад о текущей деятельности (если имеется напарник, указываете его позывной в конце доклада)</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-phone-alt"></i> Доклады во время принятия вызова</h3>
                        <p>Во время обработки вызова используется такая аббревиатура, как ОВ (ОВ - обработка вызова). Во время принятия вызова допускается использование таких фраз, как *принял(и) вызов*, а также им подобных.</p>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ОВ-1 [Локация вызова], [Маркировка экипажа].</div>
                            <div class="radio-desc">Принятие вызова</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ОВ-2, [Маркировка экипажа] - Прибыли на вызов, обрабатываете.</div>
                            <div class="radio-desc">Прибытие на место вызова (если вызов оказался ложным, этот доклад не используется)</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ОВ-3, [Маркировка экипажа] - Вызов обработан.</div>
                            <div class="radio-desc">Завершение обработки вызова</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-road"></i> Доклады во время нахождения на передвижных постах</h3>
                        <p>Во время дежурства на посту используется маркировка самого поста (номер поста, где *Х*), а также цифры, обозначающие состояние или действия сотрудника на том самом посту.</p>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ПП-[Х]-0, [Маркировка экипажа] - Выехали на пост.</div>
                            <div class="radio-desc">Выезд на пост</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ПП-[X]-1, [Маркировка экипажа] - Заступили на пост.</div>
                            <div class="radio-desc">Заступление на пост</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ПП-[Х]-2, [Маркировка экипажа] - Состояние на посту стабильное.</div>
                            <div class="radio-desc">Доклад о стабильной обстановке на посту</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ПП-[Х]-3, [Маркировка экипажа] - Сдали пост.</div>
                            <div class="radio-desc">Сдача поста</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ПП-[Х]-4, [Маркировка экипажа], [Деятельность сотрудников] - Доклад с указанием деятельности, если таковая имеется.</div>
                            <div class="radio-desc">Доклад о текущей деятельности (если имеется напарник, указываете его позывной в конце доклада)</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-user-secret"></i> Доклады во время отлова ООН (для ОСР)</h3>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], выехал(и) на поимку ООН. По базе данных: [Имя Фамилия нарушителя] - Начало отлова.</div>
                            <div class="radio-desc">Начало операции по задержанию особо опасного нарушителя</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="radio-syntax">[Позывной], ООН был нейтрализован. Произвожу(дим) конвоирование задержанного в отдел - Конец отлова.</div>
                            <div class="radio-desc">Завершение операции по задержанию</div>
                        </div>
                    </div>
                    
                    <div class="radio-category">
                        <h3><i class="fas fa-broadcast-tower"></i> Основные положения радиообмена</h3>
                        
                        <div class="radio-item">
                            <div class="label">Позывной</div>
                            <div class="value">Специальное слово, либо сочетание букв или цифр, которое присваивают сотрудникам ОГИБДД для опознания участников переговоров, а также с целью осуществления докладов о текущей деятельности сотрудника ОГИБДД. Позывные присваиваются в индивидуальном порядке руководящим составом отдела или начальником ДПС ОГИБДД по г. Приволжск.</div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="label">Формирование позывных</div>
                            <div class="value">
                                <ul>
                                    <li>Сотрудникам ОБ присваиваются позывные: ОБ-*, где * - любое натуральное число</li>
                                    <li>Сотрудникам УК присваиваются позывные: К-*, где * - любое натуральное число</li>
                                    <li>Сотрудникам ЦПС присваиваются позывные: И-*, где * - любое натуральное число</li>
                                    <li>Сотрудникам ОСР присваиваются любые именные позывные, которые не ограничены правилами четвёртого пункта</li>
                                    <li>Сотрудникам СК присваиваются позывные: С-1, С-2, С-3 - для стажёров-инспекторов ОСР; С-4, С-5, С-6 - для стажёров-инспекторов ОБ; С-7, С-8, С-9 - для стажёров-инструкторов ЦПС</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="label">Обязанности сотрудника</div>
                            <div class="value">
                                <ul>
                                    <li>Сотрудник обязан использовать свой позывной в начале каждого доклада или запроса о помощи в общую рацию сотрудников ОГИБДД-П</li>
                                    <li>Сотрудник обязан использовать тег "ОГИБДД-П" в начале докладов и/или запросов о помощи в общую рацию сотрудников МВД и общую рацию всех государственных организаций</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="radio-item">
                            <div class="label">Запреты сотрудника</div>
                            <div class="value">
                                <ul>
                                    <li>Запрещено использовать позывной, который закреплён за другим сотрудником</li>
                                    <li>Запрещено использовать свою фамилию или фамилию напарника вместо позывного(-ых)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Jurisdiction Section -->
                <section id="jurisdiction-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-map-marked-alt"></i>
                        <h2>Юрисдикции структур МВД</h2>
                    </div>
                    <p>Распределение зон ответственности и юрисдикций между структурными подразделениями МВД в городах Республики Провинция.</p>
                    
                    <div class="jurisdiction-map">
                        <img src="https://sun9-60.userapi.com/impg/JaNeolWVlVb2GT0NnuraXZnz8ZNwkGOm24x1Sg/yt6KDQXk-F8.jpg?size=1280x1280&quality=96&sign=0370a9a83347001d3ef0f0aacd45e9d8&type=album" alt="Карта юрисдикций МВД" class="jurisdiction-image">
                        <p><strong>Легенда:</strong> Мирный - синий / Приволжск - Зеленый / Невский - Красный</p>
                    </div>
                    
                    <div class="jurisdiction-info">
                        <div class="jurisdiction-card mirny">
                            <h3><i class="fas fa-city"></i> Город Мирный</h3>
                            <div class="weapon-info">
                                <div class="label">Цвет обозначения:</div>
                                <div class="value" style="color: #3b82f6;">Синий</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Ответственные подразделения:</div>
                                <div class="value">
                                    <ul>
                                        <li>ОГИБДД по г. Мирный</li>
                                        <li>Отдел полиции №1 г. Мирный</li>
                                        <li>Патрульно-постовая служба г. Мирный</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Особенности юрисдикции:</div>
                                <div class="value">Город Мирный является административным центром региона. Здесь расположены ключевые государственные учреждения и дипломатические представительства. Сотрудники МВД в Мирном обеспечивают безопасность важных государственных объектов и дипломатического корпуса.</div>
                            </div>
                        </div>
                        
                        <div class="jurisdiction-card privolzhsk">
                            <h3><i class="fas fa-industry"></i> Город Приволжск</h3>
                            <div class="weapon-info">
                                <div class="label">Цвет обозначения:</div>
                                <div class="value" style="color: #10b981;">Зеленый</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Ответственные подразделения:</div>
                                <div class="value">
                                    <ul>
                                        <li>ОГИБДД по г. Приволжск</li>
                                        <li>Отдел полиции №2 г. Приволжск</li>
                                        <li>Отдел по борьбе с экономическими преступлениями</li>
                                        <li>Транспортная полиция</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Особенности юрисдикции:</div>
                                <div class="value">Приволжск - промышленный и транспортный узел региона. Основные задачи МВД в Приволжске - обеспечение безопасности на транспортных магистралях, охрана промышленных объектов и борьба с экономическими преступлениями.</div>
                            </div>
                        </div>
                        
                        <div class="jurisdiction-card nevsky">
                            <h3><i class="fas fa-university"></i> Город Невский</h3>
                            <div class="weapon-info">
                                <div class="label">Цвет обозначения:</div>
                                <div class="value" style="color: #ef4444;">Красный</div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Ответственные подразделения:</div>
                                <div class="value">
                                    <ul>
                                        <li>ОГИБДД по г. Невский</li>
                                        <li>Отдел полиции №3 г. Невский</li>
                                        <li>Отдел по борьбе с организованной преступностью</li>
                                        <li>Кинологическая служба</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="weapon-info">
                                <div class="label">Особенности юрисдикции:</div>
                                <div class="value">Невский - культурный и исторический центр с развитой туристической инфраструктурой. Сотрудники МВД в Невском специализируются на обеспечении общественного порядка в местах массового скопления людей, охране культурных ценностей и борьбе с уличной преступностью.</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="map-description" style="margin-top: 30px;">
                        <h3><i class="fas fa-info-circle"></i> Взаимодействие между юрисдикциями</h3>
                        <p>Все подразделения МВД работают в тесном взаимодействии согласно единому плану оперативного реагирования. В случае возникновения чрезвычайных ситуаций или проведения масштабных операций, сотрудники разных юрисдикций могут быть временно переподчинены для выполнения общих задач.</p>
                        <p>Координацию совместных действий осуществляет Оперативный штаб МВД Республики Провинция, расположенный в г. Мирный.</p>
                    </div>
                </section>
                
                <!-- Map Section -->
                <section id="map-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-map"></i>
                        <h2>Карта постов</h2>
                    </div>
                    <p>Карта с расположением всех постов для патрулирования и контроля дорожного движения.</p>
                    
                    <div class="map-container">
                        <!-- Ваша карта постов -->
                        <img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXcOpJdcpV3DGQdJgU1dleoahP0emwSKqDDoaQF2dd7cB3Rg04zIwkYsxbXOEREAJBIKNzx9jvvE3LqX2jk5CC_DXFgLmlqF89loDME2Trcn2fkG5FnN67gvoThqfQpMlZw3tD5Qn-ZOfgtkFlgwGs4Q2B8?key=fuZgRRHThPhJ3hcp0pwv8g" alt="Карта постов ГИБДД" class="map-image">
                        
                        <div class="map-description">
                            <h3><i class="fas fa-info-circle"></i> Информация о постах</h3>
                            <p>Карта с расположением всех постов. Количество сотрудников на одном посту не ограничено.</p>
                            <p>На постах разрешено устанавливать специальные ограждения и заграждения, однако они должны быть установлены согласно приказу МВД.</p>
                        </div>
                    </div>
                </section>
                
                <!-- Statistics Section -->
                <section id="statistics-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        <h2>Статистика сотрудника</h2>
                    </div>
                    <p>Здесь отображается статистика и информация о сотруднике ГИБДД.</p>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Выдано штрафов</h3>
                            <div class="value" id="stat-fines">0</div>
                            <div class="label">Общее количество</div>
                            <div class="stat-controls">
                                <button class="btn btn-success" onclick="updateStat('fines', 1)"><i class="fas fa-plus"></i> +1</button>
                                <button class="btn btn-danger" onclick="updateStat('fines', -1)"><i class="fas fa-minus"></i> -1</button>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Задержано преступников</h3>
                            <div class="value" id="stat-arrests">0</div>
                            <div class="label">Общее количество</div>
                            <div class="stat-controls">
                                <button class="btn btn-success" onclick="updateStat('arrests', 1)"><i class="fas fa-plus"></i> +1</button>
                                <button class="btn btn-danger" onclick="updateStat('arrests', -1)"><i class="fas fa-minus"></i> -1</button>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Изъято прав</h3>
                            <div class="value" id="stat-licenses">0</div>
                            <div class="label">Общее количество</div>
                            <div class="stat-controls">
                                <button class="btn btn-success" onclick="updateStat('licenses', 1)"><i class="fas fa-plus"></i> +1</button>
                                <button class="btn btn-danger" onclick="updateStat('licenses', -1)"><i class="fas fa-minus"></i> -1</button>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Проведено досмотров</h3>
                            <div class="value" id="stat-searches">0</div>
                            <div class="label">Общее количество</div>
                            <div class="stat-controls">
                                <button class="btn btn-success" onclick="updateStat('searches', 1)"><i class="fas fa-plus"></i> +1</button>
                                <button class="btn btn-danger" onclick="updateStat('searches', -1)"><i class="fas fa-minus"></i> -1</button>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <h3>Общий рейтинг</h3>
                            <div class="value" id="stat-rating">0</div>
                            <div class="label">Баллы эффективности</div>
                            <div class="stat-controls">
                                <button class="btn btn-success" onclick="updateStat('rating', 1)"><i class="fas fa-plus"></i> +1</button>
                                <button class="btn btn-danger" onclick="updateStat('rating', -1)"><i class="fas fa-minus"></i> -1</button>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Leaderboard Section -->
                <section id="leaderboard-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-trophy"></i>
                        <h2>Таблица лидеров</h2>
                    </div>
                    <p>Рейтинги сотрудников ГИБДД по различным показателям эффективности.</p>
                    
                    <div class="leaderboard-tabs">
                        <div class="leaderboard-tab active" onclick="showLeaderboard('fines')">Штрафы</div>
                        <div class="leaderboard-tab" onclick="showLeaderboard('arrests')">Задержания</div>
                        <div class="leaderboard-tab" onclick="showLeaderboard('licenses')">Изъятия прав</div>
                        <div class="leaderboard-tab" onclick="showLeaderboard('searches')">Досмотры</div>
                    </div>
                    
                    <div id="leaderboard-fines" class="leaderboard-content">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Место</th>
                                    <th>Сотрудник</th>
                                    <th>Количество штрафов</th>
                                    <th>Звание</th>
                                    <th>Фракция</th>
                                </tr>
                            </thead>
                            <tbody id="fines-leaderboard">
                                <!-- Данные будут заполнены JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="leaderboard-arrests" class="leaderboard-content" style="display: none;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Место</th>
                                    <th>Сотрудник</th>
                                    <th>Задержания</th>
                                    <th>Звание</th>
                                    <th>Фракция</th>
                                </tr>
                            </thead>
                            <tbody id="arrests-leaderboard">
                                <!-- Данные будут заполнены JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="leaderboard-licenses" class="leaderboard-content" style="display: none;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Место</th>
                                    <th>Сотрудник</th>
                                    <th>Изъятия прав</th>
                                    <th>Звание</th>
                                    <th>Фракция</th>
                                </tr>
                            </thead>
                            <tbody id="licenses-leaderboard">
                                <!-- Данные будут заполнены JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="leaderboard-searches" class="leaderboard-content" style="display: none;">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Место</th>
                                    <th>Сотрудник</th>
                                    <th>Досмотры</th>
                                    <th>Звание</th>
                                    <th>Фракция</th>
                                </tr>
                            </thead>
                            <tbody id="searches-leaderboard">
                                <!-- Данные будут заполнены JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
                
                <!-- Profile Section -->
                <section id="profile-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-user"></i>
                        <h2>Профиль сотрудника</h2>
                    </div>
                    <p>Личная информация и статистика сотрудника.</p>
                    
                    <div class="profile-info">
                        <div class="profile-card">
                            <h3><i class="fas fa-id-card"></i> Основная информация</h3>
                            <div class="profile-field">
                                <span class="label">Игровой ник:</span>
                                <span class="value" id="profile-nickname">-</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Звание:</span>
                                <span class="value" id="profile-rank">-</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Должность:</span>
                                <span class="value" id="profile-position">-</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Фракция:</span>
                                <span class="value" id="profile-fraction">-</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Город:</span>
                                <span class="value" id="profile-city">-</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Статус:</span>
                                <span class="value" id="profile-status">-</span>
                            </div>
                        </div>
                        
                        <div class="profile-card">
                            <h3><i class="fas fa-chart-line"></i> Статистика службы</h3>
                            <div class="profile-field">
                                <span class="label">Выдано штрафов:</span>
                                <span class="value" id="profile-fines">0</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Задержано преступников:</span>
                                <span class="value" id="profile-arrests">0</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Изъято прав:</span>
                                <span class="value" id="profile-licenses">0</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Проведено досмотров:</span>
                                <span class="value" id="profile-searches">0</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Общий рейтинг:</span>
                                <span class="value" id="profile-rating">0</span>
                            </div>
                            <div class="profile-field">
                                <span class="label">Дата регистрации:</span>
                                <span class="value" id="profile-regdate">-</span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>
                        <h2>Настройки и кастомизация</h2>
                    </div>
                    <p>Настройте внешний вид и параметры вашего аккаунта.</p>
                    
                    <div class="settings-grid">
                        <div class="setting-card">
                            <h3><i class="fas fa-user-cog"></i> Настройки аккаунта</h3>
                            
                            <div class="setting-option">
                                <div class="setting-label">Смена пароля</div>
                                <div class="setting-description">Измените пароль для входа в систему</div>
                                <button class="btn btn-outline" onclick="showChangePasswordModal()"><i class="fas fa-lock"></i> Сменить пароль</button>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">Смена никнейма</div>
                                <div class="setting-description">Измените отображаемое имя</div>
                                <button class="btn btn-outline" onclick="showChangeNicknameModal(false)"><i class="fas fa-user-edit"></i> Сменить никнейм</button>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">Звание и должность</div>
                                <div class="setting-description">Выберите ваше звание и должность в организации</div>
                                <button class="btn btn-outline" onclick="showRankPositionModal(false)"><i class="fas fa-user-tie"></i> Выбрать звание/должность</button>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3><i class="fas fa-palette"></i> Внешний вид</h3>
                            
                            <div class="setting-option">
                                <div class="setting-label">Тема оформления</div>
                                <div class="setting-description">Выберите светлую или темную тему</div>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-outline" onclick="setTheme(false)" id="lightThemeBtn"><i class="fas fa-sun"></i> Светлая</button>
                                    <button class="btn btn-outline" onclick="setTheme(true)" id="darkThemeBtn"><i class="fas fa-moon"></i> Темная</button>
                                </div>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">Размер шрифта</div>
                                <div class="setting-description">Настройте размер текста для комфортного чтения</div>
                                <select id="fontSize" class="form-control" onchange="updateFontSize(this.value)">
                                    <option value="small">Маленький</option>
                                    <option value="medium" selected>Средний</option>
                                    <option value="large">Большой</option>
                                </select>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">Компактный режим</div>
                                <div class="setting-description">Уменьшите отступы для большего количества информации на экране</div>
                                <label class="switch">
                                    <input type="checkbox" id="compactMode" onchange="toggleCompactMode(this.checked)">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3><i class="fas fa-bell"></i> Уведомления</h3>
                            
                            <div class="setting-option">
                                <div class="setting-label">Email уведомления</div>
                                <div class="setting-description">Получать уведомления на электронную почту</div>
                                <label class="switch">
                                    <input type="checkbox" id="emailNotifications" onchange="updateNotificationSettings()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">Обновления системы</div>
                                <div class="setting-description">Уведомлять о новых функциях и обновлениях</div>
                                <label class="switch">
                                    <input type="checkbox" id="systemUpdates" onchange="updateNotificationSettings()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">Статистика активности</div>
                                <div class="setting-description">Еженедельный отчет о вашей активности</div>
                                <label class="switch">
                                    <input type="checkbox" id="weeklyReports" onchange="updateNotificationSettings()">
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="setting-card">
                            <h3><i class="fas fa-shield-alt"></i> Безопасность</h3>
                            
                            <div class="setting-option">
                                <div class="setting-label">Двухфакторная аутентификация</div>
                                <div class="setting-description">Дополнительная защита вашего аккаунта</div>
                                <button class="btn btn-outline" onclick="enableTwoFactorAuth()"><i class="fas fa-mobile-alt"></i> Включить 2FA</button>
                            </div>
                            
                            <div class="setting-option">
                                <div class="setting-label">История входов</div>
                                <div class="setting-description">Просмотр последних активностей вашего аккаунта</div>
                                <button class="btn btn-outline" onclick="showLoginHistory()"><i class="fas fa-history"></i> Показать историю</button>
                            </div>
                            
                            <div class="danger-zone">
                                <h4><i class="fas fa-exclamation-triangle"></i> Опасная зона</h4>
                                <div class="setting-description">Эти действия нельзя отменить</div>
                                <button class="btn btn-danger" onclick="showDeleteAccountModal()"><i class="fas fa-trash"></i> Удалить аккаунт</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Административные настройки (только для админов) -->
                    <div id="adminSettings" style="display: none; margin-top: 30px;">
                        <div class="section-title">
                            <i class="fas fa-user-shield"></i>
                            <h2>Административные настройки</h2>
                        </div>
                        
                        <div class="settings-grid">
                            <div class="setting-card">
                                <h3><i class="fas fa-users-cog"></i> Управление пользователями</h3>
                                
                                <div class="setting-option">
                                    <div class="setting-label">Смена никнеймов</div>
                                    <div class="setting-description">Изменить никнейм любому пользователю</div>
                                    <button class="btn btn-warning" onclick="showChangeNicknameModal(true)"><i class="fas fa-user-edit"></i> Сменить никнейм</button>
                                </div>
                                
                                <div class="setting-option">
                                    <div class="setting-label">Назначение званий</div>
                                    <div class="setting-description">Назначить звание и должность пользователям</div>
                                    <button class="btn btn-warning" onclick="showRankPositionModal(true)"><i class="fas fa-user-tie"></i> Назначить звание</button>
                                </div>
                            </div>
                            
                            <div class="setting-card">
                                <h3><i class="fas fa-chart-line"></i> Управление статистикой</h3>
                                
                                <div class="setting-option">
                                    <div class="setting-label">Редактирование статистики</div>
                                    <div class="setting-description">Изменение статистики любого пользователя</div>
                                    <button class="btn btn-warning" onclick="showEditStatsModal()"><i class="fas fa-edit"></i> Редактировать статистику</button>
                                </div>
                                
                                <div class="setting-option">
                                    <div class="setting-label">Сброс статистики</div>
                                    <div class="setting-description">Обнуление статистики пользователей</div>
                                    <button class="btn btn-danger" onclick="showResetStatsModal()"><i class="fas fa-eraser"></i> Сбросить статистику</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Admin Section -->
                <section id="admin-section" class="content-section" style="display: none;">
                    <div class="section-title">
                        <i class="fas fa-cogs"></i>
                        <h2>Административная панель</h2>
                    </div>
                    <p>Управление пользователями, назначение администраторов и другие административные функции.</p>
                    
                    <div class="admin-tabs">
                        <div class="admin-tab active" onclick="showAdminTab('users')">Пользователи</div>
                        <div class="admin-tab" onclick="showAdminTab('admins')">Администраторы</div>
                        <div class="admin-tab" onclick="showAdminTab('bans')">Баны</div>
                    </div>
                    
                    <!-- Вкладка управления пользователями -->
                    <div id="admin-users" class="admin-tab-content active">
                        <div class="admin-controls">
                            <div class="admin-card">
                                <h3><i class="fas fa-edit"></i> Изменить данные пользователя</h3>
                                <div class="form-group">
                                    <label for="editUser">Пользователь</label>
                                    <select id="editUser" class="form-control">
                                        <!-- Список пользователей будет заполнен JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="editFraction">Фракция</label>
                                    <select id="editFraction" class="form-control">
                                        <option value="ГИБДД">ГИБДД</option>
                                        <option value="ГИБДД Невского">ГИБДД Невского</option>
                                        <option value="ГИБДД Мирного">ГИБДД Мирного</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="editCity">Город</label>
                                    <select id="editCity" class="form-control">
                                        <option value="Приволжск">Приволжск</option>
                                        <option value="Невский">Невский</option>
                                        <option value="Мирный">Мирный</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="editRank">Звание</label>
                                    <select id="editRank" class="form-control">
                                        <option value="Рядовой">Рядовой</option>
                                        <option value="Сержант">Сержант</option>
                                        <option value="Старшина">Старшина</option>
                                        <option value="Прапорщик">Прапорщик</option>
                                        <option value="Лейтенант">Лейтенант</option>
                                        <option value="Старший лейтенант">Старший лейтенант</option>
                                        <option value="Капитан">Капитан</option>
                                        <option value="Майор">Майор</option>
                                        <option value="Подполковник">Подполковник</option>
                                        <option value="Полковник">Полковник</option>
                                        <option value="Генерал">Генерал</option>
                                        <option value="Следящий за фракцией">Следящий за фракцией</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="editPosition">Должность</label>
                                    <input type="text" id="editPosition" class="form-control" placeholder="Введите должность">
                                </div>
                                <button class="btn" onclick="saveUserChanges()"><i class="fas fa-save"></i> Сохранить изменения</button>
                            </div>
                            
                            <div class="admin-card">
                                <h3><i class="fas fa-user-shield"></i> Назначить администратора</h3>
                                <div class="form-group">
                                    <label for="adminUser">Пользователь</label>
                                    <select id="adminUser" class="form-control">
                                        <!-- Список пользователей будет заполнен JavaScript -->
                                    </select>
                                </div>
                                <button class="btn btn-warning" onclick="assignAdmin()"><i class="fas fa-user-cog"></i> Назначить администратором</button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3><i class="fas fa-users"></i> Список пользователей</h3>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Никнейм</th>
                                        <th>Звание</th>
                                        <th>Должность</th>
                                        <th>Фракция</th>
                                        <th>Город</th>
                                        <th>Статус</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTable">
                                    <!-- Данные будут заполнены JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Вкладка управления администраторами -->
                    <div id="admin-admins" class="admin-tab-content" style="display: none;">
                        <div class="admin-controls">
                            <div class="admin-card">
                                <h3><i class="fas fa-user-times"></i> Снять права администратора</h3>
                                <div class="form-group">
                                    <label for="removeAdminUser">Администратор</label>
                                    <select id="removeAdminUser" class="form-control">
                                        <!-- Список администраторов будет заполнен JavaScript -->
                                    </select>
                                </div>
                                <button class="btn btn-danger" onclick="removeAdmin()"><i class="fas fa-user-slash"></i> Снять права</button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3><i class="fas fa-user-shield"></i> Список администраторов</h3>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Никнейм</th>
                                        <th>Звание</th>
                                        <th>Должность</th>
                                        <th>Фракция</th>
                                        <th>Город</th>
                                        <th>Уровень доступа</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="adminsTable">
                                    <!-- Данные будут заполнены JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Вкладка управления банами -->
                    <div id="admin-bans" class="admin-tab-content" style="display: none;">
                        <div class="admin-controls">
                            <div class="admin-card">
                                <h3><i class="fas fa-ban"></i> Заблокировать пользователя</h3>
                                <div class="form-group">
                                    <label for="banUser">Пользователь</label>
                                    <select id="banUser" class="form-control">
                                        <!-- Список пользователей будет заполнен JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="banReason">Причина блокировки</label>
                                    <input type="text" id="banReason" class="form-control" placeholder="Введите причину">
                                </div>
                                <div class="form-group">
                                    <label for="banDuration">Срок блокировки (дни)</label>
                                    <input type="number" id="banDuration" class="form-control" placeholder="0 для перманентного бана" min="0">
                                </div>
                                <button class="btn btn-danger" onclick="banUser()"><i class="fas fa-ban"></i> Заблокировать</button>
                            </div>
                            
                            <div class="admin-card">
                                <h3><i class="fas fa-check-circle"></i> Разблокировать пользователя</h3>
                                <div class="form-group">
                                    <label for="unbanUser">Заблокированный пользователь</label>
                                    <select id="unbanUser" class="form-control">
                                        <!-- Список заблокированных пользователей будет заполнен JavaScript -->
                                    </select>
                                </div>
                                <button class="btn btn-success" onclick="unbanUser()"><i class="fas fa-unlock"></i> Разблокировать</button>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3><i class="fas fa-gavel"></i> Список заблокированных пользователей</h3>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Никнейм</th>
                                        <th>Причина</th>
                                        <th>Дата блокировки</th>
                                        <th>Дата разблокировки</th>
                                        <th>Заблокировал</th>
                                        <th>Действия</th>
                                    </tr>
                                </thead>
                                <tbody id="bansTable">
                                    <!-- Данные будут заполнены JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="stats-card">
                    <h3><i class="fas fa-chart-pie"></i> Моя статистика</h3>
                    <div class="stat-item">
                        <span>Выдано штрафов</span>
                        <span class="stat-value" id="sidebar-fines">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Задержано преступников</span>
                        <span class="stat-value" id="sidebar-arrests">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Изъято прав</span>
                        <span class="stat-value" id="sidebar-licenses">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Проведено досмотров</span>
                        <span class="stat-value" id="sidebar-searches">0</span>
                    </div>
                    <div class="stat-item">
                        <span>Рейтинговый балл</span>
                        <span class="stat-value" id="sidebar-rating">0</span>
                    </div>
                </div>
                
                <div class="quick-links">
                    <h3><i class="fas fa-link"></i> Быстрые ссылки</h3>
                    <ul class="links-list">
                        <li><a href="https://forum.gtaprovince.ru" target="_blank"><i class="fas fa-globe"></i> Официальный форум</a></li>
                        <li><a href="https://forum.gtaprovince.ru/forum/1767-zakonodatelnaya-baza/" target="_blank"><i class="fas fa-book"></i> База знаний</a></li>
                        <li><a href="#" onclick="showSection('binds')"><i class="fas fa-keyboard"></i> Бинды для игры</a></li>
                        <li><a href="#" onclick="showSection('commands')"><i class="fas fa-terminal"></i> Игровые команды</a></li>
                        <li><a href="#" onclick="showSection('documents')"><i class="fas fa-file-alt"></i> Нормативные документы</a></li>
                        <li><a href="#" onclick="showSection('map')"><i class="fas fa-map"></i> Карта постов</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ГИБДД Республики Провинция</h3>
                    <p>Официальный сайт дорожно-патрульной службы для сотрудников фракции в MTA Province.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Разделы сайта</h3>
                    <ul class="footer-links">
                        <li><a href="#" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Главная</a></li>
                        <li><a href="#" onclick="showSection('binds')"><i class="fas fa-keyboard"></i> Бинды</a></li>
                        <li><a href="#" onclick="showSection('commands')"><i class="fas fa-terminal"></i> Команды</a></li>
                        <li><a href="#" onclick="showSection('documents')"><i class="fas fa-file-alt"></i> Документы</a></li>
                        <li><a href="#" onclick="showSection('map')"><i class="fas fa-map"></i> Карта постов</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Полезные ресурсы</h3>
                    <ul class="footer-links">
                        <li><a href="https://forum.gtaprovince.ru" target="_blank"><i class="fas fa-globe"></i> Официальный форум</a></li>
                        <li><a href="https://forum.gtaprovince.ru/forum/1767-zakonodatelnaya-baza/" target="_blank"><i class="fas fa-book"></i> База знаний</a></li>
                        <li><a href="#" onclick="alert('Раздел в разработке')"><i class="fas fa-graduation-cap"></i> Обучение для новичков</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                made by <a href="https://vk.com/alexandro_vorobyev" target="_blank">Alexander_Vorobyev</a>
            </div>
        </div>
    </footer>

    <script>
        // ==================== КОНФИГУРАЦИЯ SUPABASE ====================
        const SUPABASE_URL = 'https://vosimalhgssrwebzdtod.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvc2ltYWxoZ3NzcndlYnpkdG9kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5ODg0NDgsImV4cCI6MjA3OTU2NDQ0OH0.ypMMMoJ6RMQHdP7DKAJX76aEjKRILPQvd3uB8mCjn28';

        // Инициализация Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ==================== СИСТЕМА РОЛЕЙ ====================
        const PERMISSION_LEVELS = {
          USER: 0,
          HELPER: 1,
          MODERATOR: 2,
          ADMIN: 3,
          SUPER_ADMIN: 4
        };

        const ROLES = {
          USER: { 
            level: 0, 
            name: "Гражданский", 
            permissions: ['view_own_stats', 'edit_own_stats', 'view_binds', 'view_commands', 'view_documents', 'view_map'] 
          },
          HELPER: { 
            level: 1, 
            name: "Помощник", 
            permissions: ['view_own_stats', 'edit_own_stats', 'view_binds', 'view_commands', 'view_documents', 'view_map', 'view_all_stats', 'view_users'] 
          },
          MODERATOR: { 
            level: 2, 
            name: "Модератор", 
            permissions: ['view_own_stats', 'edit_own_stats', 'view_binds', 'view_commands', 'view_documents', 'view_map', 'view_all_stats', 'view_users', 'ban_users', 'edit_stats', 'view_logs'] 
          },
          ADMIN: { 
            level: 3, 
            name: "Администратор", 
            permissions: ['view_own_stats', 'edit_own_stats', 'view_binds', 'view_commands', 'view_documents', 'view_map', 'view_all_stats', 'view_users', 'ban_users', 'edit_stats', 'view_logs', 'manage_users', 'assign_roles', 'system_settings'] 
          },
          SUPER_ADMIN: { 
            level: 4, 
            name: "Главный Администратор", 
            permissions: ['all'] 
          }
        };

        const SUPER_ADMINS = [
          { username: "Alexander_Vorobyev", email: "alexandro_vorobyev@vk.com" }
        ];

        // Глобальные переменные
        let currentUser = null;
        let currentUserStats = null;
        let allUsers = [];

        // ==================== ФУНКЦИИ АВТОРИЗАЦИИ ====================

        // Хеширование пароля
        async function hashPassword(password) {
          const encoder = new TextEncoder();
          const data = encoder.encode(password);
          const hash = await crypto.subtle.digest('SHA-256', data);
          return Array.from(new Uint8Array(hash))
            .map(b => b.toString(16).padStart(2, '0'))
            .join('');
        }

        // Проверка является ли пользователь суперадмином
        function isSuperAdmin(userData) {
          return SUPER_ADMINS.some(sa => 
            sa.username === userData.username || 
            sa.email === userData.email
          );
        }

// Регистрация пользователя
async function registerUser(userData) {
  try {
    // Проверяем, нет ли уже пользователя с таким логином или email
    const { data: existingUsers, error: checkError } = await supabase
      .from('users')
      .select('id')
      .or(`username.eq.${userData.username},email.eq.${userData.email}`);

    if (checkError) throw checkError;
    if (existingUsers && existingUsers.length > 0) {
      throw new Error('Пользователь с таким логином или email уже существует');
    }

    // Создаем пользователя
    const { data: user, error } = await supabase
      .from('users')
      .insert([{
        nickname: userData.nickname,
        username: userData.username,
        email: userData.email,
        password_hash: await hashPassword(userData.password),
        role: isSuperAdmin(userData) ? 'SUPER_ADMIN' : 'USER',
        rank: 'Гражданский',
        position: '',
        fraction: '',
        city: 'Приvolжск'
      }])
      .select()
      .single();

    if (error) throw error;

    // Создаем запись статистики
    const { error: statsError } = await supabase
      .from('user_stats')
      .insert([{
        user_id: user.id,
        fines: 0,
        arrests: 0,
        licenses: 0,
        searches: 0,
        rating: 0
      }]);

    if (statsError) throw statsError;

    // Автоматически логиним пользователя после регистрации
    const loginResult = await loginUser(userData.username, userData.password);
    return loginResult;

  } catch (error) {
    console.error('Registration error:', error);
    return { success: false, error: error.message };
  }
}

// Вход пользователя
async function loginUser(login, password) {
  try {
    // Ищем пользователя - убираем требования к 2FA полям
    const { data: user, error } = await supabase
      .from('users')
      .select('*')
      .or(`username.eq.${login},email.eq.${login}`)
      .single();

    if (error) throw error;

    // Проверяем пароль
    const isPasswordValid = await hashPassword(password) === user.password_hash;
    if (!isPasswordValid) throw new Error('Неверный пароль');

    // Проверяем бан
    if (user.banned && user.ban_expires && new Date(user.ban_expires) > new Date()) {
      throw new Error(`Аккаунт заблокирован. Причина: ${user.ban_reason}. Разблокировка: ${new Date(user.ban_expires).toLocaleDateString()}`);
    }

    // Если бан истек, разблокируем
    if (user.banned && user.ban_expires && new Date(user.ban_expires) <= new Date()) {
      await supabase
        .from('users')
        .update({ 
          banned: false, 
          ban_reason: null, 
          ban_expires: null, 
          banned_by: null 
        })
        .eq('id', user.id);
      user.banned = false;
    }

    // Убедимся, что поля 2FA существуют (могут быть null)
    user.two_factor_enabled = user.two_factor_enabled || false;
    user.two_factor_secret = user.two_factor_secret || null;

    // Сохраняем пользователя в localStorage
    localStorage.setItem('currentUser', JSON.stringify(user));
    
    return { success: true, user };
  } catch (error) {
    console.error('Login error:', error);
    return { success: false, error: error.message };
  }
}
        // Проверка авторизации
async function checkAuth() {
  const storedUser = localStorage.getItem('currentUser');
  if (!storedUser) return null;

  try {
    const user = JSON.parse(storedUser);
    
    // Получаем свежие данные пользователя
    const { data: freshUser, error } = await supabase
      .from('users')
      .select('*')
      .eq('id', user.id)
      .single();

    if (error) throw error;

    // Убедимся, что поля 2FA существуют
    freshUser.two_factor_enabled = freshUser.two_factor_enabled || false;
    freshUser.two_factor_secret = freshUser.two_factor_secret || null;

    // Если пользователь забанен, выходим
    if (freshUser.banned && freshUser.ban_expires && new Date(freshUser.ban_expires) > new Date()) {
      localStorage.removeItem('currentUser');
      return null;
    }

    return freshUser;
  } catch (error) {
    localStorage.removeItem('currentUser');
    return null;
  }
}
        // Выход
        function logout() {
          localStorage.removeItem('currentUser');
          currentUser = null;
          currentUserStats = null;
          location.reload();
        }

        // ==================== ФУНКЦИИ СТАТИСТИКИ ====================

        // Получение статистики пользователя
        async function getUserStats(userId) {
          try {
            const { data, error } = await supabase
              .from('user_stats')
              .select('*')
              .eq('user_id', userId)
              .single();

            return error ? null : data;
          } catch (error) {
            console.error('Get stats error:', error);
            return null;
          }
        }

        // Обновление статистики
        async function updateUserStats(userId, statType, value) {
          try {
            // Сначала получаем текущую статистику
            const currentStats = await getUserStats(userId);
            if (!currentStats) return false;

            // Обновляем нужное поле
            const updatedStats = { ...currentStats };
            updatedStats[statType] = Math.max(0, currentStats[statType] + value);
            updatedStats.updated_at = new Date().toISOString();

            // Обновляем в базе
            const { error } = await supabase
              .from('user_stats')
              .update(updatedStats)
              .eq('user_id', userId);

            if (error) throw error;

            return true;
          } catch (error) {
            console.error('Update stats error:', error);
            return false;
          }
        }

        // Получение таблицы лидеров
        async function getLeaderboard(type = 'fines', limit = 50) {
          try {
            const { data, error } = await supabase
              .from('user_stats')
              .select(`
                fines, arrests, licenses, searches, rating,
                users (id, nickname, rank, fraction, city, banned)
              `)
              .not('users.banned', 'is', true)
              .order(type, { ascending: false })
              .limit(limit);

            return error ? [] : data;
          } catch (error) {
            console.error('Leaderboard error:', error);
            return [];
          }
        }

        // ==================== АДМИНИСТРАТИВНЫЕ ФУНКЦИИ ====================

        // Получение всех пользователей
        async function getAllUsers() {
          try {
            const { data, error } = await supabase
              .from('users')
              .select('*, user_stats (fines, arrests, licenses, searches, rating)')
              .order('created_at', { ascending: false });

            if (error) throw error;
            return data || [];
          } catch (error) {
            console.error('Get users error:', error);
            return [];
          }
        }

        // Обновление данных пользователя
        async function updateUserInDatabase(userId, userData) {
          try {
            const { error } = await supabase
              .from('users')
              .update({
                ...userData,
                updated_at: new Date().toISOString()
              })
              .eq('id', userId);

            return !error;
          } catch (error) {
            console.error('Update user error:', error);
            return false;
          }
        }

        // Функция для обработки формы
        async function saveUserChanges() {
          if (!requirePermission('manage_users')) return;
          
          const userId = parseInt(document.getElementById('editUser').value);
          const fraction = document.getElementById('editFraction').value;
          const city = document.getElementById('editCity').value;
          const rank = document.getElementById('editRank').value;
          const position = document.getElementById('editPosition').value;
          
          if (!userId) {
            showError('Выберите пользователя');
            return;
          }
          
          try {
            const success = await updateUserInDatabase(userId, {
              fraction,
              city,
              rank,
              position
            });
            
            if (success) {
              alert('✅ Данные пользователя обновлены!');
              loadUsersForAdmin();
              logAdminAction('update_user_data', userId, `Обновлены данные: ${fraction}, ${city}, ${rank}, ${position}`);
            } else {
              showError('Ошибка при обновлении данных');
            }
          } catch (error) {
            console.error('Error updating user data:', error);
            showError('Ошибка при обновлении данных');
          }
        }

        // Блокировка пользователя
        async function banUserInDatabase(userId, reason, durationDays = 0, adminName) {
          try {
            const banExpires = durationDays > 0 ? 
              new Date(Date.now() + durationDays * 24 * 60 * 60 * 1000).toISOString() : 
              null;

            const { error } = await supabase
              .from('users')
              .update({
                banned: true,
                ban_reason: reason,
                ban_expires: banExpires,
                banned_by: adminName,
                updated_at: new Date().toISOString()
              })
              .eq('id', userId);

            return !error;
          } catch (error) {
            console.error('Ban user error:', error);
            return false;
          }
        }

        // Разблокировка пользователя
        async function unbanUserInDatabase(userId) {
          try {
            const { error } = await supabase
              .from('users')
              .update({
                banned: false,
                ban_reason: null,
                ban_expires: null,
                banned_by: null,
                updated_at: new Date().toISOString()
              })
              .eq('id', userId);

            return !error;
          } catch (error) {
            console.error('Unban user error:', error);
            return false;
          }
        }

        // Логирование действий
        async function logAdminAction(action, target = null, details = '') {
          if (!currentUser) return true;

          try {
            const { error } = await supabase
              .from('admin_logs')
              .insert([{
                admin_id: currentUser.id,
                admin_name: currentUser.nickname,
                admin_role: currentUser.role,
                action: action,
                target: target,
                details: details,
                timestamp: new Date().toISOString()
              }]);

            return !error;
          } catch (error) {
            console.error('Log action error:', error);
            return false;
          }
        }

        // ==================== ПРОВЕРКА ПРАВ ====================

        function hasPermission(user, permission) {
          if (!user) return false;
          if (user.role === 'SUPER_ADMIN' || isSuperAdmin(user)) return true;
          
          const role = ROLES[user.role];
          return role && (role.permissions.includes(permission) || role.permissions.includes('all'));
        }

        function requirePermission(permission) {
          if (!hasPermission(currentUser, permission)) {
            showError('Недостаточно прав для выполнения этого действия');
            return false;
          }
          return true;
        }

        function showError(message) {
          alert('❌ ' + message);
        }

        // ==================== ИНИЦИАЛИЗАЦИЯ И UI ====================

        let isDarkTheme = localStorage.getItem('darkTheme') === 'true';

        // Применение темы
        function applyTheme() {
          if (isDarkTheme) {
            document.body.classList.add('dark-theme');
            document.getElementById('themeToggle').textContent = '☀️';
          } else {
            document.body.classList.remove('dark-theme');
            document.getElementById('themeToggle').textContent = '🌙';
          }
        }

        // Показать/скрыть модальное окно авторизации
        function showAuthModal() {
          document.getElementById('authModal').style.display = 'flex';
        }

        function hideAuthModal() {
          document.getElementById('authModal').style.display = 'none';
        }

        // Переключение между формами входа и регистрации
        function showAuthForm(formType) {
          document.getElementById('loginForm').classList.remove('active');
          document.getElementById('registerForm').classList.remove('active');
          document.querySelectorAll('.auth-tab').forEach(tab => tab.classList.remove('active'));
          
          if (formType === 'login') {
            document.getElementById('loginForm').classList.add('active');
            document.querySelectorAll('.auth-tab')[0].classList.add('active');
          } else {
            document.getElementById('registerForm').classList.add('active');
            document.querySelectorAll('.auth-tab')[1].classList.add('active');
          }
        }

        // Обновление интерфейса пользователя
        async function updateUserInterface() {
          if (!currentUser) return;

          // Получаем свежую статистику
          currentUserStats = await getUserStats(currentUser.id);

          // Обновляем UI
          document.querySelector('.user-name').textContent = currentUser.nickname;
          
          let displayRank = currentUser.rank;
          let statusBadge = '';
          
          if (isSuperAdmin(currentUser)) {
            statusBadge = '<span class="super-admin-badge">ГЛАВНЫЙ АДМИНИСТРАТОР</span>';
          } else if (currentUser.role === 'ADMIN') {
            statusBadge = '<span class="admin-badge">АДМИНИСТРАТОР</span>';
          } else if (currentUser.role === 'MODERATOR') {
            statusBadge = '<span class="admin-badge" style="background: #f59e0b;">МОДЕРАТОР</span>';
          } else if (currentUser.role === 'HELPER') {
            statusBadge = '<span class="admin-badge" style="background: #10b981;">ПОМОЩНИК</span>';
          }
          
          document.querySelector('.user-rank').innerHTML = displayRank + statusBadge;
          document.querySelector('.user-avatar').textContent = currentUser.nickname.charAt(0).toUpperCase();

          // Обновляем статистику в сайдбаре
          if (currentUserStats) {
            document.getElementById('sidebar-fines').textContent = currentUserStats.fines;
            document.getElementById('sidebar-arrests').textContent = currentUserStats.arrests;
            document.getElementById('sidebar-licenses').textContent = currentUserStats.licenses;
            document.getElementById('sidebar-searches').textContent = currentUserStats.searches;
            document.getElementById('sidebar-rating').textContent = currentUserStats.rating;

            document.getElementById('stat-fines').textContent = currentUserStats.fines;
            document.getElementById('stat-arrests').textContent = currentUserStats.arrests;
            document.getElementById('stat-licenses').textContent = currentUserStats.licenses;
            document.getElementById('stat-searches').textContent = currentUserStats.searches;
            document.getElementById('stat-rating').textContent = currentUserStats.rating;
          }

          // Показываем/скрываем админ-панель
          if (hasPermission(currentUser, 'view_users')) {
            document.getElementById('adminTab').style.display = 'block';
          } else {
            document.getElementById('adminTab').style.display = 'none';
          }

          document.getElementById('profileTab').style.display = 'block';
          document.getElementById('settingsTab').style.display = 'block';
        }

        // Обновление информации в профиле
        function updateProfileInfo() {
          if (!currentUser || !currentUserStats) return;

          document.getElementById('profile-nickname').textContent = currentUser.nickname;
          document.getElementById('profile-rank').textContent = currentUser.rank;
          document.getElementById('profile-position').textContent = currentUser.position;
          document.getElementById('profile-fraction').textContent = currentUser.fraction;
          document.getElementById('profile-city').textContent = currentUser.city;
          
          let status = 'Активен';
          if (currentUser.banned) {
            status = 'Заблокирован';
          } else if (isSuperAdmin(currentUser)) {
            status = 'Главный Администратор';
          } else if (currentUser.role === 'ADMIN') {
            status = 'Администратор';
          } else if (currentUser.role === 'MODERATOR') {
            status = 'Модератор';
          } else if (currentUser.role === 'HELPER') {
            status = 'Помощник';
          } else if (currentUser.role === 'USER') {
            status = 'Гражданский';
          }
          document.getElementById('profile-status').textContent = status;
          
          document.getElementById('profile-fines').textContent = currentUserStats.fines;
          document.getElementById('profile-arrests').textContent = currentUserStats.arrests;
          document.getElementById('profile-licenses').textContent = currentUserStats.licenses;
          document.getElementById('profile-searches').textContent = currentUserStats.searches;
          document.getElementById('profile-rating').textContent = currentUserStats.rating;
          
          const regDate = new Date(currentUser.registration_date || currentUser.created_at);
          document.getElementById('profile-regdate').textContent = regDate.toLocaleDateString('ru-RU');
        }

        // Обновление статистики
        async function updateStat(stat, value) {
          if (!currentUser) {
            showError('Необходимо авторизоваться');
            return;
          }

          const success = await updateUserStats(currentUser.id, stat, value);
          if (success) {
            // Обновляем локальные данные
            currentUserStats[stat] = Math.max(0, currentUserStats[stat] + value);
            updateUserInterface();
            updateProfileInfo();
            
            logAdminAction('edit_stats', currentUser.id, `Изменение статистики: ${stat} на ${value}`);
          } else {
            showError('Ошибка при обновлении статистики');
          }
        }

        // Обновление таблицы лидеров
        async function updateLeaderboards() {
          const finesData = await getLeaderboard('fines');
          const arrestsData = await getLeaderboard('arrests');
          const licensesData = await getLeaderboard('licenses');
          const searchesData = await getLeaderboard('searches');

          // Заполняем таблицу штрафов
          const finesTable = document.getElementById('fines-leaderboard');
          finesTable.innerHTML = '';
          finesData.forEach((item, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${item.users.nickname}</td>
              <td>${item.fines}</td>
              <td>${item.users.rank}</td>
              <td>${item.users.fraction}</td>
            `;
            finesTable.appendChild(row);
          });

          // Заполняем таблицу задержаний
          const arrestsTable = document.getElementById('arrests-leaderboard');
          arrestsTable.innerHTML = '';
          arrestsData.forEach((item, index) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>${item.users.nickname}</td>
              <td>${item.arrests}</td>
              <td>${item.users.rank}</td>
              <td>${item.users.fraction}</td>
            `;
            arrestsTable.appendChild(row);
          });

          // Аналогично для остальных таблиц...
        }

        // ==================== ОБРАБОТЧИКИ СОБЫТИЙ ====================

        document.addEventListener('DOMContentLoaded', async function() {
          // Инициализация темы
          applyTheme();
          
          // Проверяем авторизацию
          currentUser = await checkAuth();
          
          if (currentUser) {
            currentUserStats = await getUserStats(currentUser.id);
            updateUserInterface();
            hideAuthModal();
          } else {
            showAuthModal();
          }
          
          // Показываем главную страницу
          showSection('dashboard');
          
          // Загружаем всех пользователей для админ-панели
          allUsers = await getAllUsers();
        });

        // Переключение темы
        document.getElementById('themeToggle').addEventListener('click', function() {
          isDarkTheme = !isDarkTheme;
          localStorage.setItem('darkTheme', isDarkTheme);
          applyTheme();
        });

// Обработка формы входа
document.getElementById('loginForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const username = document.getElementById('loginUsername').value;
  const password = document.getElementById('loginPassword').value;
  
  console.log('🔄 Попытка входа:', username); // ДЛЯ ОТЛАДКИ
  
  const result = await loginUser(username, password);
  
  console.log('📊 Результат входа:', result); // ДЛЯ ОТЛАДКИ
  
  if (result.success) {
    currentUser = result.user;
    currentUserStats = await getUserStats(currentUser.id);
    updateUserInterface();
    hideAuthModal();
    alert('✅ Вход выполнен успешно!');
  } else {
    alert('❌ ' + result.error);
  }
});

        // Обработка формы регистрации
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const formData = {
            nickname: document.getElementById('registerNickname').value,
            username: document.getElementById('registerUsername').value,
            email: document.getElementById('registerEmail').value,
            password: document.getElementById('registerPassword').value
          };
          
          const confirmPassword = document.getElementById('registerConfirmPassword').value;
          
          if (formData.password !== confirmPassword) {
            alert('❌ Пароли не совпадают!');
            return;
          }
          
          const result = await registerUser(formData);
          
          if (result.success) {
            currentUser = result.user;
            currentUserStats = await getUserStats(currentUser.id);
            updateUserInterface();
            hideAuthModal();
            
            if (isSuperAdmin(currentUser)) {
              alert('🎉 Регистрация успешна! Вы стали Главным Администратором системы.');
            } else {
              alert('🎉 Регистрация успешна! Ваша роль: Гражданский');
            }
          } else {
            alert('❌ ' + result.error);
          }
        });

        // Функция для переключения между разделами
        function showSection(sectionName) {
          // Скрываем все разделы
          document.querySelectorAll('.content-section').forEach(section => {
            section.style.display = 'none';
          });
          
          // Показываем нужный раздел
          document.getElementById(sectionName + '-section').style.display = 'block';
          
          // Обновляем активную вкладку в навигации
          document.querySelectorAll('.nav-tabs a').forEach(link => {
            link.classList.remove('active');
          });
          
          // Находим и активируем соответствующую ссылку
          const activeLink = Array.from(document.querySelectorAll('.nav-tabs a')).find(link => 
            link.getAttribute('onclick')?.includes(sectionName)
          );
          if (activeLink) {
            activeLink.classList.add('active');
          }
          
          // Специальные действия для некоторых разделов
          if (sectionName === 'leaderboard') {
            updateLeaderboards();
          } else if (sectionName === 'profile') {
            updateProfileInfo();
          } else if (sectionName === 'admin' && hasPermission(currentUser, 'view_users')) {
            showAdminTab('users'); // Показываем первую вкладку по умолчанию
          } else if (sectionName === 'statistics' && currentUserStats) {
            document.getElementById('stat-fines').textContent = currentUserStats.fines;
            document.getElementById('stat-arrests').textContent = currentUserStats.arrests;
            document.getElementById('stat-licenses').textContent = currentUserStats.licenses;
            document.getElementById('stat-searches').textContent = currentUserStats.searches;
            document.getElementById('stat-rating').textContent = currentUserStats.rating;
          } else if (sectionName === 'settings') {
            loadSettings();
          }
        }

        // Функция для копирования биндов
        function copyBind(key) {
          const bindText = `bind ${key}`;
          navigator.clipboard.writeText(bindText)
            .then(() => alert(`Бинд "${bindText}" скопирован!`))
            .catch(err => console.error('Ошибка копирования: ', err));
        }

        function copyBindText(text) {
          navigator.clipboard.writeText(text)
            .then(() => alert('Бинд скопирован!'))
            .catch(err => console.error('Ошибка копирования: ', err));
        }

        // Переключение формы профиля
        function toggleProfileForm() {
          if (currentUser) {
            showSection('profile');
          } else {
            showAuthModal();
          }
        }

        // ==================== ДОПОЛНИТЕЛЬНЫЕ ФУНКЦИИ ДЛЯ АДМИН-ПАНЕЛИ ====================

        // Показать вкладку админ-панели
        function showAdminTab(tabName) {
            // Скрываем все вкладки
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Показываем нужную вкладку
            document.getElementById(`admin-${tabName}`).style.display = 'block';
            
            // Обновляем активные табы
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Загружаем данные для вкладки
            if (tabName === 'users') {
                loadUsersForAdmin();
            } else if (tabName === 'admins') {
                loadAdminsForAdmin();
            } else if (tabName === 'bans') {
                loadBansForAdmin();
            }
        }

        // Обновленная функция загрузки пользователей для админ-панели
window.loadUsersForAdmin = async function() {
    console.log('🔄 Загрузка пользователей для админки');
    
    try {
        // Получаем всех пользователей из базы
        const { data: users, error } = await supabase
            .from('users')
            .select('*')
            .order('created_at', { ascending: false });

        if (error) {
            console.error('❌ Ошибка загрузки пользователей:', error);
            return;
        }

        console.log('✅ Пользователи загружены:', users);
        allUsers = users;

        // Заполняем выпадающие списки
        const editUserSelect = document.getElementById('editUser');
        const adminUserSelect = document.getElementById('adminUser');
        const banUserSelect = document.getElementById('banUser');
        const removeAdminSelect = document.getElementById('removeAdminUser');
        const unbanSelect = document.getElementById('unbanUser');

        // Очищаем списки
        [editUserSelect, adminUserSelect, banUserSelect, removeAdminSelect, unbanSelect].forEach(select => {
            if (select) {
                select.innerHTML = '<option value="">Выберите пользователя</option>';
            }
        });

        // Заполняем списки
        users.forEach(user => {
            if (user.id === currentUser.id) return;

            const optionText = `${user.nickname} (${user.role})${user.banned ? ' ⛔' : ''}`;

            // Для редактирования - все пользователи
            if (editUserSelect) {
                const editOption = document.createElement('option');
                editOption.value = user.id;
                editOption.textContent = optionText;
                editUserSelect.appendChild(editOption);
            }

            // Для назначения админа - только обычные пользователи не в бане
            if (adminUserSelect && user.role === 'USER' && !user.banned) {
                const adminOption = document.createElement('option');
                adminOption.value = user.id;
                adminOption.textContent = user.nickname;
                adminUserSelect.appendChild(adminOption);
            }

            // Для бана - все пользователи кроме суперадминов и тех, кто уже в бане
            if (banUserSelect && !isSuperAdmin(user) && !user.banned) {
                const banOption = document.createElement('option');
                banOption.value = user.id;
                banOption.textContent = user.nickname;
                banUserSelect.appendChild(banOption);
            }

            // Для снятия прав - только админы и модераторы не в бане
            if (removeAdminSelect && (user.role === 'ADMIN' || user.role === 'MODERATOR') && !user.banned) {
                const removeAdminOption = document.createElement('option');
                removeAdminOption.value = user.id;
                removeAdminOption.textContent = user.nickname;
                removeAdminSelect.appendChild(removeAdminOption);
            }

            // Для разбана - только заблокированные
            if (unbanSelect && user.banned) {
                const unbanOption = document.createElement('option');
                unbanOption.value = user.id;
                
                const banInfo = user.ban_expires ? 
                    ` (до ${new Date(user.ban_expires).toLocaleDateString('ru-RU')})` : 
                    ' (перманентно)';
                    
                unbanOption.textContent = user.nickname + banInfo;
                unbanSelect.appendChild(unbanOption);
            }
        });

        // Заполняем таблицу пользователей
        const usersTable = document.getElementById('usersTable');
        if (usersTable) {
            usersTable.innerHTML = '';
            
            if (users.length === 0) {
                usersTable.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            Нет пользователей
                        </td>
                    </tr>
                `;
                return;
            }
            
            users.forEach(user => {
                const row = document.createElement('tr');
                
                let roleBadge = '';
                if (isSuperAdmin(user)) {
                    roleBadge = '<span style="color: gold;">Главный Админ</span>';
                } else if (user.role === 'ADMIN') {
                    roleBadge = '<span style="color: var(--accent);">Админ</span>';
                } else if (user.role === 'MODERATOR') {
                    roleBadge = '<span style="color: #f59e0b;">Модератор</span>';
                } else if (user.role === 'HELPER') {
                    roleBadge = '<span style="color: #10b981;">Помощник</span>';
                } else {
                    roleBadge = 'Гражданский';
                }

                const statusBadge = user.banned ? 
                    '<span style="color: var(--danger);">⛔ Заблокирован</span>' : 
                    '<span style="color: var(--success);">✅ Активен</span>';

                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.nickname}</td>
                    <td>${user.rank}</td>
                    <td>${user.position}</td>
                    <td>${user.fraction}</td>
                    <td>${user.city}</td>
                    <td>${roleBadge}</td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="selectUserForEdit(${user.id})">
                            <i class="fas fa-edit"></i> Изменить
                        </button>
                    </td>
                `;
                usersTable.appendChild(row);
            });
        }

    } catch (error) {
        console.error('❌ Ошибка загрузки пользователей:', error);
    }
};

        // Загрузка администраторов
        async function loadAdminsForAdmin() {
            if (!requirePermission('view_users')) return;
            
            try {
                const users = await getAllUsers();
                const admins = users.filter(user => 
                    user.role !== 'USER' && user.role !== 'HELPER' && !isSuperAdmin(user)
                );
                
                // Заполняем выпадающий список для снятия прав
                const removeAdminSelect = document.getElementById('removeAdminUser');
                removeAdminSelect.innerHTML = '';
                
                admins.forEach(admin => {
                    const option = document.createElement('option');
                    option.value = admin.id;
                    option.textContent = `${admin.nickname} (${admin.role})`;
                    removeAdminSelect.appendChild(option);
                });
                
                // Заполняем таблицу администраторов
                const adminsTable = document.getElementById('adminsTable');
                adminsTable.innerHTML = '';
                
                admins.forEach(admin => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${admin.id}</td>
                        <td>${admin.nickname}</td>
                        <td>${admin.rank}</td>
                        <td>${admin.position}</td>
                        <td>${admin.fraction}</td>
                        <td>${admin.city}</td>
                        <td>${admin.role === 'ADMIN' ? 'Администратор' : 'Модератор'}</td>
                        <td>
                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;" onclick="removeAdminPrompt(${admin.id})">Снять права</button>
                        </td>
                    `;
                    adminsTable.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading admins:', error);
                showError('Ошибка загрузки администраторов');
            }
        }

        // Загрузка банов
        async function loadBansForAdmin() {
            if (!requirePermission('view_logs')) return;
            
            try {
                const users = await getAllUsers();
                const bannedUsers = users.filter(user => user.banned);
                
                // Заполняем выпадающий список для разбана
                const unbanSelect = document.getElementById('unbanUser');
                unbanSelect.innerHTML = '';
                
                bannedUsers.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = user.nickname;
                    unbanSelect.appendChild(option);
                });
                
                // Заполняем таблицу банов
                const bansTable = document.getElementById('bansTable');
                bansTable.innerHTML = '';
                
                bannedUsers.forEach(user => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.nickname}</td>
                        <td>${user.ban_reason || 'Не указана'}</td>
                        <td>${user.ban_date ? new Date(user.ban_date).toLocaleDateString('ru-RU') : 'Неизвестно'}</td>
                        <td>${user.ban_expires ? new Date(user.ban_expires).toLocaleDateString('ru-RU') : 'Перманентно'}</td>
                        <td>${user.banned_by || 'Система'}</td>
                        <td>
                            <button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8rem;" onclick="unbanUserPrompt(${user.id})">Разблокировать</button>
                        </td>
                    `;
                    bansTable.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading bans:', error);
                showError('Ошибка загрузки списка банов');
            }
        }

        // ==================== ФУНКЦИИ ДЛЯ ТАБЛИЦЫ ЛИДЕРОВ ====================

        // Показать определенную таблицу лидеров
        function showLeaderboard(type) {
            // Скрываем все таблицы
            document.querySelectorAll('.leaderboard-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Показываем нужную таблицу
            document.getElementById(`leaderboard-${type}`).style.display = 'block';
            
            // Обновляем активные табы
            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Обновляем данные для этой таблицы
            updateLeaderboardTable(type);
        }

        // Обновление конкретной таблицы лидеров
        async function updateLeaderboardTable(type) {
            try {
                const data = await getLeaderboard(type);
                const tableId = `${type}-leaderboard`;
                const table = document.getElementById(tableId);
                
                if (!table) return;
                
                table.innerHTML = '';
                
                data.forEach((item, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${item.users.nickname}</td>
                        <td>${item[type]}</td>
                        <td>${item.users.rank}</td>
                        <td>${item.users.fraction}</td>
                    `;
                    table.appendChild(row);
                });
                
            } catch (error) {
                console.error(`Error updating ${type} leaderboard:`, error);
            }
        }

        // ==================== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ АДМИН-ПАНЕЛИ ====================

        // Подсказка для редактирования пользователя
        function selectUserForEdit(userId) {
            document.getElementById('editUser').value = userId;
            
            // Находим пользователя и заполняем форму его данными
            const user = allUsers.find(u => u.id === userId);
            if (user) {
                document.getElementById('editFraction').value = user.fraction || '';
                document.getElementById('editCity').value = user.city || 'Приволжск';
                document.getElementById('editRank').value = user.rank || 'Гражданский';
                document.getElementById('editPosition').value = user.position || '';
            }
        }

        // Подсказка для назначения админа
        function assignAdminPrompt(userId) {
            document.getElementById('adminUser').value = userId;
        }

        // Подсказка для снятия прав админа
        function removeAdminPrompt(userId) {
            document.getElementById('removeAdminUser').value = userId;
        }

        // Подсказка для разбана
        function unbanUserPrompt(userId) {
            document.getElementById('unbanUser').value = userId;
        }

        // Назначение администратора
        async function assignAdmin() {
            if (!requirePermission('assign_roles')) return;
            
            const userId = parseInt(document.getElementById('adminUser').value);
            
            if (!userId) {
                showError('Выберите пользователя');
                return;
            }
            
            try {
                const success = await updateUserInDatabase(userId, {
                    role: 'ADMIN'
                });
                
                if (success) {
                    alert('✅ Пользователь назначен администратором!');
                    loadUsersForAdmin();
                    loadAdminsForAdmin();
                    logAdminAction('assign_admin', userId, 'Назначение администратором');
                } else {
                    showError('Ошибка при назначении администратора');
                }
            } catch (error) {
                console.error('Error assigning admin:', error);
                showError('Ошибка при назначении администратора');
            }
        }

        // Снятие прав администратора
        async function removeAdmin() {
            if (!requirePermission('assign_roles')) return;
            
            const userId = parseInt(document.getElementById('removeAdminUser').value);
            
            if (!userId) {
                showError('Выберите администратора');
                return;
            }
            
            try {
                const success = await updateUserInDatabase(userId, {
                    role: 'USER'
                });
                
                if (success) {
                    alert('✅ Права администратора сняты!');
                    loadUsersForAdmin();
                    loadAdminsForAdmin();
                    logAdminAction('remove_admin', userId, 'Снятие прав администратора');
                } else {
                    showError('Ошибка при снятии прав');
                }
            } catch (error) {
                console.error('Error removing admin:', error);
                showError('Ошибка при снятии прав');
            }
        }

       // ==================== ИСПРАВЛЕННЫЕ ФУНКЦИИ БАНОВ ====================

// Блокировка пользователя
async function banUser() {
    if (!requirePermission('ban_users')) return;
    
    const userId = parseInt(document.getElementById('banUser').value);
    const reason = document.getElementById('banReason').value;
    const duration = parseInt(document.getElementById('banDuration').value) || 0;
    
    if (!userId) {
        showError('Выберите пользователя');
        return;
    }
    
    if (!reason) {
        showError('Введите причину блокировки');
        return;
    }
    
    // Проверяем, не пытаемся ли забанить суперадмина или себя
    const targetUser = allUsers.find(u => u.id === userId);
    if (!targetUser) {
        showError('Пользователь не найден');
        return;
    }
    
    if (isSuperAdmin(targetUser)) {
        showError('Нельзя заблокировать главного администратора');
        return;
    }
    
    if (targetUser.id === currentUser.id) {
        showError('Нельзя заблокировать самого себя');
        return;
    }
    
    try {
        const banExpires = duration > 0 ? 
            new Date(Date.now() + duration * 24 * 60 * 60 * 1000).toISOString() : 
            null;

        const { error } = await supabase
            .from('users')
            .update({
                banned: true,
                ban_reason: reason,
                ban_expires: banExpires,
                banned_by: currentUser.nickname,
                banned_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            })
            .eq('id', userId);

        if (error) throw error;

        // Обновляем локальные данные
        const bannedUserIndex = allUsers.findIndex(u => u.id === userId);
        if (bannedUserIndex !== -1) {
            allUsers[bannedUserIndex] = {
                ...allUsers[bannedUserIndex],
                banned: true,
                ban_reason: reason,
                ban_expires: banExpires,
                banned_by: currentUser.nickname,
                banned_at: new Date().toISOString()
            };
        }

        alert('✅ Пользователь заблокирован!');
        document.getElementById('banReason').value = '';
        document.getElementById('banDuration').value = '';
        
        // Обновляем все связанные списки
        loadUsersForAdmin();
        if (document.getElementById('admin-bans').style.display !== 'none') {
            loadBansForAdmin();
        }
        
        logAdminAction('ban_user', userId, `Блокировка. Причина: ${reason}, срок: ${duration} дней`);
        
    } catch (error) {
        console.error('Error banning user:', error);
        showError('Ошибка при блокировке пользователя: ' + error.message);
    }
}

// Разблокировка пользователя
async function unbanUser() {
    if (!requirePermission('ban_users')) return;
    
    const userId = parseInt(document.getElementById('unbanUser').value);
    
    if (!userId) {
        showError('Выберите пользователя');
        return;
    }
    
    try {
        const { error } = await supabase
            .from('users')
            .update({
                banned: false,
                ban_reason: null,
                ban_expires: null,
                banned_by: null,
                banned_at: null,
                updated_at: new Date().toISOString()
            })
            .eq('id', userId);

        if (error) throw error;

        // Обновляем локальные данные
        const unbannedUserIndex = allUsers.findIndex(u => u.id === userId);
        if (unbannedUserIndex !== -1) {
            allUsers[unbannedUserIndex] = {
                ...allUsers[unbannedUserIndex],
                banned: false,
                ban_reason: null,
                ban_expires: null,
                banned_by: null,
                banned_at: null
            };
        }

        alert('✅ Пользователь разблокирован!');
        
        // Обновляем все связанные списки
        loadUsersForAdmin();
        if (document.getElementById('admin-bans').style.display !== 'none') {
            loadBansForAdmin();
        }
        
        logAdminAction('unban_user', userId, 'Разблокировка пользователя');
        
    } catch (error) {
        console.error('Error unbanning user:', error);
        showError('Ошибка при разблокировке пользователя: ' + error.message);
    }
}

// Загрузка банов для админ-панели
async function loadBansForAdmin() {
    if (!requirePermission('view_logs')) return;
    
    try {
        const users = await getAllUsers();
        const bannedUsers = users.filter(user => user.banned);
        
        // Заполняем выпадающий список для разбана
        const unbanSelect = document.getElementById('unbanUser');
        unbanSelect.innerHTML = '<option value="">Выберите пользователя</option>';
        
        bannedUsers.forEach(user => {
            const option = document.createElement('option');
            option.value = user.id;
            
            const banInfo = user.ban_expires ? 
                ` (до ${new Date(user.ban_expires).toLocaleDateString('ru-RU')})` : 
                ' (перманентно)';
                
            option.textContent = `${user.nickname}${banInfo}`;
            unbanSelect.appendChild(option);
        });
        
        // Заполняем таблицу банов
        const bansTable = document.getElementById('bansTable');
        if (!bansTable) return;
        
        bansTable.innerHTML = '';
        
        if (bannedUsers.length === 0) {
            bansTable.innerHTML = `
                <tr>
                    <td colspan="7" style="text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                        Нет заблокированных пользователей
                    </td>
                </tr>
            `;
            return;
        }
        
        bannedUsers.forEach(user => {
            const row = document.createElement('tr');
            
            const banDate = user.banned_at ? 
                new Date(user.banned_at).toLocaleDateString('ru-RU') : 
                'Неизвестно';
                
            const banExpires = user.ban_expires ? 
                new Date(user.ban_expires).toLocaleDateString('ru-RU') : 
                '<span style="color: var(--danger);">Перманентно</span>';
            
            const timeLeft = user.ban_expires ? 
                getTimeLeft(new Date(user.ban_expires)) : 
                '<span style="color: var(--danger);">Бессрочно</span>';
            
            row.innerHTML = `
                <td>${user.id}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 8px; height: 8px; background: var(--danger); border-radius: 50%;"></div>
                        ${user.nickname}
                    </div>
                </td>
                <td>
                    <div style="max-width: 200px; word-wrap: break-word;">
                        ${user.ban_reason || 'Не указана'}
                    </div>
                </td>
                <td>${banDate}</td>
                <td>${banExpires}</td>
                <td>${timeLeft}</td>
                <td>${user.banned_by || 'Система'}</td>
                <td>
                    <button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8rem;" onclick="unbanUserPrompt(${user.id})">
                        <i class="fas fa-unlock"></i> Разблокировать
                    </button>
                </td>
            `;
            bansTable.appendChild(row);
        });
        
    } catch (error) {
        console.error('Error loading bans:', error);
        showError('Ошибка загрузки списка банов: ' + error.message);
    }
}

// Вспомогательная функция для расчета оставшегося времени бана
function getTimeLeft(expiryDate) {
    const now = new Date();
    const diff = expiryDate - now;
    
    if (diff <= 0) return '<span style="color: var(--success);">Истек</span>';
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    
    if (days > 0) {
        return `<span style="color: var(--warning);">${days}д ${hours}ч</span>`;
    } else {
        return `<span style="color: var(--warning);">${hours}ч</span>`;
    }
}

// Проверка банов при авторизации
async function checkBansOnAuth(user) {
    if (user.banned && user.ban_expires) {
        const banExpiry = new Date(user.ban_expires);
        const now = new Date();
        
        if (banExpiry > now) {
            // Бан еще активен
            const timeLeft = getTimeLeft(banExpiry);
            throw new Error(`Аккаунт заблокирован. Причина: ${user.ban_reason}. Разблокировка: ${banExpiry.toLocaleDateString('ru-RU')} (${timeLeft})`);
        } else {
            // Бан истек, разблокируем
            await unbanUserInDatabase(user.id);
            user.banned = false;
            user.ban_reason = null;
            user.ban_expires = null;
            user.banned_by = null;
        }
    }
    
    return user;
}

// Обновленная функция входа с проверкой банов
async function loginUser(login, password) {
    try {
        const { data: user, error } = await supabase
            .from('users')
            .select('*')
            .or(`username.eq.${login},email.eq.${login}`)
            .single();

        if (error) throw error;

        // Проверяем пароль
        const isPasswordValid = await hashPassword(password) === user.password_hash;
        if (!isPasswordValid) throw new Error('Неверный пароль');

        // Проверяем бан
        const userWithBanCheck = await checkBansOnAuth(user);
        
        // Убедимся, что поля 2FA существуют
        userWithBanCheck.two_factor_enabled = userWithBanCheck.two_factor_enabled || false;
        userWithBanCheck.two_factor_secret = userWithBanCheck.two_factor_secret || null;

        // Сохраняем пользователя в localStorage
        localStorage.setItem('currentUser', JSON.stringify(userWithBanCheck));
        
        return { success: true, user: userWithBanCheck };
    } catch (error) {
        console.error('Login error:', error);
        return { success: false, error: error.message };
    }
}

// Обновленная функция проверки авторизации
async function checkAuth() {
    const storedUser = localStorage.getItem('currentUser');
    if (!storedUser) return null;

    try {
        const user = JSON.parse(storedUser);
        
        // Получаем свежие данные пользователя
        const { data: freshUser, error } = await supabase
            .from('users')
            .select('*')
            .eq('id', user.id)
            .single();

        if (error) throw error;

        // Проверяем бан
        const userWithBanCheck = await checkBansOnAuth(freshUser);
        
        // Убедимся, что поля 2FA существуют
        userWithBanCheck.two_factor_enabled = userWithBanCheck.two_factor_enabled || false;
        userWithBanCheck.two_factor_secret = userWithBanCheck.two_factor_secret || null;

        return userWithBanCheck;
    } catch (error) {
        localStorage.removeItem('currentUser');
        return null;
    }
}

        // ==================== НОВЫЕ ФУНКЦИИ ДЛЯ СИСТЕМЫ НАСТРОЕК ====================

        // Показать раздел настроек
        function showSettingsSection() {
            showSection('settings');
            loadSettings();
        }

        // Загрузка настроек пользователя
async function loadSettings() {
    if (!currentUser) return;

    try {
        // Загружаем настройки из базы данных
        const { data: settings, error } = await supabase
            .from('user_settings')
            .select('*')
            .eq('user_id', currentUser.id)
            .single();

        if (error && error.code !== 'PGRST116') { // PGRST116 - нет записей
            console.error('Error loading settings:', error);
            return;
        }

        // Применяем настройки
        if (settings) {
            // Тема
            if (settings.theme === 'dark') {
                setTheme(true);
            } else {
                setTheme(false);
            }

            // Размер шрифта
            if (settings.font_size) {
                document.getElementById('fontSize').value = settings.font_size;
                updateFontSize(settings.font_size);
            }

            // Компактный режим
            if (settings.compact_mode) {
                document.getElementById('compactMode').checked = true;
                toggleCompactMode(true);
            }

            // Уведомления
            if (settings.notifications) {
                const notifSettings = settings.notifications;
                document.getElementById('emailNotifications').checked = notifSettings.email || false;
                document.getElementById('systemUpdates').checked = notifSettings.system_updates || false;
                document.getElementById('weeklyReports').checked = notifSettings.weekly_reports || false;
            }
        }

        // Показываем административные настройки если пользователь админ
        if (hasPermission(currentUser, 'manage_users')) {
            document.getElementById('adminSettings').style.display = 'block';
        }

    } catch (error) {
        console.error('Error loading user settings:', error);
    }
}

        // Сохранение настроек
async function saveSettings(settings) {
    if (!currentUser) return false;

    try {
        const { error } = await supabase
            .from('user_settings')
            .upsert({
                user_id: currentUser.id,
                ...settings,
                updated_at: new Date().toISOString()
            }, {
                onConflict: 'user_id'
            });

        return !error;
    } catch (error) {
        console.error('Error saving settings:', error);
        return false;
    }
}

        // ==================== СИСТЕМА СМЕНЫ ПАРОЛЯ ====================

        // Показать модальное окно смены пароля
        function showChangePasswordModal() {
            if (!currentUser) {
                showError('Необходимо авторизоваться');
                return;
            }
            document.getElementById('changePasswordForm').reset();
            showModal('changePasswordModal');
        }

        // Обработка смены пароля
        document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            // Проверка совпадения паролей
            if (newPassword !== confirmPassword) {
                showError('Новые пароли не совпадают');
                return;
            }

            // Проверка длины пароля
            if (newPassword.length < 6) {
                showError('Пароль должен содержать минимум 6 символов');
                return;
            }

            try {
                // Проверяем текущий пароль
                const isCurrentPasswordValid = await hashPassword(currentPassword) === currentUser.password_hash;
                if (!isCurrentPasswordValid) {
                    showError('Текущий пароль неверен');
                    return;
                }

                // Обновляем пароль в базе данных
                const { error } = await supabase
                    .from('users')
                    .update({
                        password_hash: await hashPassword(newPassword),
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', currentUser.id);

                if (error) throw error;

                // Обновляем локальные данные пользователя
                currentUser.password_hash = await hashPassword(newPassword);
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                alert('✅ Пароль успешно изменен!');
                hideModal('changePasswordModal');
                logAdminAction('change_password', currentUser.id, 'Смена пароля');

            } catch (error) {
                console.error('Error changing password:', error);
                showError('Ошибка при смене пароля');
            }
        });

        // ==================== СИСТЕМА СМЕНЫ НИКНЕЙМА ====================

        // Показать модальное окно смены никнейма
        function showChangeNicknameModal(forOtherUser = false) {
            if (!currentUser) {
                showError('Необходимо авторизоваться');
                return;
            }

            document.getElementById('changeNicknameForm').reset();
            const targetSection = document.getElementById('nicknameTarget');
            
            if (forOtherUser && hasPermission(currentUser, 'manage_users')) {
                targetSection.style.display = 'block';
                loadUsersForNicknameChange();
            } else {
                targetSection.style.display = 'none';
                document.getElementById('newNickname').value = currentUser.nickname;
            }

            showModal('changeNicknameModal');
        }

        // Загрузка пользователей для смены никнейма
        async function loadUsersForNicknameChange() {
            if (!hasPermission(currentUser, 'manage_users')) return;

            try {
                const users = await getAllUsers();
                const select = document.getElementById('targetUser');
                select.innerHTML = '';

                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.nickname} (${user.role})`;
                    select.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading users for nickname change:', error);
            }
        }

        // Обработка смены никнейма
        document.getElementById('changeNicknameForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const newNickname = document.getElementById('newNickname').value.trim();
            const targetUserSelect = document.getElementById('targetUser');
            let targetUserId = currentUser.id;

            // Если меняем ник другому пользователю
            if (targetUserSelect.style.display !== 'none' && targetUserSelect.value) {
                if (!hasPermission(currentUser, 'manage_users')) {
                    showError('Недостаточно прав');
                    return;
                }
                targetUserId = parseInt(targetUserSelect.value);
            }

            if (!newNickname) {
                showError('Введите новый никнейм');
                return;
            }

            try {
                // Проверяем, не занят ли никнейм
                const { data: existingUser, error: checkError } = await supabase
                    .from('users')
                    .select('id')
                    .eq('nickname', newNickname)
                    .neq('id', targetUserId)
                    .single();

                if (existingUser) {
                    showError('Этот никнейм уже занят');
                    return;
                }

                // Обновляем никнейм в базе данных
                const { error } = await supabase
                    .from('users')
                    .update({
                        nickname: newNickname,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', targetUserId);

                if (error) throw error;

                // Обновляем локальные данные если меняем свой ник
                if (targetUserId === currentUser.id) {
                    currentUser.nickname = newNickname;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    updateUserInterface();
                }

                alert('✅ Никнейм успешно изменен!');
                hideModal('changeNicknameModal');
                
                const actionText = targetUserId === currentUser.id ? 
                    'Смена собственного никнейма' : 
                    `Смена никнейма пользователю ID: ${targetUserId}`;
                
                logAdminAction('change_nickname', targetUserId, actionText);

            } catch (error) {
                console.error('Error changing nickname:', error);
                showError('Ошибка при смене никнейма');
            }
        });

        // ==================== СИСТЕМА ВЫБОРА ЗВАНИЙ И ДОЛЖНОСТЕЙ ====================

        // Показать модальное окно выбора звания и должности
        function showRankPositionModal(forOtherUser = false) {
            if (!currentUser) {
                showError('Необходимо авторизоваться');
                return;
            }

            document.getElementById('rankPositionForm').reset();
            const targetSection = document.getElementById('rankPositionTarget');
            
            if (forOtherUser && hasPermission(currentUser, 'manage_users')) {
                targetSection.style.display = 'block';
                loadUsersForRankChange();
            } else {
                targetSection.style.display = 'none';
                // Устанавливаем текущие значения
                if (currentUser.rank) {
                    selectRank(currentUser.rank);
                }
                document.getElementById('positionInput').value = currentUser.position || '';
            }

            showModal('rankPositionModal');
        }

        // Загрузка пользователей для изменения званий
        async function loadUsersForRankChange() {
            if (!hasPermission(currentUser, 'manage_users')) return;

            try {
                const users = await getAllUsers();
                const select = document.getElementById('targetUserRank');
                select.innerHTML = '';

                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.nickname} (${user.rank || 'Без звания'})`;
                    select.appendChild(option);
                });

            } catch (error) {
                console.error('Error loading users for rank change:', error);
            }
        }

        // Выбор звания
        function selectRank(rank) {
            // Снимаем выделение со всех вариантов
            document.querySelectorAll('.rank-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Выделяем выбранный вариант
            const selectedOption = document.querySelector(`.rank-option[data-rank="${rank}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');
                document.getElementById('selectedRank').value = rank;
            }
        }

        // Обработка выбора звания и должности
        document.getElementById('rankPositionForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const selectedRank = document.getElementById('selectedRank').value;
            const position = document.getElementById('positionInput').value.trim();
            const targetUserSelect = document.getElementById('targetUserRank');
            let targetUserId = currentUser.id;

            // Если назначаем другому пользователю
            if (targetUserSelect.style.display !== 'none' && targetUserSelect.value) {
                if (!hasPermission(currentUser, 'manage_users')) {
                    showError('Недостаточно прав');
                    return;
                }
                targetUserId = parseInt(targetUserSelect.value);
            }

            if (!selectedRank) {
                showError('Выберите звание');
                return;
            }

            if (!position) {
                showError('Введите должность');
                return;
            }

            try {
                // Обновляем данные в базе
                const { error } = await supabase
                    .from('users')
                    .update({
                        rank: selectedRank,
                        position: position,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', targetUserId);

                if (error) throw error;

                // Обновляем локальные данные если меняем свои данные
                if (targetUserId === currentUser.id) {
                    currentUser.rank = selectedRank;
                    currentUser.position = position;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    updateUserInterface();
                }

                alert('✅ Звание и должность успешно обновлены!');
                hideModal('rankPositionModal');
                
                const actionText = targetUserId === currentUser.id ? 
                    'Изменение собственного звания/должности' : 
                    `Назначение звания/должности пользователю ID: ${targetUserId}`;
                
                logAdminAction('change_rank_position', targetUserId, actionText);

            } catch (error) {
                console.error('Error updating rank/position:', error);
                showError('Ошибка при обновлении звания и должности');
            }
        });

        // ==================== СИСТЕМА РЕДАКТИРОВАНИЯ СТАТИСТИКИ ====================

        // Показать модальное окно редактирования статистики
        async function showEditStatsModal() {
            if (!hasPermission(currentUser, 'edit_stats') || !isSuperAdmin(currentUser)) {
                showError('Недостаточно прав');
                return;
            }

            try {
                const users = await getAllUsers();
                const select = document.getElementById('statsUser');
                select.innerHTML = '';

                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.nickname} (${user.rank || 'Без звания'})`;
                    select.appendChild(option);
                });

                // Загружаем статистику первого пользователя по умолчанию
                if (users.length > 0) {
                    await loadUserStats(users[0].id);
                }

                showModal('editStatsModal');

            } catch (error) {
                console.error('Error loading users for stats edit:', error);
                showError('Ошибка загрузки пользователей');
            }
        }

        // Загрузка статистики пользователя
        async function loadUserStats(userId) {
            try {
                const stats = await getUserStats(userId);
                if (stats) {
                    document.getElementById('editFines').value = stats.fines || 0;
                    document.getElementById('editArrests').value = stats.arrests || 0;
                    document.getElementById('editLicenses').value = stats.licenses || 0;
                    document.getElementById('editSearches').value = stats.searches || 0;
                    document.getElementById('editRating').value = stats.rating || 0;
                }
            } catch (error) {
                console.error('Error loading user stats:', error);
            }
        }

        // Обработка изменения выбора пользователя
        document.getElementById('statsUser').addEventListener('change', function() {
            const userId = parseInt(this.value);
            if (userId) {
                loadUserStats(userId);
            }
        });

        // Обработка сохранения статистики
        document.getElementById('editStatsForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            if (!hasPermission(currentUser, 'edit_stats') || !isSuperAdmin(currentUser)) {
                showError('Недостаточно прав');
                return;
            }

            const userId = parseInt(document.getElementById('statsUser').value);
            const fines = parseInt(document.getElementById('editFines').value);
            const arrests = parseInt(document.getElementById('editArrests').value);
            const licenses = parseInt(document.getElementById('editLicenses').value);
            const searches = parseInt(document.getElementById('editSearches').value);
            const rating = parseInt(document.getElementById('editRating').value);

            if (!userId) {
                showError('Выберите пользователя');
                return;
            }

            try {
                // Обновляем статистику в базе данных
                const { error } = await supabase
                    .from('user_stats')
                    .update({
                        fines: fines,
                        arrests: arrests,
                        licenses: licenses,
                        searches: searches,
                        rating: rating,
                        updated_at: new Date().toISOString()
                    })
                    .eq('user_id', userId);

                if (error) throw error;

                alert('✅ Статистика успешно обновлена!');
                hideModal('editStatsModal');
                
                logAdminAction('edit_user_stats', userId, 
                    `Обновление статистики: штрафы=${fines}, задержания=${arrests}, права=${licenses}, досмотры=${searches}, рейтинг=${rating}`);

            } catch (error) {
                console.error('Error updating stats:', error);
                showError('Ошибка при обновлении статистики');
            }
        });

        // ==================== ФУНКЦИИ КАСТОМИЗАЦИИ ====================

        // Установка темы
        function setTheme(isDark) {
            isDarkTheme = isDark;
            localStorage.setItem('darkTheme', isDark);
            applyTheme();
            
            // Обновляем кнопки
            document.getElementById('lightThemeBtn').classList.toggle('selected', !isDark);
            document.getElementById('darkThemeBtn').classList.toggle('selected', isDark);
            
            // Сохраняем в настройках
            saveSettings({ theme: isDark ? 'dark' : 'light' });
        }

        // Обновление размера шрифта
        function updateFontSize(size) {
            document.body.style.fontSize = size === 'small' ? '14px' : size === 'large' ? '18px' : '16px';
            saveSettings({ font_size: size });
        }

        // Переключение компактного режима
        function toggleCompactMode(compact) {
            if (compact) {
                document.body.classList.add('compact-mode');
            } else {
                document.body.classList.remove('compact-mode');
            }
            saveSettings({ compact_mode: compact });
        }

        // Обновление настроек уведомлений
        function updateNotificationSettings() {
            const settings = {
                email: document.getElementById('emailNotifications').checked,
                system_updates: document.getElementById('systemUpdates').checked,
                weekly_reports: document.getElementById('weeklyReports').checked
            };
            saveSettings({ notifications: settings });
        }

        // ==================== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ====================

        // Показать модальное окно
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Скрыть модальное окно
        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ==================== ФИКС КЭША CLOUDFLARE ====================

        // Принудительное обновление кэша при каждой загрузке
        const CACHE_BUSTER = 'v=' + Date.now();

        // Добавляем параметр версии ко всем запросам
        function bustCache() {
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            const scripts = document.querySelectorAll('script[src]');
            
            links.forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.includes('?')) {
                    link.setAttribute('href', href + '?' + CACHE_BUSTER);
                }
            });
            
            console.log('🔄 Cache buster activated:', CACHE_BUSTER);
        }

        // Вызываем при загрузке
        bustCache();

        // ==================== ЗАГРУЗКА ПОЛЬЗОВАТЕЛЕЙ В АДМИН-ПАНЕЛЬ ====================

        // Основная функция загрузки пользователей для админ-панели
        window.loadUsersForAdmin = async function() {
            console.log('🔄 Загрузка пользователей для админки');
            
            try {
                // Получаем всех пользователей из базы
                const { data: users, error } = await supabase
                    .from('users')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    console.error('❌ Ошибка загрузки пользователей:', error);
                    return;
                }

                console.log('✅ Пользователи загружены:', users);
                allUsers = users; // Сохраняем пользователей в глобальную переменную

                // Заполняем выпадающий список для редактирования
                const editUserSelect = document.getElementById('editUser');
                const adminUserSelect = document.getElementById('adminUser');
                const banUserSelect = document.getElementById('banUser');
                const removeAdminSelect = document.getElementById('removeAdminUser');
                const unbanSelect = document.getElementById('unbanUser');

                // Очищаем списки
                editUserSelect.innerHTML = '<option value="">Выберите пользователя</option>';
                adminUserSelect.innerHTML = '<option value="">Выберите пользователя</option>';
                banUserSelect.innerHTML = '<option value="">Выберите пользователя</option>';
                removeAdminSelect.innerHTML = '<option value="">Выберите администратора</option>';
                unbanSelect.innerHTML = '<option value="">Выберите пользователя</option>';

                // Заполняем списки
                users.forEach(user => {
                    if (user.id === currentUser.id) return; // Пропускаем текущего пользователя

                    const optionText = `${user.nickname} (${user.role})`;

                    // Для редактирования - все пользователи
                    const editOption = document.createElement('option');
                    editOption.value = user.id;
                    editOption.textContent = optionText;
                    editUserSelect.appendChild(editOption);

                    // Для назначения админа - только обычные пользователи
                    if (user.role === 'USER') {
                        const adminOption = document.createElement('option');
                        adminOption.value = user.id;
                        adminOption.textContent = user.nickname;
                        adminUserSelect.appendChild(adminOption);
                    }

                    // Для бана - все пользователи кроме суперадминов
                    if (!isSuperAdmin(user)) {
                        const banOption = document.createElement('option');
                        banOption.value = user.id;
                        banOption.textContent = user.nickname + (user.banned ? ' ⛔' : '');
                        banUserSelect.appendChild(banOption);
                    }

                    // Для снятия прав - только админы и модераторы
                    if (user.role === 'ADMIN' || user.role === 'MODERATOR') {
                        const removeAdminOption = document.createElement('option');
                        removeAdminOption.value = user.id;
                        removeAdminOption.textContent = user.nickname;
                        removeAdminSelect.appendChild(removeAdminOption);
                    }

                    // Для разбана - только заблокированные
                    if (user.banned) {
                        const unbanOption = document.createElement('option');
                        unbanOption.value = user.id;
                        unbanOption.textContent = user.nickname;
                        unbanSelect.appendChild(unbanOption);
                    }
                });

                // Заполняем таблицу пользователей
                const usersTable = document.getElementById('usersTable');
                if (usersTable) {
                    usersTable.innerHTML = '';
                    
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        
                        let roleBadge = '';
                        if (isSuperAdmin(user)) {
                            roleBadge = '<span style="color: gold;">Главный Админ</span>';
                        } else if (user.role === 'ADMIN') {
                            roleBadge = '<span style="color: var(--accent);">Админ</span>';
                        } else if (user.role === 'MODERATOR') {
                            roleBadge = '<span style="color: #f59e0b;">Модератор</span>';
                        } else if (user.role === 'HELPER') {
                            roleBadge = '<span style="color: #10b981;">Помощник</span>';
                        } else {
                            roleBadge = 'Гражданский';
                        }

                        row.innerHTML = `
                            <td>${user.id}</td>
                            <td>${user.nickname}</td>
                            <td>${user.rank}</td>
                            <td>${user.position}</td>
                            <td>${user.fraction}</td>
                            <td>${user.city}</td>
                            <td>${user.banned ? '<span style="color: var(--danger);">⛔ Заблокирован</span>' : roleBadge}</td>
                            <td>
                                <button class="btn btn-outline" style="padding: 5px 10px; font-size: 0.8rem;" onclick="selectUserForEdit(${user.id})">Изменить</button>
                            </td>
                        `;
                        usersTable.appendChild(row);
                    });
                }

            } catch (error) {
                console.error('❌ Ошибка загрузки пользователей:', error);
            }
        };

        // Функция для выбора пользователя в форме редактирования
        window.selectUserForEdit = function(userId) {
            document.getElementById('editUser').value = userId;
            
            // Находим пользователя и заполняем форму его данными
            const user = allUsers.find(u => u.id === userId);
            if (user) {
                document.getElementById('editFraction').value = user.fraction || '';
                document.getElementById('editCity').value = user.city || 'Приволжск';
                document.getElementById('editRank').value = user.rank || 'Гражданский';
                document.getElementById('editPosition').value = user.position || '';
            }
        };

        // Загружаем пользователей при открытии админ-панели
        document.addEventListener('DOMContentLoaded', function() {
            // Ждем немного перед загрузкой пользователей
            setTimeout(() => {
                if (currentUser && hasPermission(currentUser, 'view_users')) {
                    loadUsersForAdmin();
                }
            }, 1000);
        });

        // Также обновляем функцию showAdminTab чтобы загружать данные при переходе
        const originalShowAdminTab = window.showAdminTab;
        window.showAdminTab = function(tabName) {
            // Вызываем оригинальную функцию
            if (originalShowAdminTab) {
                originalShowAdminTab(tabName);
            }
            
            // Загружаем данные для вкладки
            if (tabName === 'users') {
                loadUsersForAdmin();
            }
        };

        console.log('🎯 Все системы загружены и готовы к работе!');
        // ==================== СИСТЕМА 2FA ====================

// Умная функция для 2FA
function enableTwoFactorAuth() {
  if (!currentUser) {
    showError('Необходимо авторизоваться');
    return;
  }
  
  // Генерируем секретный ключ
  const secret = generate2FASecret();
  
  // Показываем модальное окно с QR-кодом
  show2FAModal(secret);
}

// Генерация секретного ключа для 2FA
function generate2FASecret() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
  let secret = '';
  for (let i = 0; i < 16; i++) {
    secret += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return secret;
}

// Показ модального окна 2FA с QR-кодом
function show2FAModal(secret) {
  localStorage.setItem('temp2FASecret', secret);
  document.getElementById('secretKey').value = secret;
  generateQRCode(secret);
  showModal('twoFactorAuthModal');
}

// Генерация QR-кода
function generateQRCode(secret) {
  const qrContainer = document.getElementById('qrcode-container');
  const issuer = 'ГИБДД Провинция';
  const account = currentUser.email || currentUser.username;
  
  const otpauthUrl = `otpauth://totp/${encodeURIComponent(issuer)}:${encodeURIComponent(account)}?secret=${secret}&issuer=${encodeURIComponent(issuer)}&algorithm=SHA1&digits=6&period=30`;
  
  // Используем QRServer API вместо Google Charts
  const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(otpauthUrl)}`;
  
  qrContainer.innerHTML = `
    <div style="text-align: center;">
      <img src="${qrCodeUrl}" 
           alt="QR Code для 2FA" 
           style="border: 1px solid #ddd; padding: 10px; border-radius: 8px; background: white;"
           onerror="this.src='https://via.placeholder.com/200x200/ffffff/000000?text=QR+Error'">
      <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
        Отсканируйте QR-код в приложении Google Authenticator
      </p>
    </div>
  `;
}

// Включение 2FA после подтверждения
function enable2FA() {
  const code = document.getElementById('verificationCode').value;
  const secret = localStorage.getItem('temp2FASecret');
  
  if (!code || code.length !== 6) {
    showError('Введите 6-значный код из приложения');
    return;
  }
  
  if (!/^\d+$/.test(code)) {
    showError('Код должен содержать только цифры');
    return;
  }
  
  // РЕАЛЬНАЯ РЕАЛИЗАЦИЯ
  save2FASettings(secret)
    .then(() => {
      alert('✅ Двухфакторная аутентификация успешно включена!');
      hideModal('twoFactorAuthModal');
      localStorage.removeItem('temp2FASecret');
      document.getElementById('verificationCode').value = '';
      update2FAButton(true);
    })
    .catch(error => {
      showError('Ошибка сохранения настроек 2FA');
    });
}

// Сохранение настроек 2FA в базу (РЕАЛЬНАЯ РЕАЛИЗАЦИЯ)
async function save2FASettings(secret) {
  try {
    const { error } = await supabase
      .from('users')
      .update({
        two_factor_secret: secret,
        two_factor_enabled: true,
        updated_at: new Date().toISOString()
      })
      .eq('id', currentUser.id);

    if (error) throw error;
    
    // Обновляем локальные данные пользователя
    currentUser.two_factor_secret = secret;
    currentUser.two_factor_enabled = true;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    return true;
  } catch (error) {
    console.error('Error saving 2FA settings:', error);
    throw error;
  }
}

// Обновление кнопки 2FA
function update2FAButton(isEnabled) {
  const twoFactorBtn = document.querySelector('[onclick="enableTwoFactorAuth()"]');
  if (twoFactorBtn) {
    if (isEnabled) {
      twoFactorBtn.innerHTML = '<i class="fas fa-mobile-alt"></i> Отключить 2FA';
      twoFactorBtn.classList.remove('btn-outline');
      twoFactorBtn.classList.add('btn-warning');
      twoFactorBtn.onclick = disable2FA;
    } else {
      twoFactorBtn.innerHTML = '<i class="fas fa-mobile-alt"></i> Включить 2FA';
      twoFactorBtn.classList.remove('btn-warning');
      twoFactorBtn.classList.add('btn-outline');
      twoFactorBtn.onclick = enableTwoFactorAuth;
    }
  }
}

// Отключение 2FA
async function disable2FA() {
  try {
    const { error } = await supabase
      .from('users')
      .update({
        two_factor_secret: null,
        two_factor_enabled: false,
        updated_at: new Date().toISOString()
      })
      .eq('id', currentUser.id);

    if (error) throw error;
    
    // Обновляем локальные данные
    currentUser.two_factor_secret = null;
    currentUser.two_factor_enabled = false;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    alert('✅ Двухфакторная аутентификация отключена!');
    update2FAButton(false);
    
  } catch (error) {
    console.error('Error disabling 2FA:', error);
    showError('Ошибка отключения 2FA');
  }
}

// Копирование секретного ключа
function copySecretKey() {
  const secretKeyInput = document.getElementById('secretKey');
  if (secretKeyInput && secretKeyInput.value) {
    secretKeyInput.select();
    document.execCommand('copy');
    alert('Секретный ключ скопирован в буфер обмена!');
  }
}

// Проверка статуса 2FA при загрузке
function check2FAStatus() {
  if (currentUser && currentUser.two_factor_enabled) {
    update2FAButton(true);
  }
}

// Вызовите эту функцию при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
  setTimeout(check2FAStatus, 1000);
});
// ==================== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ====================

function showModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) modal.style.display = 'flex';
}

function hideModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) modal.style.display = 'none';
}

function showError(message) {
  alert('❌ ' + message);
}

function showDeleteAccountModal() {
  if (!currentUser) {
    showError('Необходимо авторизоваться');
    return;
  }
  showModal('deleteAccountModal');
}

function deleteAccount() {
  const password = document.getElementById('confirmPassword')?.value;
  const confirmText = document.getElementById('confirmText')?.value;
  
  if (!password) {
    showError('Введите пароль');
    return;
  }
  
  if (confirmText !== 'УДАЛИТЬ АККАУНТ') {
    showError('Текст подтверждения неверен');
    return;
  }
  
  if (confirm('Вы уверены? Это действие необратимо!')) {
    alert('Аккаунт будет удален после реализации бэкенда');
    hideModal('deleteAccountModal');
  }
}
// Простая функция удаления аккаунта
function showDeleteAccountModal() {
  if (!currentUser) {
    showError('Необходимо авторизоваться');
    return;
  }
  showModal('deleteAccountModal');
}

// Заглушки для демонстрации
function enable2FA() {
  alert('2FA будет включено после реализации бэкенда');
  hideModal('twoFactorAuthModal');
}

function deleteAccount() {
  const password = document.getElementById('confirmPassword').value;
  const confirmText = document.getElementById('confirmText').value;
  
  if (!password) {
    showError('Введите пароль');
    return;
  }
  
  if (confirmText !== 'УДАЛИТЬ АККАУНТ') {
    showError('Текст подтверждения неверен');
    return;
  }
  
  if (confirm('Вы уверены? Это действие необратимо!')) {
    alert('Аккаунт будет удален после реализации бэкенда');
    hideModal('deleteAccountModal');
  }
}
// Отключение 2FA
async function disable2FA() {
  try {
    const { error } = await supabase
      .from('users')
      .update({
        two_factor_secret: null,
        two_factor_enabled: false,
        updated_at: new Date().toISOString()
      })
      .eq('id', currentUser.id);

    if (error) throw error;
    
    // Обновляем локальные данные
    currentUser.two_factor_secret = null;
    currentUser.two_factor_enabled = false;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    alert('✅ Двухфакторная аутентификация отключена!');
    update2FAButton(false);
    
  } catch (error) {
    console.error('Error disabling 2FA:', error);
    showError('Ошибка отключения 2FA');
  }
}
// VK конфигурация
const VK_CONFIG = {
  appId: '54358244',
  redirectUri: window.location.origin,
  scope: 'email',
  version: '5.199'
};

// Инициализация VK
function initVK() {
  // Ждем загрузки VK SDK
  if (typeof VK !== 'undefined') {
    VK.init({
      apiId: VK_CONFIG.appId
    });
    console.log('✅ VK SDK инициализирован');
  } else {
    // Если VK не загружен, пробуем снова через секунду
    setTimeout(initVK, 1000);
  }
}

// Вход через VK
function loginWithVK() {
  VK.Auth.login(function(response) {
    if (response.session) {
      // Пользователь успешно авторизовался
      handleVKAuth(response);
    } else {
      // Пользователь нажал кнопку "Отмена"
      showError('Авторизация через VK отменена');
    }
  }, VK_CONFIG.scope);
}

// Обработка успешной авторизации VK ID
async function handleVKIDAuth(authData) {
  try {
    // Получаем данные пользователя через VK API
    const userData = await getVKUserData(authData.user);
    
    // Проверяем, есть ли пользователь в нашей базе
    const { data: existingUser, error } = await supabase
      .from('users')
      .select('*')
      .eq('vk_id', userData.vk_id)
      .single();

    if (error && error.code !== 'PGRST116') {
      throw error;
    }

    if (existingUser) {
      // Пользователь уже есть - логиним
      currentUser = existingUser;
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
      currentUserStats = await getUserStats(currentUser.id);
      updateUserInterface();
      hideAuthModal();
      alert('✅ Вход через VK выполнен!');
    } else {
      // Новый пользователь - показываем форму доп. данных
      showVKRegistrationForm(userData);
    }
    
  } catch (error) {
    console.error('VK ID auth error:', error);
    showError('Ошибка авторизации через VK');
  }
}
// Получение данных пользователя VK
async function getVKUserData(vkUser) {
  return new Promise((resolve, reject) => {
    VK.Api.call('users.get', {
      user_ids: vkUser.id,
      fields: 'photo_200,email',
      v: VK_CONFIG.version
    }, function(response) {
      if (response.error) {
        reject(response.error);
      } else {
        const user = response.response[0];
        resolve({
          vk_id: vkUser.id,
          nickname: `${user.first_name} ${user.last_name}`,
          email: user.email || `${vkUser.id}@vk.com`,
          avatar: user.photo_200,
          first_name: user.first_name,
          last_name: user.last_name
        });
      }
    });
  });
}
// Показ формы регистрации VK
function showVKRegistrationForm(vkData) {
  document.getElementById('vkUserName').value = `${vkData.first_name} ${vkData.last_name}`;
  document.getElementById('gameNickname').value = vkData.nickname;
  document.getElementById('vkRegisterForm').reset();
  showModal('vkRegisterModal');
  
  // Сохраняем VK данные временно
  localStorage.setItem('vkUserData', JSON.stringify(vkData));
}

// Обработка формы регистрации VK с проверкой
function initVKFormHandler() {
  const vkForm = document.getElementById('vkRegisterForm');
  if (vkForm) {
    vkForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const vkData = JSON.parse(localStorage.getItem('vkUserData'));
      const gameNickname = document.getElementById('gameNickname').value;
      const serviceNumber = document.getElementById('serviceNumber').value;
      const fraction = document.getElementById('fractionSelect').value;
      
      try {
        // Создаем пользователя
        const { data: user, error } = await supabase
          .from('users')
          .insert([{
            nickname: gameNickname,
            username: `vk_${vkData.vk_id}`,
            email: vkData.email,
            password_hash: 'vk_auth',
            vk_id: vkData.vk_id,
            vk_avatar: vkData.avatar,
            role: 'USER',
            rank: 'Рядовой',
            position: 'Стажёр',
            fraction: fraction,
            service_number: serviceNumber,
            city: fraction.includes('Невский') ? 'Невский' : 
                  fraction.includes('Мирный') ? 'Мирный' : 'Приволжск'
          }])
          .select()
          .single();

        if (error) throw error;

        // Создаем статистику
        await supabase
          .from('user_stats')
          .insert([{
            user_id: user.id,
            fines: 0,
            arrests: 0,
            licenses: 0,
            searches: 0,
            rating: 0
          }]);

        // Логиним пользователя
        currentUser = user;
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        localStorage.removeItem('vkUserData');
        currentUserStats = await getUserStats(currentUser.id);
        updateUserInterface();
        hideModal('vkRegisterModal');
        hideAuthModal();
        
        alert('🎉 Регистрация через VK завершена! Добро пожаловать в систему ГИБДД!');
        
      } catch (error) {
        console.error('VK registration error:', error);
        showError('Ошибка регистрации через VK');
      }
    });
    console.log('✅ VK форма инициализирована');
  } else {
    setTimeout(initVKFormHandler, 500);
  }
}
// ==================== VK OAuth АВТОРИЗАЦИЯ ====================

function initVKAuth() {
  console.log('🎯 Инициализация VK OAuth');
  showVKAuthButton();
  handleVKCallback(); // Проверяем callback
}

function showVKAuthButton() {
  const vkContainer = document.getElementById('vkIdOneTap');
  if (vkContainer) {
    vkContainer.innerHTML = `
      <div style="text-align: center;">
        <button onclick="startVKOAuth()" class="btn" style="background: #4a76a8; color: white; padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; width: 100%; font-size: 16px;">
          <i class="fab fa-vk" style="margin-right: 8px;"></i> Войти через VK
        </button>
        <p style="font-size: 12px; color: #666; margin-top: 8px;">OAuth 2.0 авторизация</p>
      </div>
    `;
  }
}

// Запуск VK OAuth
function startVKOAuth() {
  const appId = 54358244;
  const redirectUri = encodeURIComponent('https://gibddsite.vercel.app');
  const scope = 'email';
  const display = 'page';
  const responseType = 'code';
  
  const vkAuthUrl = `https://oauth.vk.com/authorize?client_id=${appId}&display=${display}&redirect_uri=${redirectUri}&scope=${scope}&response_type=${responseType}&v=5.199`;
  
  console.log('🔗 Переход на VK OAuth:', vkAuthUrl);
  window.location.href = vkAuthUrl;
}

// Обработка callback от VK
async function handleVKCallback() {
  const urlParams = new URLSearchParams(window.location.search);
  const code = urlParams.get('code');
  const error = urlParams.get('error');
  
  if (error) {
    console.error('❌ VK OAuth error:', error);
    showError(`Ошибка VK авторизации: ${error}`);
    return;
  }
  
  if (code) {
    console.log('🔐 Получен code от VK:', code);
    
    try {
      // Обмениваем code на access_token
      const authData = await exchangeCodeForToken(code);
      console.log('✅ Получен access_token:', authData);
      
      // Получаем информацию о пользователе
      const userInfo = await getVKUserInfo(authData.access_token);
      console.log('👤 Данные пользователя:', userInfo);
      
      // Регистрируем/логиним пользователя
      await registerOrLoginVKUser(userInfo, authData);
      
      // Убираем code из URL
      window.history.replaceState({}, document.title, window.location.pathname);
      
    } catch (error) {
      console.error('❌ Ошибка обработки VK callback:', error);
      showError('Ошибка авторизации: ' + error.message);
    }
  }
}

// Обмен code на access_token
async function exchangeCodeForToken(code) {
  // В реальном приложении этот запрос должен идти к твоему бэкенду
  // Но для демо сделаем напрямую (небезопасно!)
  
  const redirectUri = 'https://gibddsite.vercel.app';
  
  const response = await fetch('https://oauth.vk.com/access_token', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
    body: new URLSearchParams({
      client_id: '54358244',
      client_secret: 'fIdZdQRoLL6hRP2rptma',
      redirect_uri: redirectUri,
      code: code,
    }),
  });

  const data = await response.json();
  
  if (data.error) {
    throw new Error(data.error_description || data.error);
  }
  
  return data;
}

// Получение информации о пользователе VK
async function getVKUserInfo(accessToken) {
  const response = await fetch(`https://api.vk.com/method/users.get?fields=photo_200,first_name,last_name&access_token=${accessToken}&v=5.199`);
  const data = await response.json();
  
  if (data.error) {
    throw new Error(data.error.error_msg);
  }
  
  const user = data.response[0];
  return {
    id: user.id,
    first_name: user.first_name,
    last_name: user.last_name,
    email: `vk_${user.id}@vk.com`, // VK не отдает email в этом flow
    photo: user.photo_200
  };
}

// Регистрация или логин VK пользователя
async function registerOrLoginVKUser(vkUser, authData) {
  try {
    // Проверяем существование пользователя
    const { data: existingUser, error } = await supabase
      .from('users')
      .select('*')
      .eq('vk_id', vkUser.id)
      .single();

    if (error && error.code !== 'PGRST116') {
      throw error;
    }

    let user;
    
    if (existingUser) {
      // Пользователь существует - логиним
      user = existingUser;
      console.log('✅ Пользователь найден, выполняем вход');
    } else {
      // Создаем нового пользователя
      console.log('🆕 Создаем нового пользователя VK');
      const { data: newUser, error: createError } = await supabase
        .from('users')
        .insert([{
          nickname: `${vkUser.first_name} ${vkUser.last_name}`,
          username: `vk_${vkUser.id}`,
          email: vkUser.email,
          password_hash: 'vk_oauth_' + Date.now(),
          vk_id: vkUser.id,
          vk_avatar: vkUser.photo,
          role: 'USER',
          rank: 'Рядовой',
          position: 'Стажёр',
          fraction: 'ГИБДД',
          city: 'Приволжск',
          created_at: new Date().toISOString()
        }])
        .select()
        .single();

      if (createError) throw createError;
      user = newUser;

      // Создаем статистику
      const { error: statsError } = await supabase
        .from('user_stats')
        .insert([{
          user_id: user.id,
          fines: 0,
          arrests: 0,
          licenses: 0,
          searches: 0,
          rating: 0
        }]);

      if (statsError) throw statsError;
    }

    // Логиним пользователя
    currentUser = user;
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    currentUserStats = await getUserStats(currentUser.id);
    updateUserInterface();
    hideAuthModal();
    
    alert(existingUser ? '✅ Вход через VK выполнен!' : '🎉 Регистрация через VK завершена! Добро пожаловать в ГИБДД!');
    
  } catch (error) {
    console.error('VK registration error:', error);
    throw error;
  }
}

// ==================== ЗАПУСК ====================
document.addEventListener('DOMContentLoaded', function() {
  initVKAuth();
});
// ==================== ФУНКЦИИ ДЛЯ БАЗЫ НАРУШИТЕЛЕЙ ====================

let violators = JSON.parse(localStorage.getItem('violators')) || [];
let violatorCounter = parseInt(localStorage.getItem('violatorCounter')) || 1;

// Функция для определения типа доказательства
function getEvidenceType(evidence) {
    if (!evidence) return 'text';
    
    const lowerEvidence = evidence.toLowerCase();
    
    if (lowerEvidence.includes('drive.google.com') || 
        lowerEvidence.includes('docs.google.com') ||
        lowerEvidence.startsWith('https://drive.google.com') ||
        lowerEvidence.startsWith('http://drive.google.com')) {
        return 'google_drive';
    }
    
    if (lowerEvidence.startsWith('http://') || 
        lowerEvidence.startsWith('https://') ||
        lowerEvidence.includes('.com') || 
        lowerEvidence.includes('.ru') ||
        lowerEvidence.includes('.org')) {
        return 'link';
    }
    
    return 'text';
}

// Функция для отображения доказательства
function renderEvidence(evidence) {
    const type = getEvidenceType(evidence);
    
    switch(type) {
        case 'google_drive':
            return `
                <a href="${evidence}" target="_blank" class="evidence-link">
                    <i class="fab fa-google-drive"></i>
                    Google Drive
                </a>
            `;
        case 'link':
            return `
                <a href="${evidence}" target="_blank" class="evidence-link">
                    <i class="fas fa-external-link-alt"></i>
                    Ссылка на доказательства
                </a>
            `;
        default:
            return `<div class="violator-value">${evidence}</div>`;
    }
}

// Показать модальное окно создания карточки
function showCreateViolatorModal() {
    document.getElementById('createViolatorForm').reset();
    showModal('createViolatorModal');
}

// Создание новой карточки нарушителя
function createViolatorCard() {
    const name = document.getElementById('violatorName').value.trim();
    const violation = document.getElementById('violation').value.trim();
    const evidence = document.getElementById('evidence').value.trim();
    const notes = document.getElementById('notes').value.trim();
    
    if (!name || !violation || !evidence) {
        showError('Заполните все обязательные поля');
        return;
    }
    
    const newViolator = {
        id: Date.now(),
        violatorId: `НАР-${violatorCounter.toString().padStart(4, '0')}`,
        name: name,
        violation: violation,
        evidence: evidence,
        notes: notes,
        createdAt: new Date().toLocaleDateString('ru-RU'),
        createdTime: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
        createdBy: currentUser ? currentUser.nickname : 'Аноним',
        status: 'active'
    };
    
    violators.unshift(newViolator); // Добавляем в начало
    violatorCounter++;
    
    localStorage.setItem('violators', JSON.stringify(violators));
    localStorage.setItem('violatorCounter', violatorCounter.toString());
    
    hideModal('createViolatorModal');
    showNewViolatorCard(newViolator);
    updateViolatorsGrid();
}

// Показать новую карточку по центру экрана
function showNewViolatorCard(violator) {
    const cardHtml = `
        <div class="card-center-container">
            <div class="new-violator-card">
                <button class="close-card" onclick="closeNewCard()">
                    <i class="fas fa-times"></i>
                </button>
                <div class="new-violator-card-header">
                    <div class="success-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <h3>Карточка создана успешно!</h3>
                </div>
                <div class="new-violator-card-body">
                    <div class="violator-info">
                        <div class="violator-label">
                            <i class="fas fa-id-card"></i> ID карточки:
                        </div>
                        <div class="violator-value" style="font-weight: 600; color: var(--primary);">
                            ${violator.violatorId}
                        </div>
                    </div>
                    <div class="violator-info">
                        <div class="violator-label">
                            <i class="fas fa-user"></i> Нарушитель:
                        </div>
                        <div class="violator-value">${violator.name}</div>
                    </div>
                    <div class="violator-info">
                        <div class="violator-label">
                            <i class="fas fa-exclamation-triangle"></i> Нарушение:
                        </div>
                        <div class="violator-value">${violator.violation}</div>
                    </div>
                    <div class="violator-info">
                        <div class="violator-label">
                            <i class="fas fa-file-alt"></i> Доказательства:
                        </div>
                        ${renderEvidence(violator.evidence)}
                    </div>
                    ${violator.notes ? `
                    <div class="violator-info">
                        <div class="violator-label">
                            <i class="fas fa-sticky-note"></i> Примечания:
                        </div>
                        <div class="violator-value">${violator.notes}</div>
                    </div>
                    ` : ''}
                    <div class="violator-actions" style="justify-content: center; margin-top: 20px;">
                        <button class="btn btn-success" onclick="closeNewCard()" style="min-width: 150px;">
                            <i class="fas fa-check"></i> Понятно
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', cardHtml);
}

// Закрыть карточку
function closeNewCard() {
    const container = document.querySelector('.card-center-container');
    if (container) {
        container.remove();
    }
}

// Обновление сетки карточек
function updateViolatorsGrid() {
    const grid = document.getElementById('violatorsGrid');
    const searchTerm = document.getElementById('searchViolators')?.value.toLowerCase() || '';
    
    const filteredViolators = violators.filter(violator => 
        violator.name.toLowerCase().includes(searchTerm) ||
        violator.violation.toLowerCase().includes(searchTerm) ||
        violator.violatorId.toLowerCase().includes(searchTerm)
    );
    
    if (filteredViolators.length === 0) {
        grid.innerHTML = `
            <div class="no-violators" style="text-align: center; padding: 60px; color: var(--gray); grid-column: 1 / -1;">
                <i class="fas fa-search" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.5;"></i>
                <h3 style="margin-bottom: 10px;">Ничего не найдено</h3>
                <p>Попробуйте изменить поисковый запрос или создать новую карточку</p>
            </div>
        `;
        return;
    }
    
    grid.innerHTML = filteredViolators.map(violator => `
        <div class="violator-card">
            <div class="violator-card-header">
                <div class="violator-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="violator-name">
                    <h3>${violator.name}</h3>
                    <div class="violator-id">${violator.violatorId}</div>
                </div>
                <span class="status-badge ${violator.status === 'active' ? 'status-active' : 'status-archived'}">
                    <i class="fas fa-circle"></i>
                    ${violator.status === 'active' ? 'Активно' : 'В архиве'}
                </span>
            </div>
            
            <div class="violator-card-body">
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-exclamation-triangle"></i> Нарушение:
                    </div>
                    <div class="violator-value">${violator.violation}</div>
                </div>
                
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-file-alt"></i> Доказательства:
                    </div>
                    ${renderEvidence(violator.evidence)}
                </div>
                
                ${violator.notes ? `
                <div class="violator-info">
                    <div class="violator-label">
                        <i class="fas fa-sticky-note"></i> Примечания:
                    </div>
                    <div class="violator-value">${violator.notes}</div>
                </div>
                ` : ''}
            </div>
            
            <div class="violator-card-footer">
                <div class="violator-meta">
                    <div class="violator-date">
                        <i class="fas fa-calendar"></i>
                        ${violator.createdAt} в ${violator.createdTime}
                    </div>
                    <div style="margin-top: 5px;">
                        <i class="fas fa-user-shield"></i>
                        ${violator.createdBy}
                    </div>
                </div>
                
                <div class="violator-actions">
                    <button class="btn btn-outline" onclick="editViolator(${violator.id})" title="Редактировать">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger" onclick="deleteViolator(${violator.id})" title="Удалить">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

// Удаление карточки
function deleteViolator(id) {
    if (confirm('Вы уверены, что хотите удалить эту карточку?')) {
        violators = violators.filter(v => v.id !== id);
        localStorage.setItem('violators', JSON.stringify(violators));
        updateViolatorsGrid();
        
        // Показываем уведомление об удалении
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.innerHTML = `
            <div style="position: fixed; top: 20px; right: 20px; background: var(--danger); color: white; padding: 15px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1001;">
                <i class="fas fa-trash"></i> Карточка удалена
            </div>
        `;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }
}

// Редактирование карточки (заглушка)
function editViolator(id) {
    alert('Функция редактирования будет реализована в будущем обновлении');
}

// Поиск по карточкам
function initSearch() {
    const searchInput = document.getElementById('searchViolators');
    if (searchInput) {
        searchInput.addEventListener('input', updateViolatorsGrid);
    }
}

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    // Обработчик формы создания карточки
    const form = document.getElementById('createViolatorForm');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            createViolatorCard();
        });
    }
    
    // Инициализация поиска
    initSearch();
    
    // Обновляем сетку при показе раздела
    const originalShowSection = window.showSection;
    window.showSection = function(sectionName) {
        if (originalShowSection) {
            originalShowSection(sectionName);
        }
        
        if (sectionName === 'violators') {
            updateViolatorsGrid();
        }
    };
});
// Вспомогательная функция для разблокировки пользователя в базе
async function unbanUserInDatabase(userId) {
    try {
        const { error } = await supabase
            .from('users')
            .update({
                banned: false,
                ban_reason: null,
                ban_expires: null,
                banned_by: null,
                banned_at: null,
                updated_at: new Date().toISOString()
            })
            .eq('id', userId);

        return !error;
    } catch (error) {
        console.error('Unban user error:', error);
        return false;
    }
}
// Данные руководящего состава
const leadershipData = [
    {
        name: "Igor_Moskovsky",
        position: "Начальник ДПС",
        rank: "Генерал-майор полиции",
        department: "Дорожно-патрульная служба",
        avatar: "👨‍💼",
        description: "Высшее руководство ДПС"
    },
    {
        name: "Albert_Vorobyev",
        position: "Начальник ЦПС",
        rank: "Полковник полиции",
        department: "Центр Подготовки Сотрудников",
        avatar: "👮‍♂️",
        description: "Начальник Центра Подготовки Сотрудников"
    },
    {
        name: "Kubrat_Velikolepniy",
        position: "Начальник ОКН",
        rank: "Полковник полиции",
        department: "Отдел Кадрового Надзора",
        avatar: "🔍",
        description: "Начальник Отдела Кадрового Надзора"
    },
    {
        name: "Dmitriy_Soldatikov",
        position: "Командир ОСР",
        rank: "Полковник полиции",
        department: "Отдельная Специализированная Рота",
        avatar: "⚡",
        description: "Командир Отдельной Специализированной Роты"
    },
    {
        name: "Egor_Dashchonok",
        position: "Командир ОБ",
        rank: "Полковник полиции",
        department: "Отдельный Батальон",
        avatar: "🛡️",
        description: "Командир отдельного батальона"
    },
    {
        name: "Ivan_Lambert",
        position: "Начальник УК",
        rank: "Подполковник полиции",
        department: "Учебный корпус",
        avatar: "🎓",
        description: "Начальник учебного корпусас"
    },
    {
        name: "Michael_Adams",
        position: "Начальник СК",
        rank: "Подполковник полиции",
        department: "Стажерский Корпус",
        avatar: "🔎",
        description: "Начальник Стажерского Корпуса"
    },
    {
        name: "Alexander_Vorobyev",
        position: "Начальник ОИиОС",
        rank: "Подполковник полиции",
        department: "Отдела Информации и Общественных Связей",
        avatar: "💻",
        description: "Начальник Отдела Информации и Общественных Связей",
        badges: ["creator"]
    },
    {
        name: "Ilia_Vladimirov",
        position: "Заместитель начальника ОКН",
        rank: "Подполковник полиции",
        department: "Отдел кадрового надзора",
        avatar: "👨‍💻",
        description: "Заместитель Начальника Отдела кадрового надзора"
    },
    {
        name: "Andrey_Dreamer",
        position: "Заместитель Командира ОСР",
        rank: "Подполковник полиции",
        department: "Отдельная Специализированная Рота",
        avatar: "🚔",
        description: "Командир Отдельной Специализированной Роты"
    },
    {
        name: "Nikolay_Ritnov",
        position: "Заместитель командира ОБ",
        rank: "Подполковник полиции",
        department: "Отдельный Батальон",
        avatar: "🎯",
        description: "Заместитель командира отдельного батальона"
    },
    {
        name: "Vladimir_Vance",
        position: "Инспектор ОКН",
        rank: "Майор полиции",
        department: "Отдел кадрового надзора",
        avatar: "📋",
        description: "Инспектор Отдела кадрового надзора "
    },
    {
        name: "Elisey_Popov",
        position: "Старший Инспектор по ОП",
        rank: "Майор полиции",
        department: "Оперативный отдел",
        avatar: "👁️",
        description: "Инспектор по особым поручениям ОСР"
    },
    {
        name: "Antonio_Scaletta",
        position: "Старший инспектор по ОП",
        rank: "Майор полиции",
        department: "Отдельный Батальон",
        avatar: "🎖️",
        description: "Инспектор по особым поручениям ОБ"
    },
    {
        name: "Ilya_Gollardo",
        position: "Куратор УК",
        rank: "Майор полиции",
        department: "Учебный корпус",
        avatar: "📚",
        description: "Куратор учебного курса"
    }
];

// Функция для отображения карточек руководства
function renderLeadershipCards() {
    const grid = document.getElementById('leadershipGrid');
    if (!grid) return;
    
    grid.innerHTML = leadershipData.map(leader => `
        <div class="leader-card">
            <div class="leader-card-header">
                <div class="leader-avatar">${leader.avatar}</div>
                <div class="leader-name">${leader.name}</div>
                <div class="leader-position">${leader.position}</div>
                <div class="leader-rank">${leader.rank}</div>
            </div>
            <div class="leader-card-body">
                <div class="leader-info">
                    <div class="info-label">
                        <i class="fas fa-building"></i>
                        Подразделение:
                    </div>
                    <div class="info-value">${leader.department}</div>
                </div>
                <div class="leader-info">
                    <div class="info-label">
                        <i class="fas fa-info-circle"></i>
                        Описание:
                    </div>
                    <div class="info-value">${leader.description}</div>
                </div>
                ${leader.badges ? leader.badges.map(badge => `
                    <div class="leader-badge ${badge}">
                        <i class="fas fa-${badge === 'creator' ? 'code' : 'star'}"></i>
                        ${badge === 'creator' ? 'Главный разработчик сайта' : 'Высшее руководство'}
                    </div>
                `).join('') : ''}
            </div>
        </div>
    `).join('');
}

// Обновление функции showSection для загрузки руководства
const originalShowSection = window.showSection;
window.showSection = function(sectionName) {
    if (originalShowSection) {
        originalShowSection(sectionName);
    }
    
    if (sectionName === 'leadership') {
        setTimeout(renderLeadershipCards, 100);
    }
};

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
    // Добавляем вкладку в навигацию если её нет
    setTimeout(() => {
        const navTabs = document.querySelector('.nav-tabs');
        if (navTabs && !document.querySelector('[onclick="showSection(\'leadership\')"]')) {
            const leadershipTab = document.createElement('li');
            leadershipTab.innerHTML = `
                <a href="#" onclick="showSection('leadership')">
                    <i class="fas fa-user-tie"></i> Начальство
                </a>
            `;
            navTabs.appendChild(leadershipTab);
        }
    }, 1000);
});
// Инициализация плавных переходов
document.addEventListener('DOMContentLoaded', function() {
  // Устанавливаем начальные стили для плавных переходов
  const sections = document.querySelectorAll('.content-section');
  sections.forEach(section => {
    section.style.transition = 'all 0.3s ease';
  });
  
  const adminTabs = document.querySelectorAll('.admin-tab-content');
  adminTabs.forEach(tab => {
    tab.style.transition = 'all 0.3s ease';
  });
  
  const leaderboards = document.querySelectorAll('.leaderboard-content');
  leaderboards.forEach(leaderboard => {
    leaderboard.style.transition = 'all 0.3s ease';
  });
});
// Обновленная функция переключения секций с анимацией
function showSection(sectionName) {
  // Находим все секции
  const sections = document.querySelectorAll('.content-section');
  const activeLink = document.querySelector('.nav-tabs a.active');
  
  // Плавное скрытие текущей секции
  sections.forEach(section => {
    if (section.style.display !== 'none') {
      section.style.opacity = '0';
      section.style.transform = 'translateY(-10px)';
      setTimeout(() => {
        section.style.display = 'none';
      }, 150);
    }
  });
  
  // Обновляем активную вкладку
  if (activeLink) {
    activeLink.classList.remove('active');
  }
  
  // Находим и активируем соответствующую ссылку
  const newActiveLink = Array.from(document.querySelectorAll('.nav-tabs a')).find(link => 
    link.getAttribute('onclick')?.includes(sectionName)
  );
  if (newActiveLink) {
    newActiveLink.classList.add('active');
  }
  
  // Плавное отображение новой секции
  setTimeout(() => {
    const targetSection = document.getElementById(sectionName + '-section');
    if (targetSection) {
      targetSection.style.display = 'block';
      setTimeout(() => {
        targetSection.style.opacity = '1';
        targetSection.style.transform = 'translateY(0)';
        targetSection.style.transition = 'all 0.3s ease';
      }, 50);
    }
    
    // Специальные действия для некоторых разделов
    if (sectionName === 'leaderboard') {
      updateLeaderboards();
    } else if (sectionName === 'profile') {
      updateProfileInfo();
    } else if (sectionName === 'admin' && hasPermission(currentUser, 'view_users')) {
      showAdminTab('users');
    } else if (sectionName === 'statistics' && currentUserStats) {
      document.getElementById('stat-fines').textContent = currentUserStats.fines;
      document.getElementById('stat-arrests').textContent = currentUserStats.arrests;
      document.getElementById('stat-licenses').textContent = currentUserStats.licenses;
      document.getElementById('stat-searches').textContent = currentUserStats.searches;
      document.getElementById('stat-rating').textContent = currentUserStats.rating;
    } else if (sectionName === 'settings') {
      loadSettings();
    } else if (sectionName === 'violators') {
      updateViolatorsGrid();
    } else if (sectionName === 'leadership') {
      setTimeout(renderLeadershipCards, 100);
    }
  }, 150);
}
// ==================== УЛУЧШЕННАЯ СИСТЕМА УВЕДОМЛЕНИЙ ====================
class NotificationSystem {
    constructor() {
        this.container = null;
        this.notificationCount = 0;
        this.maxNotifications = 5;
        this.init();
    }

    init() {
        this.createContainer();
        this.setupEventListeners();
        this.testNotifications();
    }

    createContainer() {
        this.container = document.createElement('div');
        this.container.id = 'notificationsContainer';
        this.container.className = 'notifications-container';
        document.body.appendChild(this.container);
    }

    setupEventListeners() {
        // Перехват системных alert
        this.interceptAlerts();
        
        // Перехват системных confirm
        this.interceptConfirms();
        
        // Перехват fetch запросов для уведомлений
        this.interceptFetch();
        
        // Уведомления для навигации
        this.setupNavigationNotifications();
        
        // Уведомления для копирования
        this.setupCopyNotifications();
        
        // Уведомления для форм
        this.setupFormNotifications();
        
        // Уведомления для действий администратора
        this.setupAdminNotifications();
    }

    interceptAlerts() {
        const originalAlert = window.alert;
        window.alert = (message, type = 'info') => {
            this.show({
                title: 'Уведомление',
                message: message,
                type: type,
                duration: 4000
            });
            return true;
        };
    }

    interceptConfirms() {
        const originalConfirm = window.confirm;
        window.confirm = (message) => {
            return new Promise((resolve) => {
                this.showConfirm({
                    title: 'Подтверждение действия',
                    message: message,
                    onConfirm: () => resolve(true),
                    onCancel: () => resolve(false)
                });
            });
        };
    }

    setupNavigationNotifications() {
        // Уведомления при переключении разделов
        const originalShowSection = window.showSection;
        window.showSection = (sectionName) => {
            if (originalShowSection) {
                originalShowSection(sectionName);
            }
            
            const sectionNames = {
                'dashboard': 'Панель управления',
                'binds': 'Бинды для игры',
                'commands': 'Игровые команды',
                'documents': 'Нормативные документы',
                'violators': 'База нарушителей',
                'profile': 'Профиль сотрудника',
                'settings': 'Настройки системы',
                'admin': 'Административная панель',
                'leaderboard': 'Таблица лидеров',
                'leadership': 'Руководство ГИБДД',
                'weapon': 'Табельное оружие',
                'radio': 'Регламент радиообмена',
                'jurisdiction': 'Юрисдикции МВД',
                'map': 'Карта постов',
                'fleet': 'Автопарк ГИБДД',
                'pdd-tests': 'Тесты ПДД',
                'hotspots': 'Очаги нарушений',
                'guides': 'Мини-гайды',
                'statistics': 'Статистика',
                'profile-settings': 'Настройки профиля',
                'roleplay': 'Полезные отыгровки'
            };
            
            if (sectionNames[sectionName]) {
                this.show({
                    title: 'Переключение раздела',
                    message: `Открыт раздел: ${sectionNames[sectionName]}`,
                    type: 'info',
                    duration: 2000
                });
            }
        };
    }

    setupCopyNotifications() {
        // Уведомления при копировании
        const originalCopyBind = window.copyBind;
        window.copyBind = (key) => {
            if (originalCopyBind) originalCopyBind(key);
            
            this.show({
                title: 'Бинд скопирован',
                message: `Бинд для клавиши "${key}" скопирован в буфер обмена`,
                type: 'success',
                duration: 2000
            });
        };

        const originalCopyBindText = window.copyBindText;
        window.copyBindText = (text) => {
            if (originalCopyBindText) originalCopyBindText(text);
            
            const truncatedText = text.length > 50 ? text.substring(0, 50) + '...' : text;
            
            this.show({
                title: 'Текст скопирован',
                message: `Текст скопирован: "${truncatedText}"`,
                type: 'success',
                duration: 2000
            });
        };
    }

    setupFormNotifications() {
        // Уведомления для форм авторизации
        document.addEventListener('DOMContentLoaded', () => {
            // Уведомления при успешной авторизации
            const originalLoginForm = document.getElementById('loginForm');
            if (originalLoginForm) {
                originalLoginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Здесь будет реальная авторизация
                    this.show({
                        title: 'Успешный вход',
                        message: 'Вы успешно авторизовались в системе',
                        type: 'success',
                        duration: 3000
                    });
                });
            }

            // Уведомления при регистрации
            const originalRegisterForm = document.getElementById('registerForm');
            if (originalRegisterForm) {
                originalRegisterForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Здесь будет реальная регистрация
                    this.show({
                        title: 'Регистрация успешна',
                        message: 'Аккаунт успешно создан',
                        type: 'success',
                        duration: 3000
                    });
                });
            }

            // Уведомления для смены пароля
            const changePasswordForm = document.getElementById('changePasswordForm');
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.show({
                        title: 'Пароль изменен',
                        message: 'Пароль успешно изменен',
                        type: 'success',
                        duration: 3000
                    });
                    hideModal('changePasswordModal');
                });
            }

            // Уведомления для смены никнейма
            const changeNicknameForm = document.getElementById('changeNicknameForm');
            if (changeNicknameForm) {
                changeNicknameForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.show({
                        title: 'Никнейм изменен',
                        message: 'Никнейм успешно изменен',
                        type: 'success',
                        duration: 3000
                    });
                    hideModal('changeNicknameModal');
                });
            }
        });
    }

    setupAdminNotifications() {
        // Уведомления для административных действий
        window.showNotification = (title, message, type = 'info', duration = 4000) => {
            this.show({ title, message, type, duration });
        };

        // Уведомления при редактировании пользователей
        window.saveUserChanges = () => {
            this.show({
                title: 'Данные обновлены',
                message: 'Данные пользователя успешно обновлены',
                type: 'success',
                duration: 3000
            });
        };

        // Уведомления при назначении администратора
        window.assignAdmin = () => {
            this.show({
                title: 'Права назначены',
                message: 'Пользователь назначен администратором',
                type: 'warning',
                duration: 3000
            });
        };

        // Уведомления при бане пользователя
        window.banUser = () => {
            this.show({
                title: 'Пользователь заблокирован',
                message: 'Пользователь успешно заблокирован',
                type: 'error',
                duration: 4000
            });
        };

        // Уведомления при разбане пользователя
        window.unbanUser = () => {
            this.show({
                title: 'Пользователь разблокирован',
                message: 'Пользователь успешно разблокирован',
                type: 'success',
                duration: 3000
            });
        };
    }

    show(options) {
        const {
            title,
            message,
            type = 'info',
            duration = 4000,
            icon = null
        } = options;

        this.notificationCount++;
        
        // Удаляем старые уведомления если их слишком много
        if (this.container.children.length >= this.maxNotifications) {
            const firstChild = this.container.firstElementChild;
            if (firstChild) {
                firstChild.style.animation = 'slideOutRight 0.3s ease-out forwards';
                setTimeout(() => firstChild.remove(), 300);
            }
        }

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.dataset.id = Date.now();

        // Получаем иконку для типа уведомления
        const typeIcons = {
            'success': '✓',
            'error': '✗',
            'warning': '⚠',
            'info': 'ℹ'
        };

        const typeColors = {
            'success': '#2ed573',
            'error': '#ff4757',
            'warning': '#ffa502',
            'info': '#7158e2'
        };

        const notificationIcon = icon || typeIcons[type] || typeIcons.info;
        const notificationColor = typeColors[type] || typeColors.info;

        notification.innerHTML = `
            <div class="notification-header">
                <div class="notification-title">
                    <span class="notification-icon" style="color: ${notificationColor}">${notificationIcon}</span>
                    <span>${title}</span>
                </div>
                <button class="notification-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="notification-content">${message}</div>
            ${duration > 0 ? `<div class="notification-progress" style="animation-duration: ${duration}ms"></div>` : ''}
        `;

        this.container.appendChild(notification);

        // Обработчик закрытия
        const closeBtn = notification.querySelector('.notification-close');
        closeBtn.onclick = () => this.removeNotification(notification);

        // Автоматическое удаление
        if (duration > 0) {
            setTimeout(() => {
                this.removeNotification(notification);
            }, duration);
        }

        return notification;
    }

    showConfirm(options) {
        const {
            title = 'Подтверждение',
            message = 'Вы уверены?',
            confirmText = 'Подтвердить',
            cancelText = 'Отмена',
            onConfirm = () => {},
            onCancel = () => {}
        } = options;

        const notification = this.show({
            title,
            message,
            type: 'warning',
            duration: 0 // Бесконечная длительность
        });

        // Добавляем кнопки действий
        const content = notification.querySelector('.notification-content');
        const buttonsContainer = document.createElement('div');
        buttonsContainer.className = 'notification-buttons';

        const confirmBtn = document.createElement('button');
        confirmBtn.textContent = confirmText;
        confirmBtn.className = 'notification-btn confirm';

        const cancelBtn = document.createElement('button');
        cancelBtn.textContent = cancelText;
        cancelBtn.className = 'notification-btn cancel';

        confirmBtn.onclick = () => {
            onConfirm();
            this.removeNotification(notification);
        };

        cancelBtn.onclick = () => {
            onCancel();
            this.removeNotification(notification);
        };

        buttonsContainer.appendChild(cancelBtn);
        buttonsContainer.appendChild(confirmBtn);
        content.appendChild(buttonsContainer);
    }

    removeNotification(notification) {
        if (!notification.parentNode) return;
        
        notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
                this.notificationCount--;
            }
        }, 300);
    }

    clearAll() {
        Array.from(this.container.children).forEach(notification => {
            this.removeNotification(notification);
        });
    }
}

// ==================== ДОПОЛНИТЕЛЬНЫЕ СТИЛИ ДЛЯ УВЕДОМЛЕНИЙ ====================
const notificationStyles = `
/* Улучшенные стили уведомлений */
.notifications-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    max-width: 400px;
    min-width: 300px;
    pointer-events: none;
}

.notifications-container .notification {
    pointer-events: auto;
}

.notification-buttons {
    display: flex;
    gap: 10px;
    margin-top: 15px;
    justify-content: flex-end;
}

.notification-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.2s;
    min-width: 70px;
}

.notification-btn.confirm {
    background: var(--accent-red);
    color: white;
}

.notification-btn.cancel {
    background: var(--gray-dark);
    color: var(--text-primary);
}

.notification-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.notification-btn.confirm:hover {
    background: #ff3838;
}

.notification-btn.cancel:hover {
    background: var(--gray-medium);
}

.notification-icon {
    font-size: 18px;
    margin-right: 8px;
    font-weight: bold;
}

/* Анимации */
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

@keyframes progressBar {
    from {
        width: 100%;
    }
    to {
        width: 0%;
    }
}

/* Адаптивность */
@media (max-width: 768px) {
    .notifications-container {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
    }
    
    .notification {
        width: 100%;
    }
}

/* Темная тема улучшения */
.dark-theme .notification {
    background: var(--black-tertiary);
    border: 1px solid var(--border-primary);
    box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}

.dark-theme .notification-btn.cancel {
    background: var(--gray-darker);
}

.dark-theme .notification-btn.cancel:hover {
    background: var(--gray-dark);
}
`;

// Добавляем стили в документ
const styleSheet = document.createElement('style');
styleSheet.textContent = notificationStyles;
document.head.appendChild(styleSheet);

// ==================== ИНИЦИАЛИЗАЦИЯ СИСТЕМЫ ====================
let notificationSystem;

document.addEventListener('DOMContentLoaded', () => {
    notificationSystem = new NotificationSystem();
    
    // Добавляем глобальные методы для использования в других скриптах
    window.showNotification = (title, message, type = 'info', duration = 4000) => {
        if (notificationSystem) {
            return notificationSystem.show({ title, message, type, duration });
        }
    };
    
    window.showConfirm = (options) => {
        if (notificationSystem) {
            notificationSystem.showConfirm(options);
        }
    };
    
    window.clearAllNotifications = () => {
        if (notificationSystem) {
            notificationSystem.clearAll();
        }
    };
});

// ==================== УВЕДОМЛЕНИЯ ДЛЯ СПЕЦИФИЧЕСКИХ ДЕЙСТВИЙ ====================
// Уведомления для статистики
function setupStatNotifications() {
    const originalUpdateStat = window.updateStat;
    if (originalUpdateStat) {
        window.updateStat = (stat, value) => {
            const statNames = {
                'fines': 'штрафов',
                'arrests': 'задержаний',
                'licenses': 'изъятий прав',
                'searches': 'досмотров',
                'rating': 'рейтинга'
            };
            
            const action = value > 0 ? 'увеличено' : 'уменьшено';
            
            showNotification(
                'Статистика обновлена',
                `${statNames[stat]} ${action} на ${Math.abs(value)}`,
                value > 0 ? 'success' : 'warning',
                3000
            );
            
            return originalUpdateStat(stat, value);
        };
    }
}

// Уведомления для тестов ПДД
function setupPDDNotifications() {
    const originalStartPDDTest = window.startPDDTest;
    if (originalStartPDDTest) {
        window.startPDDTest = () => {
            showNotification(
                'Тест начался',
                'Ответьте на вопросы по ПДД. Удачи!',
                'info',
                3000
            );
            return originalStartPDDTest();
        };
    }
    
    const originalFinishTest = window.finishTest;
    if (originalFinishTest) {
        window.finishTest = () => {
            showNotification(
                'Тест завершен',
                'Результаты теста сохранены',
                'success',
                4000
            );
            return originalFinishTest();
        };
    }
}

// Уведомления для карточек нарушителей
function setupViolatorNotifications() {
    const originalCreateViolatorCard = window.createViolatorCard;
    if (originalCreateViolatorCard) {
        window.createViolatorCard = () => {
            showNotification(
                'Карточка создана',
                'Новая карточка нарушителя успешно создана',
                'success',
                3000
            );
            return originalCreateViolatorCard();
        };
    }
}

// Запускаем все настройки
document.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
        setupStatNotifications();
        setupPDDNotifications();
        setupViolatorNotifications();
    }, 2000);
});
console.log('🎯 Система уведомлений успешно загружена и готова к работе!');

// ФИКС СКРОЛЛБАРА
function fixScrollbar() {
    const scrollbarStyles = `
        /* ==================== ФИКС СКРОЛЛБАРА ==================== */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
            background: transparent;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--black-secondary);
            border-radius: 5px;
            margin: 2px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-dark);
            border-radius: 5px;
            border: 2px solid var(--black-secondary);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-medium);
        }
        
        ::-webkit-scrollbar-corner {
            background: var(--black-secondary);
        }
        
        /* Для Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: var(--gray-dark) var(--black-secondary);
        }
        
        /* ==================== АНИМАЦИИ УВЕДОМЛЕНИЙ ==================== */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        @keyframes progressBar {
            from {
                width: 100%;
            }
            to {
                width: 0%;
            }
        }
        
        /* ==================== СТИЛИ КНОПОК УВЕДОМЛЕНИЙ ==================== */
        .notification-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: flex-end;
        }
        
        .notification-btn {
            padding: 8px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            min-width: 70px;
        }
        
        .notification-btn.confirm {
            background: var(--accent-red);
            color: white;
        }
        
        .notification-btn.cancel {
            background: var(--gray-dark);
            color: var(--text-primary);
        }
        
        .notification-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .notification-btn.confirm:hover {
            background: #ff3838;
        }
        
        .notification-btn.cancel:hover {
            background: var(--gray-medium);
        }
        
        .notification-input-container {
            margin-top: 15px;
        }
        
        .notification-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--black-quaternary);
            border: 1px solid var(--border-primary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 14px;
            outline: none;
            margin-bottom: 10px;
        }
        
        .notification-input:focus {
            border-color: var(--accent-red);
            box-shadow: 0 0 0 2px rgba(255, 71, 87, 0.2);
        }
    `;
    
    // Добавляем стили
    const style = document.createElement('style');
    style.textContent = scrollbarStyles;
    document.head.appendChild(style);
    
    // Принудительно обновляем скроллбар
    document.body.style.overflow = 'auto';
}

// Запускаем фикс при загрузке
document.addEventListener('DOMContentLoaded', function() {
    fixScrollbar();
  
});

// Перехватываем события для красивого закрытия
window.addEventListener('beforeunload', function(e) {
    if (document.querySelectorAll('.notification').length > 0) {
        const confirmationMessage = 'Вы уверены, что хотите покинуть страницу?';
        showNotification('Внимание!', confirmationMessage, 'warning', 4000);
        e.returnValue = confirmationMessage;
        return confirmationMessage;
    }
});


// ==================== СИСТЕМА ТЕСТОВ ПДД ====================

const pddQuestions = [
    {
        id: 1,
        question: "Человек повернул со средней полосы направо.",
        answers: [
            "Нарушение правил маневрирования",
            "Нарушение расположения ТС на проезжей части", 
            "Создание помех другим ТС",
            "Неподача сигнала поворота"
        ],
        correctAnswer: 0,
        koap: "Статья 8.3 КоАП",
        punishment: "Штраф 20.000 рублей"
    },
    {
        id: 2,
        question: "Человек проехал по тротуару.",
        answers: [
            "Нарушение правил остановки",
            "Движение по тротуару",
            "Создание помех пешеходам", 
            "Нарушение правил маневрирования"
        ],
        correctAnswer: 1,
        koap: "Статья 9.5 КоАП",
        punishment: "Штраф 30.000 рублей"
    },
    {
        id: 3,
        question: "Человек помешал обгону Т/С.",
        answers: [
            "Нарушение правил обгона",
            "Создание помех движению",
            "Опасное вождение",
            "Нарушение дистанции"
        ],
        correctAnswer: 0,
        koap: "Статья 10.4 КоАП", 
        punishment: "Штраф 20.000 рублей"
    },
    {
        id: 4,
        question: "Человек припарковал автомобиль на тротуаре.",
        answers: [
            "Нарушение правил остановки",
            "Нарушение правил стоянки",
            "Создание помех пешеходам",
            "Неправильная парковка"
        ],
        correctAnswer: 1,
        koap: "Статья 11.1 КоАП",
        punishment: "Штраф 10.000 рублей"
    },
    {
        id: 5,
        question: "Человек не предоставил преимущество спец.транспорту с включенным проблесковым маячком и специальным звуковым сигналом.",
        answers: [
            "Нарушение правил проезда перекрёстков",
            "Невыполнение требований ПДД",
            "Непредоставление преимущества",
            "Создание помех спецтранспорту"
        ],
        correctAnswer: 2,
        koap: "Статья 15.1 КоАП",
        punishment: "Штраф 20.000 рублей"
    },
    {
        id: 6,
        question: "Неоказание первой помощи при ДТП.",
        answers: [
            "Нарушение ПДД",
            "Оставление места ДТП", 
            "Невыполнение обязанностей при ДТП",
            "Неоказание помощи пострадавшим"
        ],
        correctAnswer: 2,
        koap: "Статья 16.2 КоАП",
        punishment: "Штраф 20.000 рублей"
    },
    {
        id: 7,
        question: "Человек входил в управляемый занос на общественной дороге.",
        answers: [
            "Нарушение правил эксплуатации ТС",
            "Опасное вождение", 
            "Создание аварийной ситуации",
            "Нарушение скоростного режима"
        ],
        correctAnswer: 1,
        koap: "Статья 17.2 КоАП",
        punishment: "Штраф до 30.000 рублей с лишением права на управление ТС сроком до 2 лет"
    },
    {
        id: 8,
        question: "Человек не уступил дорогу пешеходу.",
        answers: [
            "Нарушение правил проезда пешеходных переходов",
            "Создание помех пешеходам",
            "Невыполнение требований ПДД", 
            "Нарушение правил маневрирования"
        ],
        correctAnswer: 0,
        koap: "Статья 15.4 КоАП",
        punishment: "Предупреждение или штраф 5.000 рублей"
    },
    {
        id: 9,
        question: "Человек повернул направо без указателя поворота.",
        answers: [
            "Нарушение правил маневрирования",
            "Неподача сигнала поворота", 
            "Создание аварийной ситуации",
            "Нарушение расположения ТС"
        ],
        correctAnswer: 1,
        koap: "Статья 8.1 КоАП",
        punishment: "Предупреждение или штраф 5.000 рублей"
    },
    {
        id: 10,
        question: "Человек управлял Т/С без документов при себе.",
        answers: [
            "Управление ТС без документов", 
            "Нарушение правил эксплуатации ТС",
            "Невыполнение требований ПДД",
            "Отсутствие необходимых документов"
        ],
        correctAnswer: 0,
        koap: "Статья 5.1 КоАП",
        punishment: "Штраф 20.000 рублей"
    },
    {
        id: 11,
        question: "Человек проигнорировал требование об остановке при помощи жезла.",
        answers: [
            "Неподчинение сигналу регулировщика",
            "Невыполнение требования об остановке", 
            "Нарушение правил дорожного движения",
            "Сопротивление сотруднику полиции"
        ],
        correctAnswer: 1,
        koap: "Статья 5.9 КоАП",
        punishment: "Штраф 20.000 рублей"
    }
];

let currentTestState = {
    currentQuestion: 0,
    userAnswers: [],
    testStarted: false
};

// Загрузка теста ПДД при показе секции
function loadPDDTestSection() {
    const container = document.getElementById('pddTestContent');
    if (!container) return;
    
    // Всегда показываем стартовый экран при входе в раздел
    currentTestState = {
        currentQuestion: 0,
        userAnswers: new Array(pddQuestions.length).fill(null),
        testStarted: false
    };
    showTestStartScreen(container);
}

// Показать стартовый экран теста
function showTestStartScreen(container) {
    container.innerHTML = `
        <div class="test-start-screen" style="text-align: center; padding: 60px 20px;">
            <div style="font-size: 4rem; margin-bottom: 20px;">🚓</div>
            <h2 style="margin-bottom: 15px; color: var(--primary);">Тест по ПДД</h2>
            <p style="margin-bottom: 30px; font-size: 1.1rem; color: var(--gray);">
                Проверьте свои знания правил дорожного движения.<br>
                В тесте ${pddQuestions.length} вопросов. Укажите статью КоАП и наказание.
            </p>
            <div style="background: var(--light); padding: 25px; border-radius: 12px; margin: 30px 0; text-align: left;">
                <h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-info-circle"></i> Правила тестирования:</h4>
                <ul style="color: var(--text-color); line-height: 1.6;">
                    <li>Выберите правильный вариант ответа</li>
                    <li>Укажите соответствующую статью КоАП</li>
                    <li>Запишите предусмотренное наказание</li>
                    <li>Можно вернуться к предыдущим вопросам</li>
                    <li>Результат покажет ваш уровень знаний</li>
                </ul>
            </div>
            <button class="btn btn-success" onclick="startPDDTest()" style="padding: 15px 40px; font-size: 1.1rem;">
                <i class="fas fa-play"></i> Начать тест
            </button>
        </div>
    `;
}

// Начать тест
function startPDDTest() {
    currentTestState = {
        currentQuestion: 0,
        userAnswers: new Array(pddQuestions.length).fill(null),
        testStarted: true
    };
    showQuestion(document.getElementById('pddTestContent'));
    showNotification('Тест начался!', 'Ответьте на вопросы по ПДД.', 'info', 4000);
}

// Показать вопрос
function showQuestion(container) {
    const question = pddQuestions[currentTestState.currentQuestion];
    const progress = ((currentTestState.currentQuestion + 1) / pddQuestions.length) * 100;
    
    container.innerHTML = `
        <div class="test-progress">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <span>Вопрос ${currentTestState.currentQuestion + 1} из ${pddQuestions.length}</span>
                <span style="font-weight: 600; color: var(--primary);">${Math.round(progress)}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: ${progress}%"></div>
            </div>
        </div>
        
        <div class="test-question">
            <div class="question-text">${question.question}</div>
            
            <div class="answers-grid">
                ${question.answers.map((answer, index) => `
                    <div class="answer-option ${currentTestState.userAnswers[currentTestState.currentQuestion] === index ? 'selected' : ''}" 
                         onclick="selectAnswer(${index})">
                        <div class="answer-checkbox">
                            ${currentTestState.userAnswers[currentTestState.currentQuestion] === index ? '<i class="fas fa-check" style="color: var(--primary); font-size: 12px;"></i>' : ''}
                        </div>
                        <div class="answer-text">${answer}</div>
                    </div>
                `).join('')}
            </div>
            
            <div class="koap-note">
                <h4><i class="fas fa-gavel"></i> Примечание:</h4>
                <p><strong>Статья КоАП:</strong> ${question.koap}</p>
                <p><strong>Наказание:</strong> ${question.punishment}</p>
            </div>
            
            <div class="test-navigation">
                <button class="btn btn-outline" onclick="previousQuestion()" ${currentTestState.currentQuestion === 0 ? 'disabled' : ''}>
                    <i class="fas fa-arrow-left"></i> Назад
                </button>
                
                <div style="display: flex; gap: 10px;">
                    ${currentTestState.currentQuestion < pddQuestions.length - 1 ? `
                        <button class="btn btn-outline" onclick="nextQuestion()">
                            Следующий вопрос <i class="fas fa-arrow-right"></i>
                        </button>
                    ` : ''}
                    
                    ${currentTestState.currentQuestion === pddQuestions.length - 1 ? `
                        <button class="btn btn-success" onclick="finishTest()">
                            <i class="fas fa-flag-checkered"></i> Завершить тест
                        </button>
                    ` : ''}
                </div>
            </div>
        </div>
    `;
}

// Выбор ответа
function selectAnswer(answerIndex) {
    currentTestState.userAnswers[currentTestState.currentQuestion] = answerIndex;
    showQuestion(document.getElementById('pddTestContent'));
    
    // Показать уведомление о правильности ответа
    const question = pddQuestions[currentTestState.currentQuestion];
    if (answerIndex === question.correctAnswer) {
        showNotification('Правильно!', 'Вы выбрали верный ответ.', 'success', 2000);
    } else {
        showNotification('Неправильно!', 'Попробуйте ещё раз.', 'warning', 2000);
    }
}

// Следующий вопрос
function nextQuestion() {
    if (currentTestState.currentQuestion < pddQuestions.length - 1) {
        currentTestState.currentQuestion++;
        showQuestion(document.getElementById('pddTestContent'));
    }
}

// Предыдущий вопрос
function previousQuestion() {
    if (currentTestState.currentQuestion > 0) {
        currentTestState.currentQuestion--;
        showQuestion(document.getElementById('pddTestContent'));
    }
}

// Завершить тест
function finishTest() {
    const score = calculateTestScore();
    showTestResults(score);
    showNotification(
        'Тест завершён!', 
        `Ваш результат: ${score.correctAnswers} из ${pddQuestions.length} правильных ответов.`, 
        score.percentage >= 70 ? 'success' : 'warning',
        5000
    );
}

// Расчет результатов
function calculateTestScore() {
    let correctAnswers = 0;
    const results = [];
    
    pddQuestions.forEach((question, index) => {
        const isCorrect = currentTestState.userAnswers[index] === question.correctAnswer;
        if (isCorrect) correctAnswers++;
        
        results.push({
            question: question.question,
            userAnswer: question.answers[currentTestState.userAnswers[index]] || 'Не отвечено',
            correctAnswer: question.answers[question.correctAnswer],
            isCorrect: isCorrect,
            koap: question.koap,
            punishment: question.punishment
        });
    });
    
    const percentage = (correctAnswers / pddQuestions.length) * 100;
    
    return {
        correctAnswers,
        totalQuestions: pddQuestions.length,
        percentage,
        results
    };
}

// Показать результаты
function showTestResults(score) {
    const container = document.getElementById('pddTestContent');
    const message = getResultMessage(score.percentage);
    
    container.innerHTML = `
        <div class="test-results">
            <div class="results-score">${score.correctAnswers}/${score.totalQuestions}</div>
            <div class="results-message">${message}</div>
            <div style="font-size: 1.1rem; color: var(--gray); margin-bottom: 30px;">
                Правильных ответов: ${Math.round(score.percentage)}%
            </div>
            
            <div class="results-details">
                <h4 style="margin-bottom: 20px; color: var(--primary);"><i class="fas fa-list-alt"></i> Детализация ответов:</h4>
                ${score.results.map((result, index) => `
                    <div class="result-item">
                        <div class="result-question">
                            <strong>Вопрос ${index + 1}:</strong> ${result.question}
                        </div>
                        <div class="result-status ${result.isCorrect ? 'correct' : 'incorrect'}">
                            ${result.isCorrect ? 'Правильно' : 'Неправильно'}
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                <button class="btn btn-outline" onclick="restartTest()">
                    <i class="fas fa-redo"></i> Пройти ещё раз
                </button>
                <button class="btn btn-success" onclick="showSection('dashboard')">
                    <i class="fas fa-home"></i> На главную
                </button>
            </div>
        </div>
    `;
}

// Получить сообщение по результатам
function getResultMessage(percentage) {
    if (percentage >= 90) return 'Отлично! Вы прекрасно знаете ПДД! 🎉';
    if (percentage >= 70) return 'Хорошо! Solidные знания ПДД. 👍';
    if (percentage >= 50) return 'Удовлетворительно. Есть над чем поработать. 💪';
    return 'Нужно повторить ПДД. Рекомендуем пройти обучение. 📚';
}

// Перезапустить тест
function restartTest() {
    currentTestState = {
        currentQuestion: 0,
        userAnswers: new Array(pddQuestions.length).fill(null),
        testStarted: false
    };
    loadPDDTestSection();
}

// ==================== ИНТЕГРАЦИЯ ====================

// Добавляем обработку секции тестов ПДД
document.addEventListener('DOMContentLoaded', function() {
    // Показать приветственное уведомление при загрузке
    setTimeout(() => {
        showNotification(
            'Добро пожаловать в систему ГИБДД!', 
            'Доступны новые функции: тесты ПДД и система уведомлений.', 
            'info', 
            6000
        );
    }, 1000);
});

// Обновляем функцию showSection для тестов ПДД (если она есть)
if (typeof showSection === 'function') {
    const originalShowSection = showSection;
    window.showSection = function(sectionName) {
        originalShowSection(sectionName);
        
        if (sectionName === 'pdd-tests') {
            setTimeout(() => {
                loadPDDTestSection();
            }, 100);
        }
    };
} else {
    // Если функции showSection нет, создаем простую версию
    window.showSection = function(sectionName) {
        // Скрываем все секции
        document.querySelectorAll('.content-section').forEach(section => {
            section.style.display = 'none';
        });
        
        // Показываем нужную секцию
        const targetSection = document.getElementById(sectionName + '-section');
        if (targetSection) {
            targetSection.style.display = 'block';
        }
        
        // Обработка тестов ПДД
        if (sectionName === 'pdd-tests') {
            setTimeout(() => {
                loadPDDTestSection();
            }, 100);
        }
    };
}
// Функции для работы с профилем
function handleAvatarUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const avatarPreview = document.getElementById('avatarPreview');
            avatarPreview.innerHTML = `<img src="${e.target.result}" alt="Аватар">`;
            
            // Сохраняем в localStorage
            localStorage.setItem('userAvatar', e.target.result);
        };
        reader.readAsDataURL(file);
    }
}

function removeAvatar() {
    const avatarPreview = document.getElementById('avatarPreview');
    avatarPreview.innerHTML = '<i class="fas fa-user"></i>';
    localStorage.removeItem('userAvatar');
}

function saveProfileSettings() {
    const description = document.getElementById('profileDescription').value;
    const status = document.getElementById('profileStatus').value;
    
    // Сохраняем в localStorage
    localStorage.setItem('userDescription', description);
    localStorage.setItem('userStatus', status);
    
    // Обновляем профиль в реальном времени
    updateUserProfile();
    
    alert('Настройки профиля сохранены!');
}

function loadProfileSettings() {
    // Загружаем настройки из localStorage
    const avatar = localStorage.getItem('userAvatar');
    const description = localStorage.getItem('userDescription');
    const status = localStorage.getItem('userStatus');
    
    if (avatar) {
        document.getElementById('avatarPreview').innerHTML = `<img src="${avatar}" alt="Аватар">`;
    }
    
    if (description) {
        document.getElementById('profileDescription').value = description;
    }
    
    if (status) {
        document.getElementById('profileStatus').value = status;
    }
}

function updateUserProfile() {
    // Обновляем профиль в интерфейсе
    const status = localStorage.getItem('userStatus') || 'Активен';
    const avatar = localStorage.getItem('userAvatar');
    
    // Обновляем статус в хедере
    const statusElement = document.querySelector('.user-status');
    if (!statusElement) {
        // Создаем элемент статуса если его нет
        const userInfo = document.querySelector('.user-info');
        if (userInfo) {
            const statusElement = document.createElement('div');
            statusElement.className = 'user-status';
            statusElement.style.fontSize = '0.85rem';
            statusElement.style.opacity = '0.9';
            statusElement.textContent = status;
            userInfo.appendChild(statusElement);
        }
    } else {
        statusElement.textContent = status;
    }
    
    // Обновляем аватар в хедере
    if (avatar) {
        const headerAvatar = document.querySelector('.user-avatar');
        if (headerAvatar) {
            headerAvatar.innerHTML = `<img src="${avatar}" alt="Аватар" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
        }
    }
}

// Загружаем настройки при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    loadProfileSettings();
    updateUserProfile();
});
// Оптимизация для мобильных устройств
function optimizeForMobile() {
    // Отключаем сложные анимации на слабых устройствах
    if ('connection' in navigator) {
        if (navigator.connection.saveData || 
            navigator.connection.effectiveType.includes('2g') ||
            navigator.connection.effectiveType.includes('3g')) {
            document.body.classList.add('reduced-motion');
        }
    }
    
    // Добавляем класс для touch устройств
    if ('ontouchstart' in window || 
        navigator.maxTouchPoints > 0 || 
        navigator.msMaxTouchPoints > 0) {
        document.body.classList.add('touch-device');
    }
    
    // Исправление viewport для мобильных
    function fixViewport() {
        const viewport = document.querySelector('meta[name="viewport"]');
        if (window.innerWidth <= 480) {
            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
        } else {
            viewport.setAttribute('content', 'width=device-width, initial-scale=1.0');
        }
    }
    
    fixViewport();
    window.addEventListener('resize', fixViewport);
}

// Вызываем при загрузке
document.addEventListener('DOMContentLoaded', optimizeForMobile);
// ==================== ПОИСК С ПЕРЕКЛЮЧЕНИЕМ ВКЛАДОК ====================

// Карта контента по вкладкам
const tabContentMap = {
    'dashboard': {
        name: 'Главная',
        selector: '#dashboard-section',
        content: document.querySelector('#dashboard-section')?.textContent || ''
    },
    'binds': {
        name: 'Бинды', 
        selector: '#binds-section',
        content: document.querySelector('#binds-section')?.textContent || ''
    },
    'commands': {
        name: 'Команды',
        selector: '#commands-section', 
        content: document.querySelector('#commands-section')?.textContent || ''
    },
    'documents': {
        name: 'Документы',
        selector: '#documents-section',
        content: document.querySelector('#documents-section')?.textContent || ''
    },
    'leadership': {
        name: 'Начальство',
        selector: '#leadership-section',
        content: document.querySelector('#leadership-section')?.textContent || ''
    },
    'weapon': {
        name: 'Оружие',
        selector: '#weapon-section',
        content: document.querySelector('#weapon-section')?.textContent || ''
    },
    'radio': {
        name: 'Радиообмен',
        selector: '#radio-section',
        content: document.querySelector('#radio-section')?.textContent || ''
    },
    'jurisdiction': {
        name: 'Юрисдикции',
        selector: '#jurisdiction-section',
        content: document.querySelector('#jurisdiction-section')?.textContent || ''
    },
    'roleplay': {
        name: 'Отыгровки',
        selector: '#roleplay-section',
        content: document.querySelector('#roleplay-section')?.textContent || ''
    },
    'map': {
        name: 'Карта',
        selector: '#map-section',
        content: document.querySelector('#map-section')?.textContent || ''
    },
    'fleet': {
        name: 'Автопарк',
        selector: '#fleet-section',
        content: document.querySelector('#fleet-section')?.textContent || ''
    },
    'violators': {
        name: 'Нарушители',
        selector: '#violators-section',
        content: document.querySelector('#violators-section')?.textContent || ''
    },
    'pdd-tests': {
        name: 'Тесты ПДД',
        selector: '#pdd-tests-section',
        content: document.querySelector('#pdd-tests-section')?.textContent || ''
    },
    'hotspots': {
        name: 'Очаги нарушений',
        selector: '#hotspots-section',
        content: document.querySelector('#hotspots-section')?.textContent || ''
    },
    'guides': {
        name: 'Гайды',
        selector: '#guides-section',
        content: document.querySelector('#guides-section')?.textContent || ''
    },
    'statistics': {
        name: 'Статистика',
        selector: '#statistics-section',
        content: document.querySelector('#statistics-section')?.textContent || ''
    },
    'leaderboard': {
        name: 'Таблица лидеров',
        selector: '#leaderboard-section',
        content: document.querySelector('#leaderboard-section')?.textContent || ''
    },
    'profile-settings': {
        name: 'Настройки профиля',
        selector: '#profile-settings-section',
        content: document.querySelector('#profile-settings-section')?.textContent || ''
    },
    'profile': {
        name: 'Профиль',
        selector: '#profile-section',
        content: document.querySelector('#profile-section')?.textContent || ''
    },
    'settings': {
        name: 'Настройки',
        selector: '#settings-section',
        content: document.querySelector('#settings-section')?.textContent || ''
    },
    'admin': {
        name: 'Админ-панель',
        selector: '#admin-section',
        content: document.querySelector('#admin-section')?.textContent || ''
    }
};

function performSimpleSearch() {
    const searchTerm = document.getElementById('simpleSearch').value.trim().toLowerCase();
    const resultsPanel = document.getElementById('searchResultsPanel');
    
    // Очищаем панель результатов
    resultsPanel.innerHTML = '';
    resultsPanel.classList.remove('active');
    removeHighlights();
    
    if (searchTerm.length < 1) return;
    
    let totalMatches = 0;
    const foundTabs = [];
    
    // Ищем в каждой вкладке
    for (const [tabId, tabData] of Object.entries(tabContentMap)) {
        if (!tabData.content) continue;
        
        const matches = (tabData.content.toLowerCase().match(new RegExp(searchTerm, 'g')) || []).length;
        
        if (matches > 0) {
            totalMatches += matches;
            foundTabs.push({
                id: tabId,
                name: tabData.name,
                matches: matches,
                selector: tabData.selector
            });
        }
    }
    
    // Сортируем по количеству совпадений
    foundTabs.sort((a, b) => b.matches - a.matches);
    
    // Показываем результаты
    if (foundTabs.length > 0) {
        resultsPanel.classList.add('active');
        
        // Создаем заголовок
        const header = document.createElement('div');
        header.className = 'search-results-header';
        header.innerHTML = `<strong>Найдено ${totalMatches} совпадений в ${foundTabs.length} разделах:</strong>`;
        resultsPanel.appendChild(header);
        
        // Добавляем список вкладок
        foundTabs.forEach(tab => {
            const tabElement = document.createElement('div');
            tabElement.className = 'search-tab-result';
            tabElement.innerHTML = `
                <span class="tab-name">${tab.name}</span>
                <span class="tab-matches">${tab.matches} совпад.</span>
            `;
            
            // При клике переходим на вкладку и подсвечиваем текст
            tabElement.addEventListener('click', function() {
                // Переключаемся на вкладку
                showSection(tab.id);
                
                // Подсвечиваем текст в этой вкладке
                highlightInTab(tab.selector, searchTerm);
                
                // Закрываем панель результатов
                resultsPanel.classList.remove('active');
                
                // Прокручиваем к первому совпадению
                setTimeout(() => {
                    const firstMatch = document.querySelector(`${tab.selector} mark.search-match`);
                    if (firstMatch) {
                        firstMatch.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        // Мигающий эффект для привлечения внимания
                        firstMatch.style.backgroundColor = '#ff9800';
                        setTimeout(() => {
                            firstMatch.style.backgroundColor = '#ffeb3b';
                        }, 1000);
                    }
                }, 300);
            });
            
            resultsPanel.appendChild(tabElement);
        });
        
        // Добавляем кнопку "Показать все"
        const showAllBtn = document.createElement('button');
        showAllBtn.className = 'search-show-all';
        showAllBtn.textContent = 'Подсветить все совпадения на странице';
        showAllBtn.onclick = function() {
            highlightAllOnPage(searchTerm);
            resultsPanel.classList.remove('active');
        };
        resultsPanel.appendChild(showAllBtn);
        
    } else {
        // Нет результатов
        resultsPanel.classList.add('active');
        resultsPanel.innerHTML = `
            <div class="search-no-results">
                <i class="fas fa-search"></i>
                <div>Ничего не найдено</div>
                <small>Попробуйте другой запрос</small>
            </div>
        `;
    }
}

function highlightInTab(tabSelector, searchTerm) {
    // Убираем старые подсветки
    removeHighlights();
    
    // Ищем в конкретной вкладке
    const tabElement = document.querySelector(tabSelector);
    if (!tabElement) return;
    
    const regex = new RegExp(`(${searchTerm})`, 'gi');
    
    // Обходим все текстовые узлы в вкладке
    const walker = document.createTreeWalker(
        tabElement,
        NodeFilter.SHOW_TEXT,
        null,
        false
    );
    
    let node;
    const nodesToReplace = [];
    
    while (node = walker.nextNode()) {
        if (node.textContent.toLowerCase().includes(searchTerm.toLowerCase())) {
            nodesToReplace.push(node);
        }
    }
    
    // Заменяем узлы
    nodesToReplace.forEach(node => {
        const span = document.createElement('span');
        span.innerHTML = node.textContent.replace(regex, '<mark class="search-match">$1</mark>');
        node.parentNode.replaceChild(span, node);
    });
}

function highlightAllOnPage(searchTerm) {
    removeHighlights();
    
    const regex = new RegExp(`(${searchTerm})`, 'gi');
    const elements = document.querySelectorAll('p, h1, h2, h3, h4, h5, h6, span, div, li, td, th, strong, em');
    
    elements.forEach(element => {
        if (element.children.length === 0 && element.textContent) {
            const html = element.innerHTML;
            if (html.toLowerCase().includes(searchTerm.toLowerCase())) {
                element.innerHTML = html.replace(regex, '<mark class="search-match">$1</mark>');
            }
        }
    });
}

function removeHighlights() {
    document.querySelectorAll('.search-match').forEach(mark => {
        const parent = mark.parentNode;
        const text = document.createTextNode(mark.textContent);
        parent.replaceChild(text, mark);
        parent.normalize();
    });
}

function clearSimpleSearch() {
    document.getElementById('simpleSearch').value = '';
    document.getElementById('searchResultsPanel').classList.remove('active');
    removeHighlights();
    document.getElementById('simpleSearch').focus();
}

// Инициализация поиска
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('simpleSearch');
    
    if (searchInput) {
        // Поиск с задержкой
        let searchTimeout;
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSimpleSearch();
            }, 300);
        });
        
        // Закрытие результатов при клике вне поиска
        document.addEventListener('click', function(e) {
            const searchContainer = document.querySelector('.simple-search-container');
            const resultsPanel = document.getElementById('searchResultsPanel');
            
            if (!searchContainer.contains(e.target)) {
                resultsPanel.classList.remove('active');
            }
        });
        
        // Закрытие по ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.getElementById('searchResultsPanel').classList.remove('active');
            }
        });
    }
});
    </script>
    <!-- Модальное окно 2FA -->
<div id="twoFactorAuthModal" class="modal" style="display: none;">
  <div class="modal-content modal-medium">
    <div class="modal-header">
      <h2><i class="fas fa-mobile-alt"></i> Двухфакторная аутентификация</h2>
    </div>
    <div class="modal-body">
      <div id="twoFactorSetup">
        <p>Для настройки 2FA выполните следующие шаги:</p>
        <ol>
          <li>Установите приложение <strong>Google Authenticator</strong> или <strong>Authy</strong></li>
          <li>Отсканируйте QR-код ниже или введите ключ вручную</li>
          <li>Введите 6-значный код из приложения для подтверждения</li>
        </ol>
        
        <div id="qrcode-container" style="text-align: center; margin: 20px 0; padding: 15px; background: var(--light); border-radius: 8px;">
          <!-- QR-код появится здесь -->
        </div>
        
        <div class="form-group">
          <label for="secretKey"><i class="fas fa-key"></i> Секретный ключ (для ручного ввода):</label>
          <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="secretKey" class="form-control" readonly 
                   style="font-family: monospace; letter-spacing: 1px;">
            <button type="button" class="btn btn-outline" onclick="copySecretKey()" 
                    style="white-space: nowrap;">
              <i class="fas fa-copy"></i>
            </button>
          </div>
          <small style="color: var(--gray); font-size: 0.8rem;">
            Сохраните этот ключ в надежном месте на случай потери доступа к приложению
          </small>
        </div>
        
        <div class="form-group">
          <label for="verificationCode"><i class="fas fa-shield-alt"></i> Код подтверждения:</label>
          <input type="text" id="verificationCode" class="form-control" 
                 placeholder="Введите 6-значный код из приложения" 
                 maxlength="6" pattern="[0-9]{6}" inputmode="numeric">
        </div>
        
        <div class="form-group" style="display: flex; gap: 10px;">
          <button class="btn btn-success" onclick="enable2FA()" style="flex: 1;">
            <i class="fas fa-check"></i> Включить 2FA
          </button>
          <button class="btn btn-outline" onclick="hideModal('twoFactorAuthModal')" style="flex: 1;">
            <i class="fas fa-times"></i> Отмена
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Модальное окно удаления аккаунта -->
<div id="deleteAccountModal" class="modal" style="display: none;">
  <div class="modal-content modal-medium">
    <div class="modal-header" style="background: var(--danger);">
      <h2><i class="fas fa-exclamation-triangle"></i> Удаление аккаунта</h2>
    </div>
    <div class="modal-body">
      <div class="danger-zone">
        <h4><i class="fas fa-exclamation-triangle"></i> Внимание! Это действие необратимо</h4>
        <p>Все ваши данные будут удалены без возможности восстановления.</p>
        
        <div class="form-group">
          <label for="confirmPassword">Введите ваш пароль:</label>
          <input type="password" id="confirmPassword" class="form-control" placeholder="Введите ваш пароль">
        </div>
        
        <div class="form-group">
          <label for="confirmText">Введите "УДАЛИТЬ АККАУНТ":</label>
          <input type="text" id="confirmText" class="form-control" placeholder='Введите "УДАЛИТЬ АККАУНТ"'>
        </div>
        
        <div class="form-group" style="display: flex; gap: 10px;">
          <button class="btn btn-danger" onclick="deleteAccount()" style="flex: 1;">Удалить аккаунт</button>
          <button class="btn btn-outline" onclick="hideModal('deleteAccountModal')" style="flex: 1;">Отмена</button>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Модальное окно для VK регистрации -->
<div id="vkRegisterModal" class="modal">
  <div class="modal-content modal-medium">
    <div class="modal-header" style="background: #4a76a8;">
      <h2><i class="fab fa-vk"></i> Завершение регистрации</h2>
    </div>
    <div class="modal-body">
      <form id="vkRegisterForm">
        <div class="form-group">
          <label>Ваше имя из VK:</label>
          <input type="text" id="vkUserName" class="form-control" readonly>
        </div>
        <div class="form-group">
          <label for="gameNickname"><i class="fas fa-gamepad"></i> Игровой никнейм *</label>
          <input type="text" id="gameNickname" class="form-control" required placeholder="Ваш ник в игре">
        </div>
        <div class="form-group">
          <label for="serviceNumber"><i class="fas fa-id-card"></i> Служебный номер *</label>
          <input type="text" id="serviceNumber" class="form-control" required placeholder="Например: ГИБДД-001">
          <small style="color: var(--gray);">Должен соответствовать вашему номеру в игре</small>
        </div>
        <div class="form-group">
          <label for="fractionSelect"><i class="fas fa-shield-alt"></i> Подразделение *</label>
          <select id="fractionSelect" class="form-control" required>
            <option value="">Выберите подразделение</option>
            <option value="ГИБДД">ГИБДД Приволжска</option>
            <option value="ГИБДД Невского">ГИБДД Невского</option>
            <option value="ГИБДД Мирного">ГИБДД Мирного</option>
          </select>
        </div>
        <div class="form-group" style="display: flex; gap: 10px;">
          <button type="submit" class="btn btn-success" style="flex: 1;">
            <i class="fas fa-check"></i> Завершить регистрацию
          </button>
          <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('vkRegisterModal')">
            <i class="fas fa-times"></i> Отмена
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Модальное окно создания карточки нарушителя -->
<div id="createViolatorModal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2><i class="fas fa-user-plus"></i> Создание карточки нарушителя</h2>
        </div>
        <div class="modal-body">
            <form id="createViolatorForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="violatorName"><i class="fas fa-user"></i> Имя и фамилия *</label>
                        <input type="text" id="violatorName" class="form-control" required placeholder="Иван Иванов">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="violation"><i class="fas fa-exclamation-triangle"></i> Нарушение *</label>
                    <textarea id="violation" class="form-control" rows="3" required placeholder="Описание нарушения..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="evidence"><i class="fas fa-file-alt"></i> Доказательства нарушения *</label>
                    <textarea id="evidence" class="form-control" rows="3" required placeholder="Описание доказательств..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="notes"><i class="fas fa-sticky-note"></i> Примечания</label>
                    <textarea id="notes" class="form-control" rows="2" placeholder="Дополнительная информация..."></textarea>
                </div>
                
                <div class="form-group" style="display: flex; gap: 10px;">
                    <button type="submit" class="btn btn-success" style="flex: 1;">
                        <i class="fas fa-save"></i> Создать карточку
                    </button>
                    <button type="button" class="btn btn-outline" style="flex: 1;" onclick="hideModal('createViolatorModal')">
                        <i class="fas fa-times"></i> Отмена
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Новогодний баннер -->
<div class="newyear-banner">
    С Наступающим Новым Годом! 🎁
</div>

<!-- Новогодний снегопад -->
<div class="snow-container" id="snowContainer"></div>

<script>
// Генерация снежинок
function createSnowflakes() {
    const snowContainer = document.getElementById('snowContainer');
    const snowflakeCount = 50;
    
    for (let i = 0; i < snowflakeCount; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.innerHTML = '❄';
        
        // Случайные параметры
        const size = Math.random() * 1.2 + 0.8;
        const left = Math.random() * 100;
        const animationDuration = Math.random() * 6 + 4;
        const animationDelay = Math.random() * 3;
        
        snowflake.style.fontSize = `${size}em`;
        snowflake.style.left = `${left}vw`;
        snowflake.style.animationDuration = `${animationDuration}s`;
        snowflake.style.animationDelay = `${animationDelay}s`;
        
        snowContainer.appendChild(snowflake);
    }
}

// Запуск при загрузке
document.addEventListener('DOMContentLoaded', createSnowflakes);
</script>
<div id="notificationsContainer" class="notifications-container"></div>
</body>
</html>
